<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Serafin Martig und Nadja Pfister (Arbeitsteilung 50:50)">

<title>R-Code des Semesterprojektes - Unbeabsichtigte Begegnungen und Bewegungsmuster: Eine Analyse von Bewegungsdaten innerhalb einer Gemeinde</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="preprocessing_files/libs/clipboard/clipboard.min.js"></script>
<script src="preprocessing_files/libs/quarto-html/quarto.js"></script>
<script src="preprocessing_files/libs/quarto-html/popper.min.js"></script>
<script src="preprocessing_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="preprocessing_files/libs/quarto-html/anchor.min.js"></script>
<link href="preprocessing_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="preprocessing_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="preprocessing_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="preprocessing_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="preprocessing_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">R-Code des Semesterprojektes - Unbeabsichtigte Begegnungen und Bewegungsmuster: Eine Analyse von Bewegungsdaten innerhalb einer Gemeinde</h1>
<p class="subtitle lead">Project for Patterns and trends in environmental data MSc ENR FS24</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor:in</div>
    <div class="quarto-title-meta-contents">
             <p>Serafin Martig und Nadja Pfister (Arbeitsteilung 50:50) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="libraries" class="level1">
<h1>Libraries</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prettymapr)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("osmdata")</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>#Daten einlesen</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and process your data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#B</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>records_json_S <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">read_json</span>(<span class="st">"C:/_Data/Master/PaT_24/Projectwork/RProjectwork/Ausgangsdaten/Takeout_B/Standortverlauf (Zeitachse)/Records.json"</span>, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>records_S <span class="ot">&lt;-</span> records_json_S[[<span class="dv">1</span>]] <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Person =</span> <span class="st">"B"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#A</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>records_json_N <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">read_json</span>(<span class="st">"C:/_Data/Master/PaT_24/Projectwork/RProjectwork/Ausgangsdaten/Takeout_A/Standortverlauf (Zeitachse)/Records.json"</span>, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>records_N <span class="ot">&lt;-</span> records_json_N[[<span class="dv">1</span>]] <span class="sc">|&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Person =</span> <span class="st">"A"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="fu">ymd_hms</span>(timestamp))) <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">2023</span>, <span class="dv">2024</span>))</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>records_N2 <span class="ot">&lt;-</span> records_json_N[[<span class="dv">1</span>]] <span class="sc">|&gt;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Person =</span> <span class="st">"A"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="fu">ymd_hms</span>(timestamp))) <span class="sc">|&gt;</span> </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">month</span>(<span class="fu">ymd_hms</span>(timestamp))) <span class="sc">%&gt;%</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2024</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># # zusammenführen</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>records <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(records_N, records_S)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the data to an sf object and prepare coordinates</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>records_sf_both <span class="ot">&lt;-</span> records <span class="sc">%&gt;%</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> latitudeE7 <span class="sc">/</span> <span class="fl">1e7</span>,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> longitudeE7 <span class="sc">/</span> <span class="fl">1e7</span>,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat_copy =</span> latitudeE7 <span class="sc">/</span> <span class="fl">1e7</span>,  <span class="co"># Kopie der Latitude</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon_copy =</span> longitudeE7 <span class="sc">/</span> <span class="fl">1e7</span>,  <span class="co"># Kopie der Longitude</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">timestamp =</span> <span class="fu">as.POSIXct</span>(timestamp, <span class="at">origin =</span> <span class="st">"1970-01-01"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">activity =</span> <span class="fu">map_chr</span>(activity, <span class="sc">~</span> .x[[<span class="dv">1</span>]]<span class="sc">$</span>type <span class="sc">%||%</span> <span class="st">"UNKNOWN"</span>) <span class="co"># Assuming there is always at least one activity type; otherwise, it defaults to "UNKNOWN"  </span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(records_sf_both)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "latitudeE7"        "longitudeE7"       "accuracy"         
 [4] "source"            "deviceTag"         "deviceDesignation"
 [7] "timestamp"         "activity"          "altitude"         
[10] "verticalAccuracy"  "platformType"      "osLevel"          
[13] "serverTimestamp"   "deviceTimestamp"   "batteryCharging"  
[16] "formFactor"        "velocity"          "heading"          
[19] "locationMetadata"  "inferredLocation"  "placeId"          
[22] "activeWifiScan"    "Person"            "Year"             
[25] "lat_copy"          "lon_copy"          "geometry"         </code></pre>
</div>
</div>
<p>#Daten filtern</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(records_sf_both)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'sf' and 'data.frame':  318933 obs. of  27 variables:
 $ latitudeE7       : int  467422864 467423301 467423301 467423301 467423301 467423301 467423186 467423147 467421718 467421696 ...
 $ longitudeE7      : int  97779715 97778860 97778860 97778860 97778860 97778860 97774770 97778595 97776254 97776243 ...
 $ accuracy         : int  6 7 7 7 7 7 15 20 20 18 ...
 $ source           : chr  "GPS" "GPS" "GPS" "GPS" ...
 $ deviceTag        : int  467305824 467305824 467305824 467305824 467305824 467305824 467305824 467305824 467305824 467305824 ...
 $ deviceDesignation: chr  NA NA NA NA ...
 $ timestamp        : POSIXct, format: "2022-01-01" "2022-01-01" ...
 $ activity         : chr  "UNKNOWN" "UNKNOWN" "UNKNOWN" "UNKNOWN" ...
 $ altitude         : int  NA NA NA NA NA NA NA NA NA NA ...
 $ verticalAccuracy : int  NA NA NA NA NA NA NA NA NA NA ...
 $ platformType     : chr  NA NA NA NA ...
 $ osLevel          : int  NA NA NA NA NA NA NA NA NA NA ...
 $ serverTimestamp  : chr  NA NA NA NA ...
 $ deviceTimestamp  : chr  NA NA NA NA ...
 $ batteryCharging  : logi  NA NA NA NA NA NA ...
 $ formFactor       : chr  NA NA NA NA ...
 $ velocity         : int  NA NA NA NA NA NA NA NA NA NA ...
 $ heading          : int  NA NA NA NA NA NA NA NA NA NA ...
 $ locationMetadata :List of 318933
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  .. [list output truncated]
 $ inferredLocation :List of 318933
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  ..$ : NULL
  .. [list output truncated]
 $ placeId          : chr  NA NA NA NA ...
 $ activeWifiScan   :'data.frame':  318933 obs. of  1 variable:
  ..$ accessPoints:List of 318933
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. ..$ : NULL
  .. .. [list output truncated]
 $ Person           : chr  "A" "A" "A" "A" ...
 $ Year             : num  2022 2022 2022 2022 2022 ...
 $ lat_copy         : num  46.7 46.7 46.7 46.7 46.7 ...
 $ lon_copy         : num  9.78 9.78 9.78 9.78 9.78 ...
 $ geometry         :sfc_POINT of length 318933; first list element:  'XY' num  9.78 46.74
 - attr(*, "sf_column")= chr "geometry"
 - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
  ..- attr(*, "names")= chr [1:26] "latitudeE7" "longitudeE7" "accuracy" "source" ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtern nach dem Jahr 2024</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>records_sf <span class="ot">&lt;-</span> records_sf_both <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(timestamp) <span class="sc">==</span> <span class="dv">2024</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>#Plot Activity an einzelnem Tag</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Date</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>records_filtered <span class="ot">&lt;-</span> records_sf_both <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as.Date</span>(timestamp) <span class="sc">==</span> <span class="fu">as.Date</span>(<span class="st">"2024-04-08"</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform point data to a line representation</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>records_lines <span class="ot">&lt;-</span> records_filtered <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_combine</span>(geometry), <span class="at">activity =</span> <span class="fu">first</span>(activity), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>)  <span class="co"># Cast MULTIPOINT to LINESTRING</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a color palette for activity types</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>activity_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ON_FOOT"</span> <span class="ot">=</span> <span class="st">"green"</span>, <span class="st">"TILTING"</span> <span class="ot">=</span> <span class="st">"orange"</span>, <span class="st">"UNKNOWN"</span> <span class="ot">=</span> <span class="st">"grey"</span>, <span class="st">"STILL"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"IN_VEHICLE"</span> <span class="ot">=</span> <span class="st">"red"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the point and line data on the map</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap &lt;- </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(records_filtered) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(records_lines) <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"activity"</span>, <span class="at">palette =</span> activity_colors, <span class="at">title.col =</span> <span class="st">"Activity Type"</span>) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_basemap</span>(<span class="at">server =</span> <span class="st">"OpenStreetMap"</span>) <span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Visualisierung der geographischen Datenpunkte mit Aktivitätsniveau"</span>,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the map</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print(tmap)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>#Geschwindigkeit über Zeit mit Pausen &gt;&gt; es müssen noch auf Tage oder Zeitperiode definiert werden</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Hinzufügen einer simulierten Geschwindigkeit für das Beispiel</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>records_sf <span class="ot">&lt;-</span> records_sf <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">60</span>),  <span class="co"># Zufällige Geschwindigkeit zwischen 0 und 60 km/h</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">activity =</span> <span class="fu">if_else</span>(<span class="fu">runif</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"moving"</span>, <span class="st">"pause"</span>)  <span class="co"># Zufällige Aktivitätszuweisung</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot für Geschwindigkeit über Zeit mit Pausen</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># moving_speed_plot_with_pauses &lt;- </span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">filter</span>(records_sf, activity <span class="sc">==</span> <span class="st">"moving"</span>),</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> timestamp, <span class="at">y =</span> speed, <span class="at">color =</span> <span class="st">"Moving"</span>)) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(records_sf, activity <span class="sc">==</span> <span class="st">"pause"</span>),</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> timestamp, <span class="at">y =</span> speed, <span class="at">color =</span> <span class="st">"Pause"</span>)) <span class="sc">+</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Moving"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Pause"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Speed Over Time (Movement and Pauses)"</span>, <span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Speed (km/h)"</span>) <span class="sc">+</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drucken des Plots</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print(moving_speed_plot_with_pauses)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>#Heatmap</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(records_sf)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "latitudeE7"        "longitudeE7"       "accuracy"         
 [4] "source"            "deviceTag"         "deviceDesignation"
 [7] "timestamp"         "activity"          "altitude"         
[10] "verticalAccuracy"  "platformType"      "osLevel"          
[13] "serverTimestamp"   "deviceTimestamp"   "batteryCharging"  
[16] "formFactor"        "velocity"          "heading"          
[19] "locationMetadata"  "inferredLocation"  "placeId"          
[22] "activeWifiScan"    "Person"            "Year"             
[25] "lat_copy"          "lon_copy"          "geometry"         
[28] "speed"            </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Erstellen einer Heatmap der Bewegungsdaten</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap_movement &lt;- </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(records_sf, <span class="fu">aes</span>(<span class="at">x =</span> lon_copy , <span class="at">y =</span> lat_copy )) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density2d</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_stat</span>(level)), <span class="at">geom =</span> <span class="st">"polygon"</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Heatmap der Bewegungsdaten"</span>, <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>( . <span class="sc">~</span> Person)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drucken der Heatmap</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print(heatmap_movement)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarisieren von häufigen Aufenthaltsorten basierend auf deinen vorhandenen Koordinaten </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># install.packages("data.table")</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(data.table)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(records_sf)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>frequent_locations <span class="ot">&lt;-</span> records_sf[activity <span class="sc">==</span> <span class="st">"moving"</span>, </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                                 .(<span class="at">count =</span> .N), </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                                 by <span class="ot">=</span> .(Person, lon_copy, lat_copy)][<span class="fu">order</span>(<span class="sc">-</span>count)]  </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"># frequent_locations &lt;- </span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_sf %&gt;% </span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(activity == "moving") |&gt; </span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Person, lon_copy, lat_copy) %&gt;%</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(count = n(), .groups = 'drop') %&gt;%</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(desc(count))</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisierung der häufigen Aufenthaltsorte</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># frequent_locations_plot &lt;- </span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(frequent_locations, <span class="fu">aes</span>(<span class="at">x =</span> lon_copy, <span class="at">y =</span> lat_copy, <span class="at">size =</span> count, <span class="at">color =</span> Person)) <span class="sc">+</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Häufige Aufenthaltsorte"</span>, <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>) <span class="sc">+</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Drucken des Plots</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print(frequent_locations_plot)</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # Print the plot</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print(frequent_locations_plot)</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # Print the heatmap</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print(heatmap_movement)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>#Plots</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a> <span class="do">##  Koordinaten ##</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot der Longitude und Latitude</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(records_sf, <span class="fu">aes</span>(<span class="at">x =</span> lat_copy, <span class="at">y =</span> lon_copy, <span class="at">color =</span> activity)) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Plot der Koordinaten (Longitude und Latitude) nach Aktivität"</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( . <span class="sc">~</span> Person )</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot der Longitude und Latitude</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#B</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>records_sf <span class="sc">|&gt;</span>  </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Person <span class="sc">==</span> <span class="st">"B"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lat_copy, <span class="at">y =</span> lon_copy)) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Koordinaten der besuchten Orte oder Aktivität von B"</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( . <span class="sc">~</span> Person )</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#A</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>records_sf <span class="sc">|&gt;</span>  </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Person <span class="sc">==</span> <span class="st">"A"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lat_copy, <span class="at">y =</span> lon_copy)) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Koordinaten der besuchten Orte oder Aktivität von A"</span>) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( . <span class="sc">~</span> Person )</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot der Longitude und Latitude</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(records_sf, <span class="fu">aes</span>(<span class="at">x =</span> lat_copy, <span class="at">y =</span> lon_copy, <span class="at">color =</span> Person)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Koordinaten nach Person"</span>) <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-7-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a> <span class="do">##  Zeitlich ##</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># #mit Geschwindigkeit</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # # Plot der Longitude und Latitude</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(records_sf, aes(x = day, y = Speed_kmh, color = Person )) +</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point() +</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Erreichte Geschwindigkeiten der Personen") +</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(records_sf, aes(x = day, y = Speed_kmh, color = Person )) +</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_boxplot() +</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Erreichte Geschwindigkeiten der Personen") +</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(records_sf, aes(x = Person, y = Speed_kmh)) +</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_boxplot() +</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Erreichte Geschwindigkeiten der Personen über Untersuchungszeitraum") +</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot mit x-Achse Zeit, y-Achse Koordinate (Long, Lat) und color = Person </span><span class="al">###</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">#wie kann man Longitude und Latitude auf der y-Achse darstellen?</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="do">## Anzahl Aktivitäten</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(records_sf, aes(x = lat_copy, y = lon_copy, color = Person)) +</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point() +</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_text(aes(label = Placemark), vjust = -1, size = 3) +  # Punkte mit Text aus der Spalte 'Placemark' beschriften</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Plot der Koordinaten (Longitude und Latitude) nach Person") +</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Add plotting for Speed Over Time where movement occurred, highlighting pauses</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="co"># moving_speed_plot_with_pauses &lt;- </span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(data = filter(records_sf, activity == "moving"),</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="co">#             aes(x = time, y = speed, color = activity)) +</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(data = filter(records_sf, activity == "pause"),</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="co">#              aes(x = time, y = speed, color = activity)) +</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(values = c("moving" = "blue", "pause" = "red")) +</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Speed Over Time (Movement and Pauses)", x = "Time", y = "Speed (km/h)") +</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(  Person  ~ .)</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a><span class="co">#Hotspot</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(records_sf, <span class="fu">aes</span>(<span class="at">x =</span> lon_copy, <span class="at">y =</span> lat_copy)) <span class="sc">+</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density2d</span>(<span class="fu">aes</span>(<span class="at">fill =</span> ..level..), <span class="at">geom =</span> <span class="st">"polygon"</span>) <span class="sc">+</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Heatmap der Bewegungsdaten"</span>, <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>) <span class="sc">+</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(  .  <span class="sc">~</span> Person)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-7-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Häufige Aufenthaltsorte </span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># frequent_locations &lt;- records_sf %&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Person, lon_copy, lat_copy) %&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(count = n()) %&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(desc(count))</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#dieserplot</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisierung der häufigen Aufenthaltsorte</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(frequent_locations, <span class="fu">aes</span>(<span class="at">x =</span> lon_copy, <span class="at">y =</span> lat_copy, <span class="at">size =</span> count, <span class="at">color =</span> Person)) <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Häufige Aufenthaltsorte"</span>, <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>) <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-7-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>#Meeting_Points</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Define the file path for the CSV file</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># csv_path &lt;- "C:/Users/A/OneDrive - ZHAW/General/Projektarbeit/R/PatTre/Data/csv_data_moving_pause.csv"</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Read the CSV file</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># csv_data &lt;- read_csv(csv_path)</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the time column to POSIXct</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>records_sf_Timepoint <span class="ot">&lt;-</span> records_sf <span class="sc">%&gt;%</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Time_Point =</span> <span class="fu">as.POSIXct</span>(deviceTimestamp, <span class="at">format =</span> <span class="st">"%Y-%m-%dT%H:%M:%OS"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>))</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(records_sf_Timepoint<span class="sc">$</span>Time_Point)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> POSIXct[1:53086], format: "2024-01-03 07:38:28" "2024-01-03 07:38:28" "2024-01-03 07:38:28" ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Round the time to the nearest 15 minutes</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>records_sf_Timepoint_rounded <span class="ot">&lt;-</span> records_sf_Timepoint <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Time_Rounded =</span> <span class="fu">round_date</span>(Time_Point, <span class="at">unit =</span> <span class="st">"15 minutes"</span>))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into separate data frames for each person</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>B_data <span class="ot">&lt;-</span> records_sf_Timepoint_rounded <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Person <span class="sc">==</span> <span class="st">"B"</span>) <span class="sc">|&gt;</span>   <span class="fu">as.data.frame</span>()</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>A_data <span class="ot">&lt;-</span> records_sf_Timepoint_rounded <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Person <span class="sc">==</span> <span class="st">"A"</span>) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the datasets by the rounded time</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(B_data, A_data, <span class="at">by =</span> <span class="st">"Time_Rounded"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">".B"</span>, <span class="st">".A"</span>))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(joined_data)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "latitudeE7.B"        "longitudeE7.B"       "accuracy.B"         
 [4] "source.B"            "deviceTag.B"         "deviceDesignation.B"
 [7] "timestamp.B"         "activity.B"          "altitude.B"         
[10] "verticalAccuracy.B"  "platformType.B"      "osLevel.B"          
[13] "serverTimestamp.B"   "deviceTimestamp.B"   "batteryCharging.B"  
[16] "formFactor.B"        "velocity.B"          "heading.B"          
[19] "locationMetadata.B"  "inferredLocation.B"  "placeId.B"          
[22] "activeWifiScan.B"    "Person.B"            "Year.B"             
[25] "lat_copy.B"          "lon_copy.B"          "geometry.B"         
[28] "speed.B"             "Time_Point.B"        "Time_Rounded"       
[31] "latitudeE7.A"        "longitudeE7.A"       "accuracy.A"         
[34] "source.A"            "deviceTag.A"         "deviceDesignation.A"
[37] "timestamp.A"         "activity.A"          "altitude.A"         
[40] "verticalAccuracy.A"  "platformType.A"      "osLevel.A"          
[43] "serverTimestamp.A"   "deviceTimestamp.A"   "batteryCharging.A"  
[46] "formFactor.A"        "velocity.A"          "heading.A"          
[49] "locationMetadata.A"  "inferredLocation.A"  "placeId.A"          
[52] "activeWifiScan.A"    "Person.A"            "Year.A"             
[55] "lat_copy.A"          "lon_copy.A"          "geometry.A"         
[58] "speed.A"             "Time_Point.A"       </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Euclidean distances between concurrent observations</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Distance =</span> <span class="fu">sqrt</span>((lon_copy.B <span class="sc">-</span> lon_copy.A)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                           (lat_copy.B <span class="sc">-</span> lat_copy.A)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Radius der Erde in Kilometern</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>earth_radius <span class="ot">&lt;-</span> <span class="dv">6371</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Berechnung der Haversine-Distanz um von Grad auf Kilometer zu kommen</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Distance_km =</span> <span class="dv">2</span> <span class="sc">*</span> earth_radius <span class="sc">*</span> <span class="fu">asin</span>(<span class="fu">sqrt</span>(</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sin</span>((lat_copy.A <span class="sc">-</span> lat_copy.B) <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span> <span class="sc">/</span> <span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cos</span>(lat_copy.B <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span> <span class="fu">cos</span>(lat_copy.A <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sin</span>((lon_copy.A <span class="sc">-</span> lon_copy.B) <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span> <span class="sc">/</span> <span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="do">###  Meet als Radius von 250 Metern </span><span class="al">###</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine if the persons are spatially close enough to constitute a meet (within 250 meters)</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Meet =</span> Distance_km <span class="sc">&lt;=</span> <span class="fl">0.075</span>)</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the joined dataset to only include meets</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>meets_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Meet <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table with the meeting points, coordinates, and times</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>meeting_table <span class="ot">&lt;-</span> meets_data <span class="sc">%&gt;%</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Meeting_Longitude =</span> (lon_copy.B <span class="sc">+</span> lon_copy.A) <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">Meeting_Latitude =</span> (lat_copy.B <span class="sc">+</span> lat_copy.B) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Time_Rounded, Meeting_Longitude, Meeting_Latitude)</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the time column to POSIXct</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>records_sf_Timepoint <span class="ot">&lt;-</span> records_sf <span class="sc">%&gt;%</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Time_Point =</span> <span class="fu">as.POSIXct</span>(deviceTimestamp, <span class="at">format =</span> <span class="st">"%Y-%m-%dT%H:%M:%OS"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>))</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert POSIXct to Zurich time zone and format for the legend</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>meeting_table<span class="sc">$</span>Formatted_Time <span class="ot">&lt;-</span> meeting_table<span class="sc">$</span>Time_Rounded <span class="sc">%&gt;%</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with_tz</span>(<span class="st">"Europe/Zurich"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format</span>(<span class="st">"%d.%m.%Y %H:%M %Z"</span>)</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Get bounding box for the plot area based on meeting points</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="fu">min</span>(meeting_table<span class="sc">$</span>Meeting_Longitude), </span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xmax =</span> <span class="fu">max</span>(meeting_table<span class="sc">$</span>Meeting_Longitude), </span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> <span class="fu">min</span>(meeting_table<span class="sc">$</span>Meeting_Latitude), </span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> <span class="fu">max</span>(meeting_table<span class="sc">$</span>Meeting_Latitude)), <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>))</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch OpenStreetMap data</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>osm_map <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bbox =</span> bbox) <span class="sc">%&gt;%</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"highway"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">osmdata_sf</span>()</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a><span class="co">#Ausreisser entfernen</span></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>meeting_table_filtered <span class="ot">&lt;-</span> meeting_table <span class="sc">%&gt;%</span></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Formatted_Time <span class="sc">!=</span> <span class="st">"08.04.2024 08:15 CEST"</span>)</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert meeting_table to an sf object</span></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>sf_meeting_table <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(meeting_table_filtered, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Meeting_Longitude"</span>, <span class="st">"Meeting_Latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> osm_map<span class="sc">$</span>osm_lines, <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sf_meeting_table, <span class="fu">aes</span>(<span class="at">color =</span> Formatted_Time), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#9933FF"</span>, <span class="st">"#228B22"</span>, <span class="st">"#9933FF"</span>, <span class="st">"#9933FF"</span>),</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Treffzeitpunkt"</span>,</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Datum und Uhrzeit"</span>)) <span class="sc">+</span></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Treffpunkte innerhalb von 100 Metern"</span>,</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Hintergrundkarte OpenStreetMap"</span>) <span class="sc">+</span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the final plot</span></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_plot)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>#Plot Vergleich zwischen Personen</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>frequent_locations</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       Person lon_copy lat_copy count
       &lt;char&gt;    &lt;num&gt;    &lt;num&gt; &lt;int&gt;
    1:      A 7.506927 46.89821    71
    2:      A 8.664210 47.23103    42
    3:      A 8.664309 47.23090    38
    4:      A 7.506670 46.89830    36
    5:      A 8.664211 47.23102    35
   ---                               
20621:      B 8.663764 47.22491     1
20622:      B 8.663569 47.22501     1
20623:      B 8.663828 47.22473     1
20624:      B 8.666793 47.22562     1
20625:      B 8.664004 47.22463     1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisierung der häufigen Aufenthaltsorte</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># frequent_locations_plot &lt;- </span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(frequent_locations, <span class="fu">aes</span>(<span class="at">x =</span> lon_copy, <span class="at">y =</span> lat_copy, <span class="at">size =</span> count, <span class="at">color =</span> Person)) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Häufige Aufenthaltsorte"</span>, <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>bbox</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     xmin      ymin      xmax      ymax 
 8.665727 47.224463  8.680202 47.230027 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten in ein sf-Objekt umwandeln</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>frequent_locations_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(frequent_locations, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_copy"</span>, <span class="st">"lat_copy"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten anhand der Bounding Box zuschneiden</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>frequent_locations_cropped <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(frequent_locations_sf, bbox)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot erstellen</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> osm_map<span class="sc">$</span>osm_lines, <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> frequent_locations_cropped, <span class="fu">aes</span>(<span class="at">size =</span> count, <span class="at">color =</span> Person), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"A"</span> <span class="ot">=</span> <span class="st">"darkred"</span>, <span class="st">"B"</span> <span class="ot">=</span> <span class="st">"blue"</span>), </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Person"</span>, </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span> <span class="ot">=</span> <span class="st">"Person A"</span>, <span class="st">"B"</span> <span class="ot">=</span> <span class="st">"Person B"</span>), </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Vergleich zwischen Personen"</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Hintergrundkarte OpenStreetMap"</span>) <span class="sc">+</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> Person)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>frequent_locations_cropped_n <span class="ot">&lt;-</span> frequent_locations_cropped <span class="sc">|&gt;</span> <span class="fu">filter</span>(Person <span class="sc">==</span> <span class="st">"B"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> osm_map<span class="sc">$</span>osm_lines, <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> frequent_locations_cropped, <span class="fu">aes</span>(<span class="at">color =</span> Person), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"A"</span> <span class="ot">=</span> <span class="st">"darkred"</span>, <span class="st">"B"</span> <span class="ot">=</span> <span class="st">"blue"</span>), </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="cn">NULL</span>, </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span> <span class="ot">=</span> <span class="st">"Person A"</span>, <span class="st">"B"</span> <span class="ot">=</span> <span class="st">"Person B"</span>)) <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Vergleich zwischen Personen"</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Hintergrundkarte OpenStreetMap"</span>) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">1</span>),</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> Person)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-9-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> osm_map<span class="sc">$</span>osm_lines, <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sf_meeting_table, <span class="fu">aes</span>(<span class="at">color =</span> Formatted_Time), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#9933FF"</span>, <span class="st">"#228B22"</span>, <span class="st">"#9933FF"</span>, <span class="st">"#9933FF"</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Treffzeitpunkt"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Datum und Uhrzeit"</span>)) <span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Treffpunkte innerhalb von 100 Metern"</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Hintergrundkarte OpenStreetMap"</span>) <span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Kombinierter Plot erstellen</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> osm_map<span class="sc">$</span>osm_lines, <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> frequent_locations_cropped, <span class="fu">aes</span>(<span class="at">size =</span> count, <span class="at">color =</span> Person), <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sf_meeting_table, <span class="fu">aes</span>(<span class="at">color =</span> Formatted_Time), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"A"</span> <span class="ot">=</span> <span class="st">"darkred"</span>, <span class="st">"B"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"2022-01-01 12:00"</span> <span class="ot">=</span> <span class="st">"#D2FF33"</span>, <span class="st">"08.04.2024 08:15 CEST"</span> <span class="ot">=</span> <span class="st">"#006600"</span>, <span class="st">"11.04.2024 17:00 CEST"</span> <span class="ot">=</span> <span class="st">"green"</span>), </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span> <span class="ot">=</span> <span class="st">"Person A"</span>, <span class="st">"B"</span> <span class="ot">=</span> <span class="st">"Person B"</span>, <span class="st">"08.04.2024 08:15 CEST"</span> <span class="ot">=</span> <span class="st">"Treffpunkt: 08.04.2024 08:15 Uhr"</span>, <span class="st">"11.04.2024 17:00 CEST"</span> <span class="ot">=</span> <span class="st">"Treffpunkt: 11.04.2024 17:00 Uhr"</span>, <span class="st">"2022-01-01 14:00"</span> <span class="ot">=</span> <span class="st">"14:00"</span>), </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">1</span>,<span class="at">title =</span> <span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Person =</span> <span class="dv">16</span>, <span class="at">Formatted_Time =</span> <span class="dv">17</span>), <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>, <span class="at">title =</span> <span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Vergleich zwischen Personen und Treffpunkte"</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Hintergrundkarte OpenStreetMap"</span>,</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude"</span>) <span class="sc">+</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-9-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = osm_map$osm_lines, color = "grey80", size = 0.3) +</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = frequent_locations_cropped, aes(size = count, color = Person, shape = Type), alpha = 0.6) +</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = sf_meeting_table, aes(color = Formatted_Time, shape = Type), size = 3) +</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(values = c("A" = "#FF5733", "B" = "#0066FF", "2022-01-01 12:00" = "#D2FF33", "08.04.2024 08:15 CEST" = "#006600", "11.04.2024 17:00 CEST" = "#33CC33"), </span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("A" = "Person A", "B" = "Person B", "08.04.2024 08:15 CEST" = "Treffpunkt 1: 08.04.2024 08:15 Uhr", "11.04.2024 17:00 CEST" = "Treffpunkt 2: 11.04.2024 17:00 Uhr", "2022-01-01 14:00" = "14:00"), </span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                      guide = guide_legend(order = 1, title = NULL)) +</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_shape_manual(values = c("Person" = 16, "Treffpunkt" = 17), guide = guide_legend(order = 2, title = NULL)) +</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Vergleich zwischen Personen und Treffpunkte",</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#        subtitle = "Hintergrundkarte OpenStreetMap",</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">#        x = "Longitude",</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">#        y = "Latitude") +</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = "right")</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="connected-acitivities-and-distances-on-a-day-map" class="level1">
<h1>Connected acitivities and Distances on a Day &gt; Map</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geosphere)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have loaded the data into records_N dataframe</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># records_N &lt;- read.csv("path_to_your_data.csv") # Adjust the path accordingly</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter records by timestamp for the specific date</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>records_filtered <span class="ot">&lt;-</span> records_N <span class="sc">%&gt;%</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"2024-05-24"</span>, timestamp))</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the activity column</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>records_filtered <span class="ot">&lt;-</span> records_filtered <span class="sc">%&gt;%</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity =</span> <span class="fu">gsub</span>(<span class="st">"list</span><span class="sc">\\</span><span class="st">(list</span><span class="sc">\\</span><span class="st">(type = c</span><span class="sc">\\</span><span class="st">(|</span><span class="sc">\\</span><span class="st">), confidence = c</span><span class="sc">\\</span><span class="st">(|</span><span class="sc">\\</span><span class="st">)</span><span class="sc">\\</span><span class="st">)</span><span class="sc">\\</span><span class="st">)"</span>, <span class="st">""</span>, activity)) <span class="sc">%&gt;%</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(activity, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"activity1"</span>, <span class="st">"activity2"</span>), <span class="at">sep =</span> <span class="st">", confidence = "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(activity1, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"activity1"</span>, <span class="st">"activity1_confidence"</span>), <span class="at">sep =</span> <span class="st">", "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(activity2, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"activity2"</span>, <span class="st">"activity2_confidence"</span>), <span class="at">sep =</span> <span class="st">", "</span>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>records_filtered <span class="ot">&lt;-</span> records_filtered <span class="sc">%&gt;%</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">latitude =</span> latitudeE7 <span class="sc">/</span> <span class="fl">1e7</span>,</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">longitude =</span> longitudeE7 <span class="sc">/</span> <span class="fl">1e7</span>)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove activities "Null" and "Still"</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>records_filtered <span class="ot">&lt;-</span> records_filtered <span class="sc">%&gt;%</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>activity1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Null"</span>, <span class="st">"Still"</span>))</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to spatial dataframe</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>sf_records_filtered <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(records_filtered, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances between consecutive points</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>records_filtered <span class="ot">&lt;-</span> records_filtered <span class="sc">%&gt;%</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">distHaversine</span>(<span class="fu">cbind</span>(longitude, latitude), <span class="fu">cbind</span>(<span class="fu">lag</span>(longitude), <span class="fu">lag</span>(latitude))) <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">dist =</span> <span class="dv">0</span>))  <span class="co"># Replace NA distances with 0</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize distance per activity</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>activity_distances <span class="ot">&lt;-</span> records_filtered <span class="sc">%&gt;%</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(activity1) <span class="sc">%&gt;%</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_distance =</span> <span class="fu">sum</span>(dist, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Create labels for the legend</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>records_filtered <span class="ot">&lt;-</span> records_filtered <span class="sc">%&gt;%</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(activity_distances, <span class="at">by =</span> <span class="st">"activity1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">legend_label =</span> <span class="fu">paste</span>(activity1, <span class="fu">round</span>(total_distance, <span class="dv">2</span>), <span class="st">"km"</span>))</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Get bounding box for the plot area</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(sf_records_filtered)</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Get OpenStreetMap data</span></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>osm_map <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bbox =</span> <span class="fu">c</span>(bbox[<span class="st">"xmin"</span>], bbox[<span class="st">"ymin"</span>], bbox[<span class="st">"xmax"</span>], bbox[<span class="st">"ymax"</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"highway"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">osmdata_sf</span>()</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot using ggplot2</span></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> osm_map<span class="sc">$</span>osm_lines, <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span> <span class="co"># Use osm_lines for a more detailed background</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> records_filtered, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> legend_label), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> records_filtered, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">group =</span> <span class="dv">1</span>, <span class="at">color =</span> legend_label), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Connected Activities and Distances on 24.05.2024"</span>, </span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Activity and Distance"</span>, </span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Activity and Distance"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="connected-acitivities-and-distances-on-a-month-map-mit-hintergrund-ch-shp" class="level1">
<h1>Connected acitivities and Distances on a Month &gt; Map mit Hintergrund CH shp</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # QUELLE HINTERGRUNDKARTE:</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # https://www.swisstopo.admin.ch/de/landschaftsmodell-swissboundaries3d#swissBOUNDARIES3D---Download</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load necessary libraries</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # Set SHAPE_RESTORE_SHX config option</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Sys.setenv(SHAPE_RESTORE_SHX = "YES")</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load the Swiss boundaries shapefile</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># swiss_boundaries &lt;- st_read("C:/Users/A/OneDrive - ZHAW/General/Projektarbeit/Ausgangsdaten/shp_Border CH/swissBOUNDARIES3D_1_5_TLM_KANTONSGEBIET.shp")</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ensure geometries are valid</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># swiss_boundaries &lt;- st_make_valid(swiss_boundaries)</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check the CRS of the shapefile</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co"># print(st_crs(swiss_boundaries))</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="co"># # Assuming you have loaded the data into records_N dataframe</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # records_N &lt;- read.csv("path_to_your_data.csv") # Adjust the path accordingly</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="co"># # Filter records by timestamp for the entire month of April 2024</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_N %&gt;%</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(grepl("2024-04", timestamp))</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="co"># # Parse the activity column</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ")</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="co">#          longitude = longitudeE7 / 1e7)</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove activities "Null" and "Still"</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert to spatial dataframe</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a><span class="co"># sf_records_filtered &lt;- st_as_sf(records_filtered, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a><span class="co"># # Transform the CRS of the swiss boundaries to match the records</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="co"># swiss_boundaries &lt;- st_transform(swiss_boundaries, crs = st_crs(sf_records_filtered))</span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a><span class="co"># # Calculate distances between consecutive points</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(dist = distHaversine(cbind(longitude, latitude), cbind(lag(longitude), lag(latitude))) / 1000) %&gt;%</span></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   replace_na(list(dist = 0))  # Replace NA distances with 0</span></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a><span class="co"># # Summarize distance per activity</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(activity1) %&gt;%</span></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE))</span></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create labels for the legend</span></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(activity_distances, by = "activity1") %&gt;%</span></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(legend_label = paste(activity1, round(total_distance, 2), "km"))</span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot using ggplot2</span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = swiss_boundaries, fill = NA, color = "grey50") +</span></span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(data = records_filtered, aes(x = longitude, y = latitude, color = legend_label), size = 2) +</span></span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(data = records_filtered, aes(x = longitude, y = latitude, group = 1, color = legend_label), size = 1) +</span></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Connected Activities and Distances in April 2024", </span></span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a><span class="co">#        fill = "Activity and Distance", </span></span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a><span class="co">#        color = "Activity and Distance")</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="connected-acitivities-and-distances-2023-map" class="level1">
<h1>Connected acitivities and Distances 2023 &gt; Map</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # QUELLE Hintergrundkarte: https://data.dtu.dk/articles/dataset/Shapefile_of_European_countries/23686383</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Verwendung REFNET für Transformation</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># #Load necessary libraries</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # Set SHAPE_RESTORE_SHX config option</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Sys.setenv(SHAPE_RESTORE_SHX = "YES")</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load the Europe boundaries shapefile</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># europe_boundaries &lt;- st_read("C:/Users/A/OneDrive - ZHAW/General/Projektarbeit/Ausgangsdaten/Europe/Europe_merged.shp")</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ensure geometries are valid</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co"># europe_boundaries &lt;- st_make_valid(europe_boundaries)</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check the CRS of the shapefile</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co"># print(st_crs(europe_boundaries))</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="co"># # Assuming you have loaded the data into records_N dataframe</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # records_N &lt;- read.csv("path_to_your_data.csv") # Adjust the path accordingly</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co"># # Filter records by timestamp for the entire month of April 2024</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_N %&gt;%</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(grepl("2023", timestamp))</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="co"># # Parse the activity column</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ")</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a><span class="co">#          longitude = longitudeE7 / 1e7)</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove activities "Null" and "Still"</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert to spatial dataframe</span></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a><span class="co"># sf_records_filtered &lt;- st_as_sf(records_filtered, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a><span class="co"># # Transform the CRS of the Europe boundaries to match the records</span></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a><span class="co"># europe_boundaries &lt;- st_transform(europe_boundaries, crs = st_crs(sf_records_filtered))</span></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a><span class="co"># # Calculate distances between consecutive points</span></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(dist = distHaversine(cbind(longitude, latitude), cbind(lag(longitude), lag(latitude))) / 1000) %&gt;%</span></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   replace_na(list(dist = 0))  # Replace NA distances with 0</span></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a><span class="co"># # Summarize distance per activity</span></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(activity1) %&gt;%</span></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE))</span></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create labels for the legend</span></span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(activity_distances, by = "activity1") %&gt;%</span></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(legend_label = paste(activity1, round(total_distance, 2), "km"))</span></span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot using ggplot2</span></span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = europe_boundaries, fill = NA, color = "grey50") +</span></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(data = records_filtered, aes(x = longitude, y = latitude, color = legend_label), size = 2) +</span></span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(data = records_filtered, aes(x = longitude, y = latitude, group = 1, color = legend_label), size = 1) +</span></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Connected Activities and Distances 2023", </span></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a><span class="co">#        fill = "Activity and Distance", </span></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a><span class="co">#        color = "Activity and Distance")</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="zusammenstellung-karte-europaweit" class="level1">
<h1>Zusammenstellung Karte Europaweit</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load necessary libraries</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scales)</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># library(gridExtra)</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># library(GGally)</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># library(RColorBrewer)</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># library(cluster)</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co"># library(factoextra)</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load the Europe boundaries shapefile</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># europe_boundaries &lt;- st_read("C:/_Data/Master/PaT_24/Projectwork/RProjectwork/cma-project/Hintergrundkarten/Europe/Europe_merged.shp") #Quelle: Technical University of Denmark (2023): Shapefile of European countries. Technical University of Denmark. doi:10.11583/DTU.23686383.v1. [https://data.dtu.dk/articles/dataset/Shapefile_of_European_countries/23686383/1; 17.6.2024].</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ensure geometries are valid</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co"># europe_boundaries &lt;- st_make_valid(europe_boundaries)</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check the CRS of the shapefile</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co"># print(st_crs(europe_boundaries))</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="co"># process_year_data &lt;- function(records_filtered, year_label) {</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Filter records by timestamp for the specified year</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(grepl(year_label, timestamp))</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Parse the activity column</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ")</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a><span class="co">#            longitude = longitudeE7 / 1e7)</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Remove activities "Null" and "Still"</span></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Remove rows with missing latitude or longitude</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!is.na(latitude) &amp; !is.na(longitude))</span></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Further clean the activity1 field</span></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(activity1 = gsub("list\\(activity = \"|\"\\)", "", activity1)) %&gt;%</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(activity1 != "NULL")</span></span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert to spatial dataframe</span></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   sf_records_filtered &lt;- st_as_sf(records_filtered, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Calculate distances between consecutive points</span></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrange(timestamp) %&gt;%</span></span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(</span></span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a><span class="co">#       dist = distHaversine(cbind(longitude, latitude), cbind(lag(longitude), lag(latitude))) / 1000, # Convert to km</span></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a><span class="co">#       timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a><span class="co">#       year = year(timestamp),</span></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a><span class="co">#       month = month(timestamp, label = TRUE, abbr = FALSE), # Monate als Namen</span></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a><span class="co">#       day = wday(timestamp, label = TRUE, abbr = FALSE), # Wochentage als Namen</span></span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a><span class="co">#       hour = hour(timestamp),</span></span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a><span class="co">#       period = time_of_day(hour)</span></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a><span class="co">#     replace_na(list(dist = 0))  # Replace NA distances with 0</span></span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(records_filtered)</span></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a><span class="co"># # Assuming records_N is loaded</span></span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2022 &lt;- process_year_data(records_N, "2022")</span></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2023 &lt;- process_year_data(records_N, "2023")</span></span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2024 &lt;- process_year_data(records_N, "2024")</span></span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a><span class="co"># # Combine all years</span></span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records &lt;- bind_rows(records_2022, records_2023, records_2024)</span></span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a><span class="co"># # Define the order of periods and days</span></span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$period &lt;- factor(all_records$period, levels = c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)"))</span></span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$day &lt;- factor(all_records$day, levels = c("Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag", "Sonntag"))</span></span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a><span class="co"># # Prepare data for clustering</span></span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a><span class="co"># clustering_data &lt;- all_records %&gt;%</span></span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(longitude, latitude, activity1) %&gt;%</span></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(activity1 = as.numeric(factor(activity1)))</span></span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a><span class="co"># # Perform k-means clustering</span></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(123)</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a><span class="co"># kmeans_result &lt;- kmeans(clustering_data[, c("longitude", "latitude")], centers = 5)</span></span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a><span class="co"># # Add cluster information to the data</span></span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$cluster &lt;- factor(kmeans_result$cluster)</span></span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a><span class="co"># # Clustering nach Jahr</span></span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a><span class="co"># clustering_data_year &lt;- all_records %&gt;%</span></span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(longitude, latitude, year)</span></span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(123)</span></span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a><span class="co"># kmeans_result_year &lt;- kmeans(clustering_data_year[, c("longitude", "latitude")], centers = 5)</span></span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a><span class="co"># # Add year cluster information to the data</span></span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$cluster_year &lt;- factor(kmeans_result_year$cluster)</span></span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualize clusters on map with Europe boundaries</span></span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a><span class="co"># p1 &lt;- ggplot() +</span></span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = europe_boundaries, fill = "lightgrey", color = "white") +</span></span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(data = all_records, aes(x = longitude, y = latitude, color = cluster), size = 2, alpha = 0.6) +</span></span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_brewer(palette = "Set3", name = "Cluster der Aktivitäten") +</span></span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Geografische Cluster der Aktivitäten",</span></span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Längengrad",</span></span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Breitengrad"</span></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualize year-based clusters on map with Europe boundaries</span></span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a><span class="co"># p2 &lt;- ggplot() +</span></span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = europe_boundaries, fill = "lightgrey", color = "white") +</span></span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(data = all_records, aes(x = longitude, y = latitude, color = cluster_year), size = 2, alpha = 0.6) +</span></span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_brewer(palette = "Set3", name = "Cluster nach Jahr") +</span></span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Geografische Cluster der Aktivitäten nach Jahr",</span></span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Längengrad",</span></span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Breitengrad"</span></span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a><span class="co"># # Heatmap der Koordinaten nach Aktivität</span></span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a><span class="co"># p3 &lt;- ggplot() +</span></span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = europe_boundaries, fill = "lightgrey", color = "white") +</span></span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile(data = all_records, aes(x = longitude, y = latitude, fill = activity1), size = 5) +</span></span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3", name = "Aktivität") +</span></span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Heatmap der Koordinaten nach Aktivität",</span></span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Längengrad",</span></span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Breitengrad"</span></span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-156"><a href="#cb39-156" aria-hidden="true" tabindex="-1"></a><span class="co"># # Heatmap der Koordinaten nach Jahr</span></span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a><span class="co"># p4 &lt;- ggplot() +</span></span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = europe_boundaries, fill = "lightgrey", color = "white") +</span></span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile(data = all_records, aes(x = longitude, y = latitude, fill = factor(year)), size = 5) +</span></span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3", name = "Jahr") +</span></span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Heatmap der Koordinaten nach Jahr",</span></span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Längengrad",</span></span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Breitengrad"</span></span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a><span class="co"># # Arrange plots in grid</span></span>
<span id="cb39-169"><a href="#cb39-169" aria-hidden="true" tabindex="-1"></a><span class="co"># grid.arrange(</span></span>
<span id="cb39-170"><a href="#cb39-170" aria-hidden="true" tabindex="-1"></a><span class="co">#   p1, p2, p3, p4,</span></span>
<span id="cb39-171"><a href="#cb39-171" aria-hidden="true" tabindex="-1"></a><span class="co">#   ncol = 1</span></span>
<span id="cb39-172"><a href="#cb39-172" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="heatmap-und-cluster-karte-europaweit-nach-aktivitäten" class="level1">
<h1>Heatmap und Cluster Karte Europaweit nach Aktivitäten</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load necessary libraries</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scales)</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># library(gridExtra)</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co"># library(GGally)</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># library(RColorBrewer)</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co"># library(cluster)</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co"># library(factoextra)</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load the Europe boundaries shapefile</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co"># europe_boundaries &lt;- st_read("C:/_Data/Master/PaT_24/Projectwork/RProjectwork/cma-project/Hintergrundkarten/Europe/Europe_merged.shp") #Quelle: Technical University of Denmark (2023): Shapefile of European countries. Technical University of Denmark. doi:10.11583/DTU.23686383.v1. [https://data.dtu.dk/articles/dataset/Shapefile_of_European_countries/23686383/1; 17.6.2024].</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ensure geometries are valid</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="co"># europe_boundaries &lt;- st_make_valid(europe_boundaries)</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check the CRS of the shapefile</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="co"># print(st_crs(europe_boundaries))</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="co"># process_year_data &lt;- function(records_filtered, year_label) {</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Filter records by timestamp for the specified year</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(grepl(year_label, timestamp))</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Parse the activity column</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ")</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a><span class="co">#            longitude = longitudeE7 / 1e7)</span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Remove activities "Null" and "Still"</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Remove rows with missing latitude or longitude</span></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!is.na(latitude) &amp; !is.na(longitude))</span></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Further clean the activity1 field</span></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(activity1 = gsub("list\\(activity = \"|\"\\)", "", activity1)) %&gt;%</span></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(activity1 != "NULL")</span></span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert to spatial dataframe</span></span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   sf_records_filtered &lt;- st_as_sf(records_filtered, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Calculate distances between consecutive points</span></span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrange(timestamp) %&gt;%</span></span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(</span></span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a><span class="co">#       dist = distHaversine(cbind(longitude, latitude), cbind(lag(longitude), lag(latitude))) / 1000, # Convert to km</span></span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a><span class="co">#       timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a><span class="co">#       year = year(timestamp),</span></span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a><span class="co">#       month = month(timestamp, label = TRUE, abbr = FALSE), # Monate als Namen</span></span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a><span class="co">#       day = wday(timestamp, label = TRUE, abbr = FALSE), # Wochentage als Namen</span></span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a><span class="co">#       hour = hour(timestamp),</span></span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a><span class="co">#       period = time_of_day(hour)</span></span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a><span class="co">#     replace_na(list(dist = 0))  # Replace NA distances with 0</span></span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(records_filtered)</span></span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a><span class="co"># # Assuming records_N is loaded</span></span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2022 &lt;- process_year_data(records_N, "2022")</span></span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2023 &lt;- process_year_data(records_N, "2023")</span></span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2024 &lt;- process_year_data(records_N, "2024")</span></span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a><span class="co"># # Combine all years</span></span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records &lt;- bind_rows(records_2022, records_2023, records_2024)</span></span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-95"><a href="#cb40-95" aria-hidden="true" tabindex="-1"></a><span class="co"># # Define the order of periods and days</span></span>
<span id="cb40-96"><a href="#cb40-96" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$period &lt;- factor(all_records$period, levels = c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)"))</span></span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$day &lt;- factor(all_records$day, levels = c("Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag", "Sonntag"))</span></span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true" tabindex="-1"></a><span class="co"># # Filter data to the area with high density of points</span></span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true" tabindex="-1"></a><span class="co"># # Adjust these limits based on your data to zoom in on the area of interest</span></span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true" tabindex="-1"></a><span class="co"># x_limits &lt;- c(-10, 30)</span></span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true" tabindex="-1"></a><span class="co"># y_limits &lt;- c(35, 65)</span></span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true" tabindex="-1"></a><span class="co"># # Heatmap der Koordinaten nach Jahr (gezoomt auf dichten Bereich)</span></span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true" tabindex="-1"></a><span class="co"># p_heatmap_zoom &lt;- ggplot() +</span></span>
<span id="cb40-106"><a href="#cb40-106" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = europe_boundaries, fill = "lightgrey", color = "white") +</span></span>
<span id="cb40-107"><a href="#cb40-107" aria-hidden="true" tabindex="-1"></a><span class="co">#   stat_density2d(data = all_records, aes(x = longitude, y = latitude, fill = after_stat(level), alpha = after_stat(level)), geom = "polygon", contour = TRUE) +</span></span>
<span id="cb40-108"><a href="#cb40-108" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c(option = "inferno", name = "Häufigkeit") +</span></span>
<span id="cb40-109"><a href="#cb40-109" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_alpha(range = c(0.4, 0.8), guide = "none") +</span></span>
<span id="cb40-110"><a href="#cb40-110" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_sf(xlim = x_limits, ylim = y_limits) +</span></span>
<span id="cb40-111"><a href="#cb40-111" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb40-112"><a href="#cb40-112" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Heatmap der Koordinaten über die Jahre (gezoomt)",</span></span>
<span id="cb40-113"><a href="#cb40-113" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Längengrad",</span></span>
<span id="cb40-114"><a href="#cb40-114" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Breitengrad"</span></span>
<span id="cb40-115"><a href="#cb40-115" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb40-116"><a href="#cb40-116" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb40-117"><a href="#cb40-117" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-118"><a href="#cb40-118" aria-hidden="true" tabindex="-1"></a><span class="co"># # Heatmap der Koordinaten nach Jahr und Jahresweise facetting (gezoomt auf dichten Bereich)</span></span>
<span id="cb40-119"><a href="#cb40-119" aria-hidden="true" tabindex="-1"></a><span class="co"># p_heatmap_facet_zoom &lt;- ggplot() +</span></span>
<span id="cb40-120"><a href="#cb40-120" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = europe_boundaries, fill = "lightgrey", color = "white") +</span></span>
<span id="cb40-121"><a href="#cb40-121" aria-hidden="true" tabindex="-1"></a><span class="co">#   stat_density2d(data = all_records, aes(x = longitude, y = latitude, fill = after_stat(level), alpha = after_stat(level)), geom = "polygon", contour = TRUE) +</span></span>
<span id="cb40-122"><a href="#cb40-122" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c(option = "inferno", name = "Häufigkeit") +</span></span>
<span id="cb40-123"><a href="#cb40-123" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_alpha(range = c(0.4, 0.8), guide = "none") +</span></span>
<span id="cb40-124"><a href="#cb40-124" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_sf(xlim = x_limits, ylim = y_limits) +</span></span>
<span id="cb40-125"><a href="#cb40-125" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_wrap(~ year) +</span></span>
<span id="cb40-126"><a href="#cb40-126" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb40-127"><a href="#cb40-127" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Heatmap der Koordinaten nach Jahr (gezoomt)",</span></span>
<span id="cb40-128"><a href="#cb40-128" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Längengrad",</span></span>
<span id="cb40-129"><a href="#cb40-129" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Breitengrad"</span></span>
<span id="cb40-130"><a href="#cb40-130" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb40-131"><a href="#cb40-131" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb40-132"><a href="#cb40-132" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-133"><a href="#cb40-133" aria-hidden="true" tabindex="-1"></a><span class="co"># # Arrange plots in grid</span></span>
<span id="cb40-134"><a href="#cb40-134" aria-hidden="true" tabindex="-1"></a><span class="co"># grid.arrange(</span></span>
<span id="cb40-135"><a href="#cb40-135" aria-hidden="true" tabindex="-1"></a><span class="co">#   p_heatmap_zoom, p_heatmap_facet_zoom,</span></span>
<span id="cb40-136"><a href="#cb40-136" aria-hidden="true" tabindex="-1"></a><span class="co">#   ncol = 1</span></span>
<span id="cb40-137"><a href="#cb40-137" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="karte-europaweit-clustering" class="level1">
<h1>Karte Europaweit Clustering</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load necessary libraries</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dbscan)</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # Set SHAPE_RESTORE_SHX config option</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Sys.setenv(SHAPE_RESTORE_SHX = "YES")</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load the Europe boundaries shapefile</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co"># europe_boundaries &lt;- st_read("C:/_Data/Master/PaT_24/Projectwork/RProjectwork/cma-project/Hintergrundkarten/Europe/Europe_merged.shp")</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ensure geometries are valid</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co"># europe_boundaries &lt;- st_make_valid(europe_boundaries)</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load the data</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co"># # Assuming you have loaded the data into records_N dataframe</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co"># # records_N &lt;- read.csv("path_to_your_data.csv") # Adjust the path accordingly</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # Process data for each year</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="co"># process_data &lt;- function(data, year) {</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   data %&gt;%</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(grepl(as.character(year), timestamp)) %&gt;%</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="co">#            longitude = longitudeE7 / 1e7) %&gt;%</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2022 &lt;- process_data(records_N, 2022)</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2023 &lt;- process_data(records_N, 2023)</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2024 &lt;- process_data(records_N, 2024)</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="co"># # Function to perform clustering and create convex hulls</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a><span class="co"># create_clusters_and_hulls &lt;- function(data) {</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Perform DBSCAN clustering</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   coords &lt;- cbind(data$longitude, data$latitude)</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   clusters &lt;- dbscan(coords, eps = 0.01, minPts = 5)$cluster</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Add clusters to data</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   data$cluster &lt;- clusters</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert to spatial dataframe</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   sf_data &lt;- st_as_sf(data, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Create convex hulls</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   hulls &lt;- sf_data %&gt;%</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="co">#     group_by(cluster) %&gt;%</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="co">#     summarize(geometry = st_union(geometry)) %&gt;%</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a><span class="co">#     st_convex_hull()</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   list(data = data, hulls = hulls)</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="co"># clusters_hulls_2022 &lt;- create_clusters_and_hulls(records_2022)</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="co"># clusters_hulls_2023 &lt;- create_clusters_and_hulls(records_2023)</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a><span class="co"># clusters_hulls_2024 &lt;- create_clusters_and_hulls(records_2024)</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot the data</span></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_data &lt;- function(europe_boundaries, clusters_hulls, year) {</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot() +</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_sf(data = europe_boundaries, fill = NA, color = "grey50") +</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(data = clusters_hulls$data, aes(x = longitude, y = latitude, color = as.factor(cluster)), size = 2) +</span></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_sf(data = clusters_hulls$hulls, fill = NA, color = "blue", linetype = "dashed") +</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme_minimal() +</span></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a><span class="co">#     labs(title = paste("Connected Activities and Distances", year),</span></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a><span class="co">#          fill = "Activity and Distance",</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a><span class="co">#          color = "Cluster")</span></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_2022 &lt;- plot_data(europe_boundaries, clusters_hulls_2022, 2022)</span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_2023 &lt;- plot_data(europe_boundaries, clusters_hulls_2023, 2023)</span></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_2024 &lt;- plot_data(europe_boundaries, clusters_hulls_2024, 2024)</span></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a><span class="co"># # Print plots</span></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a><span class="co"># print(plot_2022)</span></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a><span class="co"># print(plot_2023)</span></span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a><span class="co"># print(plot_2024)</span></span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="zurückgelegte-distanztageszeitmonat_nur-pro-monat_pro-monat-und-aktivität-2022-diagramme" class="level1">
<h1>Zurückgelegte Distanz/Tageszeit+Monat_nur Pro Monat_pro Monat und Aktivität (2022) &gt; Diagramme</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load necessary libraries</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scales)</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # Filter records by timestamp for the year 2022,2023, 2024</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_N %&gt;%</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(Year = year(ymd_hms(timestamp))) %&gt;%</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(Year %in% c(2022, 2023, 2024))</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="co"># # Parse the activity column</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ")</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="co">#          longitude = longitudeE7 / 1e7)</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove activities "Null" and "Still"</span></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove rows with missing latitude or longitude</span></span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(latitude) &amp; !is.na(longitude))</span></span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert to spatial dataframe</span></span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a><span class="co"># sf_records_filtered &lt;- st_as_sf(records_filtered, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a><span class="co"># # Calculate distances between consecutive points</span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a><span class="co">#     dist = distHaversine(cbind(longitude, latitude), cbind(lag(longitude), lag(latitude))) / 1000, # Convert to km</span></span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a><span class="co">#     year = year(timestamp),</span></span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp, label = TRUE, abbr = FALSE), # Monate als Namen</span></span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour = hour(timestamp),</span></span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a><span class="co">#     period = time_of_day(hour)</span></span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   replace_na(list(dist = 0))  # Replace NA distances with 0</span></span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a><span class="co"># # Summarize distance per activity and per month</span></span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(activity1) %&gt;%</span></span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE))</span></span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a><span class="co"># month_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month, Year) %&gt;%</span></span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE)) |&gt; </span></span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!(Year == 2024 &amp; month == "Juni"))</span></span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_month_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month, activity1) %&gt;%</span></span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create labels for the legend</span></span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(activity_distances, by = "activity1") %&gt;%</span></span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(legend_label = paste(activity1, round(total_distance, 2), "km"))</span></span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reihenfolge der Tageszeiten definieren</span></span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a><span class="co"># levels_order &lt;- c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)")</span></span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered$period &lt;- factor(records_filtered$period, levels = levels_order)</span></span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a><span class="co"># # Datenanalyse für die zurückgelegte Distanz nach Tageszeit und Monat</span></span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a><span class="co"># month_period_distance &lt;- records_filtered %&gt;%</span></span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month, period) %&gt;%</span></span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der zurückgelegten Distanz pro Tageszeit und Monat als Flächendiagramm</span></span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(month_period_distance, aes(x = period, y = total_distance, fill = month, group = month)) +</span></span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_area(position = 'stack', alpha = 0.6) +</span></span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Zurückgelegte Distanz pro Tageszeit und Monat (2022)",</span></span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Aufgeteilt nach Morgen, Mittag, Nachmittag, Abend und Nacht",</span></span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Monat"</span></span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-108"><a href="#cb42-108" aria-hidden="true" tabindex="-1"></a><span class="co"># month_distances</span></span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a><span class="co"># ##### Visualisierung der zurückgelegten Distanz pro Monat als Balkendiagramm - verwendet in Arbeit</span></span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a><span class="co"># balken_year &lt;-</span></span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(month_distances, aes(x = month, y = total_distance, fill = month)) +</span></span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity") +</span></span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Zurückgelegte Distanz pro Monat und Jahr",</span></span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Monat"</span></span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(</span></span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a><span class="co">#     axis.text.x = element_blank(),  # Entfernt die x-Achsen-Beschriftungen</span></span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a><span class="co">#     axis.title.x = element_blank(),  # Entfernt den Titel der x-Achse</span></span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Optional: Dreht die y-Achsen-Beschriftungen</span></span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(limits = c(0, 7000), breaks = seq(0, 7000, by = 1000)) + # Setzt den Bereich und die Beschriftungen der y-Achse</span></span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid( . ~Year)</span></span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a><span class="co"># print(balken_year)</span></span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der zurückgelegten Distanz pro Monat und Aktivität als gestapeltes Balkendiagramm</span></span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(activity_month_distances, aes(x = month, y = total_distance, fill = activity1)) +</span></span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity", position = "stack") +</span></span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Zurückgelegte Distanz pro Monat und Aktivität (2022)",</span></span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Aktivität"</span></span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="zurückgelegte-distanztageszeitmonat_nur-pro-monat_pro-monat-und-aktivität-2023-diagramme" class="level1">
<h1>Zurückgelegte Distanz/Tageszeit+Monat_nur Pro Monat_pro Monat und Aktivität (2023) &gt; Diagramme</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load necessary libraries</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scales)</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # Filter records by timestamp for the year 2023</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_N %&gt;%</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(grepl("2023", timestamp))</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # Parse the activity column</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ")</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="co">#          longitude = longitudeE7 / 1e7)</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove activities "Null" and "Still"</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert to spatial dataframe</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="co"># sf_records_filtered &lt;- st_as_sf(records_filtered, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a><span class="co"># # Calculate distances between consecutive points</span></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="co">#     dist = distHaversine(cbind(longitude, latitude), cbind(lag(longitude), lag(latitude))) / 1000, # Convert to km</span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a><span class="co">#     year = year(timestamp),</span></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp, label = TRUE, abbr = FALSE), # Monate als Namen</span></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour = hour(timestamp),</span></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a><span class="co">#     period = time_of_day(hour)</span></span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   replace_na(list(dist = 0))  # Replace NA distances with 0</span></span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a><span class="co"># # Summarize distance per activity and per month</span></span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(activity1) %&gt;%</span></span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE))</span></span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a><span class="co"># month_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month) %&gt;%</span></span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE))</span></span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_month_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month, activity1) %&gt;%</span></span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create labels for the legend</span></span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(activity_distances, by = "activity1") %&gt;%</span></span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(legend_label = paste(activity1, round(total_distance, 2), "km"))</span></span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reihenfolge der Tageszeiten definieren</span></span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a><span class="co"># levels_order &lt;- c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)")</span></span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered$period &lt;- factor(records_filtered$period, levels = levels_order)</span></span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a><span class="co"># # Datenanalyse für die zurückgelegte Distanz nach Tageszeit und Monat</span></span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a><span class="co"># month_period_distance &lt;- records_filtered %&gt;%</span></span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month, period) %&gt;%</span></span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der zurückgelegten Distanz pro Tageszeit und Monat als Flächendiagramm</span></span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(month_period_distance, aes(x = period, y = total_distance, fill = month, group = month)) +</span></span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_area(position = 'stack', alpha = 0.6) +</span></span>
<span id="cb43-87"><a href="#cb43-87" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb43-88"><a href="#cb43-88" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Zurückgelegte Distanz pro Tageszeit und Monat (2023)",</span></span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Aufgeteilt nach Morgen, Mittag, Nachmittag, Abend und Nacht",</span></span>
<span id="cb43-91"><a href="#cb43-91" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Tageszeit",</span></span>
<span id="cb43-92"><a href="#cb43-92" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Monat"</span></span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der zurückgelegten Distanz pro Monat als Balkendiagramm</span></span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(month_distances, aes(x = month, y = total_distance, fill = month)) +</span></span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity") +</span></span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb43-102"><a href="#cb43-102" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb43-103"><a href="#cb43-103" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Zurückgelegte Distanz pro Monat (2023)",</span></span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb43-106"><a href="#cb43-106" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Monat"</span></span>
<span id="cb43-107"><a href="#cb43-107" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb43-110"><a href="#cb43-110" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-111"><a href="#cb43-111" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der zurückgelegten Distanz pro Monat und Aktivität als gestapeltes Balkendiagramm</span></span>
<span id="cb43-112"><a href="#cb43-112" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(activity_month_distances, aes(x = month, y = total_distance, fill = activity1)) +</span></span>
<span id="cb43-113"><a href="#cb43-113" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity", position = "stack") +</span></span>
<span id="cb43-114"><a href="#cb43-114" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb43-115"><a href="#cb43-115" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb43-116"><a href="#cb43-116" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Zurückgelegte Distanz pro Monat und Aktivität (2023)",</span></span>
<span id="cb43-117"><a href="#cb43-117" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb43-118"><a href="#cb43-118" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb43-119"><a href="#cb43-119" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Aktivität"</span></span>
<span id="cb43-120"><a href="#cb43-120" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb43-121"><a href="#cb43-121" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb43-122"><a href="#cb43-122" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb43-123"><a href="#cb43-123" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-124"><a href="#cb43-124" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="zurückgelegte-distanztageszeitmonat_nur-pro-monat_pro-monat-und-aktivität-2024-diagramme" class="level1">
<h1>Zurückgelegte Distanz/Tageszeit+Monat_nur Pro Monat_pro Monat und Aktivität (2024) &gt; Diagramme</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load necessary libraries</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scales)</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # Filter records by timestamp for the year 2024</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_N %&gt;%</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(grepl("2024", timestamp))</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # Parse the activity column</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ")</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a><span class="co">#          longitude = longitudeE7 / 1e7)</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove activities "Null" and "Still"</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove rows with missing latitude or longitude</span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(latitude) &amp; !is.na(longitude))</span></span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert to spatial dataframe</span></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a><span class="co"># sf_records_filtered &lt;- st_as_sf(records_filtered, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a><span class="co"># # Calculate distances between consecutive points</span></span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a><span class="co">#     dist = distHaversine(cbind(longitude, latitude), cbind(lag(longitude), lag(latitude))) / 1000, # Convert to km</span></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a><span class="co">#     year = year(timestamp),</span></span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp, label = TRUE, abbr = FALSE), # Monate als Namen</span></span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour = hour(timestamp),</span></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a><span class="co">#     period = time_of_day(hour)</span></span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   replace_na(list(dist = 0))  # Replace NA distances with 0</span></span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a><span class="co"># # Summarize distance per activity and per month</span></span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(activity1) %&gt;%</span></span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE))</span></span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a><span class="co"># month_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month) %&gt;%</span></span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE))</span></span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_month_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month, activity1) %&gt;%</span></span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create labels for the legend</span></span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(activity_distances, by = "activity1") %&gt;%</span></span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(legend_label = paste(activity1, round(total_distance, 2), "km"))</span></span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reihenfolge der Tageszeiten definieren</span></span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a><span class="co"># levels_order &lt;- c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)")</span></span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered$period &lt;- factor(records_filtered$period, levels = levels_order)</span></span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a><span class="co"># # Datenanalyse für die zurückgelegte Distanz nach Tageszeit und Monat</span></span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a><span class="co"># month_period_distance &lt;- records_filtered %&gt;%</span></span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month, period) %&gt;%</span></span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb44-87"><a href="#cb44-87" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der zurückgelegten Distanz pro Tageszeit und Monat als Flächendiagramm</span></span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(month_period_distance, aes(x = period, y = total_distance, fill = month, group = month)) +</span></span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_area(position = 'stack', alpha = 0.6) +</span></span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Zurückgelegte Distanz pro Tageszeit und Monat (2024)",</span></span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Aufgeteilt nach Morgen, Mittag, Nachmittag, Abend und Nacht",</span></span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Tageszeit",</span></span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Monat"</span></span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der zurückgelegten Distanz pro Monat als Balkendiagramm</span></span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(month_distances, aes(x = month, y = total_distance, fill = month)) +</span></span>
<span id="cb44-104"><a href="#cb44-104" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity") +</span></span>
<span id="cb44-105"><a href="#cb44-105" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Zurückgelegte Distanz pro Monat (2024)",</span></span>
<span id="cb44-108"><a href="#cb44-108" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb44-109"><a href="#cb44-109" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Monat"</span></span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der zurückgelegten Distanz pro Monat und Aktivität als gestapeltes Balkendiagramm</span></span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(activity_month_distances, aes(x = month, y = total_distance, fill = activity1)) +</span></span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity", position = "stack") +</span></span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb44-120"><a href="#cb44-120" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Zurückgelegte Distanz pro Monat und Aktivität (2024)",</span></span>
<span id="cb44-121"><a href="#cb44-121" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb44-122"><a href="#cb44-122" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb44-123"><a href="#cb44-123" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Aktivität"</span></span>
<span id="cb44-124"><a href="#cb44-124" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb44-125"><a href="#cb44-125" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb44-126"><a href="#cb44-126" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb44-127"><a href="#cb44-127" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="zusammenstellung-zurückgelegte-distanztageszeitmonat_nur-pro-monat_pro-monat-und-aktivität-2022-2014-diagramme-a" class="level1">
<h1>Zusammenstellung Zurückgelegte Distanz/Tageszeit+Monat_nur Pro Monat_pro Monat und Aktivität (2022-2014) &gt; Diagramme A</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load necessary libraries</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scales)</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co"># library(gridExtra)</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_distance_per_time_of_day_and_month &lt;- function(records_filtered, year_label) {</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Filter records by timestamp for the specified year</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(grepl(year_label, timestamp))</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Parse the activity column</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ")</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a><span class="co">#            longitude = longitudeE7 / 1e7)</span></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Remove activities "Null" and "Still"</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Remove rows with missing latitude or longitude</span></span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!is.na(latitude) &amp; !is.na(longitude))</span></span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert to spatial dataframe</span></span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   sf_records_filtered &lt;- st_as_sf(records_filtered, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Calculate distances between consecutive points</span></span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrange(timestamp) %&gt;%</span></span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(</span></span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a><span class="co">#       dist = distHaversine(cbind(longitude, latitude), cbind(lag(longitude), lag(latitude))) / 1000, # Convert to km</span></span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a><span class="co">#       timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a><span class="co">#       year = year(timestamp),</span></span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a><span class="co">#       month = month(timestamp, label = TRUE, abbr = FALSE), # Monate als Namen</span></span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a><span class="co">#       hour = hour(timestamp),</span></span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a><span class="co">#       period = time_of_day(hour)</span></span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a><span class="co">#     replace_na(list(dist = 0))  # Replace NA distances with 0</span></span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Reorder periods</span></span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered$period &lt;- factor(records_filtered$period, levels = c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)"))</span></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Datenanalyse für die zurückgelegte Distanz nach Tageszeit und Monat</span></span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   month_period_distance &lt;- records_filtered %&gt;%</span></span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a><span class="co">#     group_by(month, period) %&gt;%</span></span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a><span class="co">#     summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Visualisierung der zurückgelegten Distanz pro Tageszeit und Monat als Flächendiagramm</span></span>
<span id="cb45-72"><a href="#cb45-72" aria-hidden="true" tabindex="-1"></a><span class="co">#   p1 &lt;- ggplot(month_period_distance, aes(x = period, y = total_distance, fill = month, group = month)) +</span></span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_area(position = 'stack', alpha = 0.6) +</span></span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a><span class="co">#     scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a><span class="co">#     labs(</span></span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a><span class="co">#       title = paste("Zurückgelegte Distanz pro Tageszeit und Monat (", year_label, ")", sep = ""),</span></span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a><span class="co">#       subtitle = "Aufgeteilt nach Morgen, Mittag, Nachmittag, Abend und Nacht",</span></span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a><span class="co">#       x = "Tageszeit",</span></span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a><span class="co">#       y = "Distanz (km)",</span></span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a><span class="co">#       fill = "Monat"</span></span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a><span class="co">#     ) +</span></span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme_minimal() +</span></span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Summarize distance per month</span></span>
<span id="cb45-86"><a href="#cb45-86" aria-hidden="true" tabindex="-1"></a><span class="co">#   month_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb45-87"><a href="#cb45-87" aria-hidden="true" tabindex="-1"></a><span class="co">#     group_by(month) %&gt;%</span></span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a><span class="co">#     summarize(total_distance = sum(dist, na.rm = TRUE))</span></span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Visualisierung der zurückgelegten Distanz pro Monat als Balkendiagramm</span></span>
<span id="cb45-91"><a href="#cb45-91" aria-hidden="true" tabindex="-1"></a><span class="co">#   p2 &lt;- ggplot(month_distances, aes(x = month, y = total_distance, fill = month)) +</span></span>
<span id="cb45-92"><a href="#cb45-92" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_bar(stat = "identity") +</span></span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a><span class="co">#     scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a><span class="co">#     labs(</span></span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a><span class="co">#       title = paste("Zurückgelegte Distanz pro Monat (", year_label, ")", sep = ""),</span></span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a><span class="co">#       x = "Monat",</span></span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a><span class="co">#       y = "Distanz (km)",</span></span>
<span id="cb45-98"><a href="#cb45-98" aria-hidden="true" tabindex="-1"></a><span class="co">#       fill = "Monat"</span></span>
<span id="cb45-99"><a href="#cb45-99" aria-hidden="true" tabindex="-1"></a><span class="co">#     ) +</span></span>
<span id="cb45-100"><a href="#cb45-100" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme_minimal() +</span></span>
<span id="cb45-101"><a href="#cb45-101" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb45-102"><a href="#cb45-102" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-103"><a href="#cb45-103" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Summarize distance per activity and per month</span></span>
<span id="cb45-104"><a href="#cb45-104" aria-hidden="true" tabindex="-1"></a><span class="co">#   activity_month_distances &lt;- records_filtered %&gt;%</span></span>
<span id="cb45-105"><a href="#cb45-105" aria-hidden="true" tabindex="-1"></a><span class="co">#     group_by(month, activity1) %&gt;%</span></span>
<span id="cb45-106"><a href="#cb45-106" aria-hidden="true" tabindex="-1"></a><span class="co">#     summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb45-107"><a href="#cb45-107" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-108"><a href="#cb45-108" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Visualisierung der zurückgelegten Distanz pro Monat und Aktivität als gestapeltes Balkendiagramm</span></span>
<span id="cb45-109"><a href="#cb45-109" aria-hidden="true" tabindex="-1"></a><span class="co">#   p3 &lt;- ggplot(activity_month_distances, aes(x = month, y = total_distance, fill = activity1)) +</span></span>
<span id="cb45-110"><a href="#cb45-110" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_bar(stat = "identity", position = "stack") +</span></span>
<span id="cb45-111"><a href="#cb45-111" aria-hidden="true" tabindex="-1"></a><span class="co">#     scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb45-112"><a href="#cb45-112" aria-hidden="true" tabindex="-1"></a><span class="co">#     labs(</span></span>
<span id="cb45-113"><a href="#cb45-113" aria-hidden="true" tabindex="-1"></a><span class="co">#       title = paste("Zurückgelegte Distanz pro Monat und Aktivität (", year_label, ")", sep = ""),</span></span>
<span id="cb45-114"><a href="#cb45-114" aria-hidden="true" tabindex="-1"></a><span class="co">#       x = "Monat",</span></span>
<span id="cb45-115"><a href="#cb45-115" aria-hidden="true" tabindex="-1"></a><span class="co">#       y = "Distanz (km)",</span></span>
<span id="cb45-116"><a href="#cb45-116" aria-hidden="true" tabindex="-1"></a><span class="co">#       fill = "Aktivität"</span></span>
<span id="cb45-117"><a href="#cb45-117" aria-hidden="true" tabindex="-1"></a><span class="co">#     ) +</span></span>
<span id="cb45-118"><a href="#cb45-118" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme_minimal() +</span></span>
<span id="cb45-119"><a href="#cb45-119" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb45-120"><a href="#cb45-120" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb45-121"><a href="#cb45-121" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(list(p1, p2, p3))</span></span>
<span id="cb45-122"><a href="#cb45-122" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb45-123"><a href="#cb45-123" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb45-124"><a href="#cb45-124" aria-hidden="true" tabindex="-1"></a><span class="co"># # Assuming records_N is loaded</span></span>
<span id="cb45-125"><a href="#cb45-125" aria-hidden="true" tabindex="-1"></a><span class="co"># plots_2022 &lt;- plot_distance_per_time_of_day_and_month(records_N, "2022")</span></span>
<span id="cb45-126"><a href="#cb45-126" aria-hidden="true" tabindex="-1"></a><span class="co"># plots_2023 &lt;- plot_distance_per_time_of_day_and_month(records_N, "2023")</span></span>
<span id="cb45-127"><a href="#cb45-127" aria-hidden="true" tabindex="-1"></a><span class="co"># plots_2024 &lt;- plot_distance_per_time_of_day_and_month(records_N, "2024")</span></span>
<span id="cb45-128"><a href="#cb45-128" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb45-129"><a href="#cb45-129" aria-hidden="true" tabindex="-1"></a><span class="co"># # Arrange plots in grid</span></span>
<span id="cb45-130"><a href="#cb45-130" aria-hidden="true" tabindex="-1"></a><span class="co"># grid.arrange(</span></span>
<span id="cb45-131"><a href="#cb45-131" aria-hidden="true" tabindex="-1"></a><span class="co">#   grobs = c(plots_2022, plots_2023, plots_2024),</span></span>
<span id="cb45-132"><a href="#cb45-132" aria-hidden="true" tabindex="-1"></a><span class="co">#   ncol = 3</span></span>
<span id="cb45-133"><a href="#cb45-133" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>#Auswertungen einfache</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load necessary libraries</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scales)</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># library(gridExtra)</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co"># library(GGally)</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># library(RColorBrewer)</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="co"># process_year_data &lt;- function(records_filtered, year_label) {</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Filter records by timestamp for the specified year</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(grepl(year_label, timestamp))</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Parse the activity column</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ")</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a><span class="co">#            longitude = longitudeE7 / 1e7)</span></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Remove activities "Null" and "Still"</span></span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Remove rows with missing latitude or longitude</span></span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!is.na(latitude) &amp; !is.na(longitude))</span></span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert to spatial dataframe</span></span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   sf_records_filtered &lt;- st_as_sf(records_filtered, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Calculate distances between consecutive points</span></span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrange(timestamp) %&gt;%</span></span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(</span></span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a><span class="co">#       dist = distHaversine(cbind(longitude, latitude), cbind(lag(longitude), lag(latitude))) / 1000, # Convert to km</span></span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a><span class="co">#       timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a><span class="co">#       year = year(timestamp),</span></span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true" tabindex="-1"></a><span class="co">#       month = month(timestamp, label = TRUE, abbr = FALSE), # Monate als Namen</span></span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true" tabindex="-1"></a><span class="co">#       hour = hour(timestamp),</span></span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true" tabindex="-1"></a><span class="co">#       period = time_of_day(hour)</span></span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true" tabindex="-1"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true" tabindex="-1"></a><span class="co">#     replace_na(list(dist = 0))  # Replace NA distances with 0</span></span>
<span id="cb46-64"><a href="#cb46-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb46-65"><a href="#cb46-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(records_filtered)</span></span>
<span id="cb46-66"><a href="#cb46-66" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb46-67"><a href="#cb46-67" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-68"><a href="#cb46-68" aria-hidden="true" tabindex="-1"></a><span class="co"># # Assuming records_N is loaded</span></span>
<span id="cb46-69"><a href="#cb46-69" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2022 &lt;- process_year_data(records_N, "2022")</span></span>
<span id="cb46-70"><a href="#cb46-70" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2023 &lt;- process_year_data(records_N, "2023")</span></span>
<span id="cb46-71"><a href="#cb46-71" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2024 &lt;- process_year_data(records_N, "2024")</span></span>
<span id="cb46-72"><a href="#cb46-72" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-73"><a href="#cb46-73" aria-hidden="true" tabindex="-1"></a><span class="co"># # Combine all years</span></span>
<span id="cb46-74"><a href="#cb46-74" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records &lt;- bind_rows(records_2022, records_2023, records_2024)</span></span>
<span id="cb46-75"><a href="#cb46-75" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-76"><a href="#cb46-76" aria-hidden="true" tabindex="-1"></a><span class="co"># # Define the order of periods</span></span>
<span id="cb46-77"><a href="#cb46-77" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$period &lt;- factor(all_records$period, levels = c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)"))</span></span>
<span id="cb46-78"><a href="#cb46-78" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-79"><a href="#cb46-79" aria-hidden="true" tabindex="-1"></a><span class="co"># # Analyse Verteilung, Korrelation und Trend</span></span>
<span id="cb46-80"><a href="#cb46-80" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-81"><a href="#cb46-81" aria-hidden="true" tabindex="-1"></a><span class="co"># # Verteilung der zurückgelegten Distanz nach Tageszeit und Jahr</span></span>
<span id="cb46-82"><a href="#cb46-82" aria-hidden="true" tabindex="-1"></a><span class="co"># dist_by_period_year &lt;- all_records %&gt;%</span></span>
<span id="cb46-83"><a href="#cb46-83" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, period) %&gt;%</span></span>
<span id="cb46-84"><a href="#cb46-84" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb46-85"><a href="#cb46-85" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-86"><a href="#cb46-86" aria-hidden="true" tabindex="-1"></a><span class="co"># p1 &lt;- ggplot(dist_by_period_year, aes(x = period, y = total_distance, fill = factor(year))) +</span></span>
<span id="cb46-87"><a href="#cb46-87" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity", position = "dodge") +</span></span>
<span id="cb46-88"><a href="#cb46-88" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb46-89"><a href="#cb46-89" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb46-90"><a href="#cb46-90" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Verteilung der zurückgelegten Distanz nach Tageszeit und Jahr",</span></span>
<span id="cb46-91"><a href="#cb46-91" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Tageszeit",</span></span>
<span id="cb46-92"><a href="#cb46-92" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb46-93"><a href="#cb46-93" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Jahr"</span></span>
<span id="cb46-94"><a href="#cb46-94" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb46-95"><a href="#cb46-95" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb46-96"><a href="#cb46-96" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb46-97"><a href="#cb46-97" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-98"><a href="#cb46-98" aria-hidden="true" tabindex="-1"></a><span class="co"># # Verteilung der zurückgelegten Distanz nach Monat und Jahr</span></span>
<span id="cb46-99"><a href="#cb46-99" aria-hidden="true" tabindex="-1"></a><span class="co"># dist_by_month_year &lt;- all_records %&gt;%</span></span>
<span id="cb46-100"><a href="#cb46-100" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, month) %&gt;%</span></span>
<span id="cb46-101"><a href="#cb46-101" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb46-102"><a href="#cb46-102" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-103"><a href="#cb46-103" aria-hidden="true" tabindex="-1"></a><span class="co"># p2 &lt;- ggplot(dist_by_month_year, aes(x = month, y = total_distance, fill = factor(year))) +</span></span>
<span id="cb46-104"><a href="#cb46-104" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity", position = "dodge") +</span></span>
<span id="cb46-105"><a href="#cb46-105" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb46-106"><a href="#cb46-106" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb46-107"><a href="#cb46-107" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Verteilung der zurückgelegten Distanz nach Monat und Jahr",</span></span>
<span id="cb46-108"><a href="#cb46-108" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb46-109"><a href="#cb46-109" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb46-110"><a href="#cb46-110" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Jahr"</span></span>
<span id="cb46-111"><a href="#cb46-111" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb46-112"><a href="#cb46-112" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb46-113"><a href="#cb46-113" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb46-114"><a href="#cb46-114" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-115"><a href="#cb46-115" aria-hidden="true" tabindex="-1"></a><span class="co"># # Korrelation zwischen Monat und zurückgelegter Distanz für jedes Jahr</span></span>
<span id="cb46-116"><a href="#cb46-116" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_by_year &lt;- all_records %&gt;%</span></span>
<span id="cb46-117"><a href="#cb46-117" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, month) %&gt;%</span></span>
<span id="cb46-118"><a href="#cb46-118" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop') %&gt;%</span></span>
<span id="cb46-119"><a href="#cb46-119" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year) %&gt;%</span></span>
<span id="cb46-120"><a href="#cb46-120" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(correlation = cor(as.numeric(month), total_distance))</span></span>
<span id="cb46-121"><a href="#cb46-121" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-122"><a href="#cb46-122" aria-hidden="true" tabindex="-1"></a><span class="co"># p3 &lt;- ggplot(cor_by_year, aes(x = factor(year), y = correlation, color = factor(year), group = 1)) +</span></span>
<span id="cb46-123"><a href="#cb46-123" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(size = 1.5) +</span></span>
<span id="cb46-124"><a href="#cb46-124" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(size = 4) +</span></span>
<span id="cb46-125"><a href="#cb46-125" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_brewer(palette = "Set3") +</span></span>
<span id="cb46-126"><a href="#cb46-126" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb46-127"><a href="#cb46-127" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Korrelation zwischen Monat und zurückgelegter Distanz",</span></span>
<span id="cb46-128"><a href="#cb46-128" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahr",</span></span>
<span id="cb46-129"><a href="#cb46-129" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Korrelation",</span></span>
<span id="cb46-130"><a href="#cb46-130" aria-hidden="true" tabindex="-1"></a><span class="co">#     color = "Jahr"</span></span>
<span id="cb46-131"><a href="#cb46-131" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb46-132"><a href="#cb46-132" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb46-133"><a href="#cb46-133" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-134"><a href="#cb46-134" aria-hidden="true" tabindex="-1"></a><span class="co"># # Korrelation zwischen Tageszeit und zurückgelegter Distanz für jedes Jahr</span></span>
<span id="cb46-135"><a href="#cb46-135" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_period_by_year &lt;- all_records %&gt;%</span></span>
<span id="cb46-136"><a href="#cb46-136" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, period) %&gt;%</span></span>
<span id="cb46-137"><a href="#cb46-137" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop') %&gt;%</span></span>
<span id="cb46-138"><a href="#cb46-138" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year) %&gt;%</span></span>
<span id="cb46-139"><a href="#cb46-139" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(correlation = cor(as.numeric(as.factor(period)), total_distance))</span></span>
<span id="cb46-140"><a href="#cb46-140" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-141"><a href="#cb46-141" aria-hidden="true" tabindex="-1"></a><span class="co"># p4 &lt;- ggplot(cor_period_by_year, aes(x = factor(year), y = correlation, color = factor(year), group = 1)) +</span></span>
<span id="cb46-142"><a href="#cb46-142" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(size = 1.5) +</span></span>
<span id="cb46-143"><a href="#cb46-143" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(size = 4) +</span></span>
<span id="cb46-144"><a href="#cb46-144" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_brewer(palette = "Set3") +</span></span>
<span id="cb46-145"><a href="#cb46-145" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb46-146"><a href="#cb46-146" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Korrelation zwischen Tageszeit und zurückgelegter Distanz",</span></span>
<span id="cb46-147"><a href="#cb46-147" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahr",</span></span>
<span id="cb46-148"><a href="#cb46-148" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Korrelation",</span></span>
<span id="cb46-149"><a href="#cb46-149" aria-hidden="true" tabindex="-1"></a><span class="co">#     color = "Jahr"</span></span>
<span id="cb46-150"><a href="#cb46-150" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb46-151"><a href="#cb46-151" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb46-152"><a href="#cb46-152" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-153"><a href="#cb46-153" aria-hidden="true" tabindex="-1"></a><span class="co"># # Trendanalyse der zurückgelegten Distanz über die Monate hinweg (2024) mit linearer Regression</span></span>
<span id="cb46-154"><a href="#cb46-154" aria-hidden="true" tabindex="-1"></a><span class="co"># trend_2024 &lt;- records_2024 %&gt;%</span></span>
<span id="cb46-155"><a href="#cb46-155" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month) %&gt;%</span></span>
<span id="cb46-156"><a href="#cb46-156" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb46-157"><a href="#cb46-157" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-158"><a href="#cb46-158" aria-hidden="true" tabindex="-1"></a><span class="co"># p5 &lt;- ggplot(trend_2024, aes(x = as.numeric(month), y = total_distance)) +</span></span>
<span id="cb46-159"><a href="#cb46-159" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point() +</span></span>
<span id="cb46-160"><a href="#cb46-160" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_smooth(method = "lm", se = FALSE, color = "blue") +</span></span>
<span id="cb46-161"><a href="#cb46-161" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb46-162"><a href="#cb46-162" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Trend der zurückgelegten Distanz über die Monate hinweg (2024)",</span></span>
<span id="cb46-163"><a href="#cb46-163" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb46-164"><a href="#cb46-164" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)"</span></span>
<span id="cb46-165"><a href="#cb46-165" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb46-166"><a href="#cb46-166" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb46-167"><a href="#cb46-167" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-168"><a href="#cb46-168" aria-hidden="true" tabindex="-1"></a><span class="co"># # Gesamt-Korrelation zwischen Monat und zurückgelegter Distanz (2022-2024)</span></span>
<span id="cb46-169"><a href="#cb46-169" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_overall_month &lt;- all_records %&gt;%</span></span>
<span id="cb46-170"><a href="#cb46-170" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month) %&gt;%</span></span>
<span id="cb46-171"><a href="#cb46-171" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop') %&gt;%</span></span>
<span id="cb46-172"><a href="#cb46-172" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(correlation = cor(as.numeric(month), total_distance))</span></span>
<span id="cb46-173"><a href="#cb46-173" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-174"><a href="#cb46-174" aria-hidden="true" tabindex="-1"></a><span class="co"># p6 &lt;- ggplot(cor_overall_month, aes(x = 1, y = correlation)) +</span></span>
<span id="cb46-175"><a href="#cb46-175" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(size = 4) +</span></span>
<span id="cb46-176"><a href="#cb46-176" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = NULL) +</span></span>
<span id="cb46-177"><a href="#cb46-177" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb46-178"><a href="#cb46-178" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Gesamt-Korrelation zwischen Monat und zurückgelegter Distanz (2022-2024)",</span></span>
<span id="cb46-179"><a href="#cb46-179" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "",</span></span>
<span id="cb46-180"><a href="#cb46-180" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Korrelation"</span></span>
<span id="cb46-181"><a href="#cb46-181" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb46-182"><a href="#cb46-182" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb46-183"><a href="#cb46-183" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-184"><a href="#cb46-184" aria-hidden="true" tabindex="-1"></a><span class="co"># # Korrelation zwischen Art der Aktivität und zurückgelegter Distanz für jedes Jahr</span></span>
<span id="cb46-185"><a href="#cb46-185" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_activity_by_year &lt;- all_records %&gt;%</span></span>
<span id="cb46-186"><a href="#cb46-186" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, activity1) %&gt;%</span></span>
<span id="cb46-187"><a href="#cb46-187" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop') %&gt;%</span></span>
<span id="cb46-188"><a href="#cb46-188" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year) %&gt;%</span></span>
<span id="cb46-189"><a href="#cb46-189" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(correlation = cor(as.numeric(as.factor(activity1)), total_distance))</span></span>
<span id="cb46-190"><a href="#cb46-190" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-191"><a href="#cb46-191" aria-hidden="true" tabindex="-1"></a><span class="co"># p7 &lt;- ggplot(cor_activity_by_year, aes(x = factor(year), y = correlation, color = factor(year), group = 1)) +</span></span>
<span id="cb46-192"><a href="#cb46-192" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(size = 1.5) +</span></span>
<span id="cb46-193"><a href="#cb46-193" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(size = 4) +</span></span>
<span id="cb46-194"><a href="#cb46-194" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_brewer(palette = "Set3") +</span></span>
<span id="cb46-195"><a href="#cb46-195" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb46-196"><a href="#cb46-196" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Korrelation zwischen Art der Aktivität und zurückgelegter Distanz",</span></span>
<span id="cb46-197"><a href="#cb46-197" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahr",</span></span>
<span id="cb46-198"><a href="#cb46-198" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Korrelation",</span></span>
<span id="cb46-199"><a href="#cb46-199" aria-hidden="true" tabindex="-1"></a><span class="co">#     color = "Jahr"</span></span>
<span id="cb46-200"><a href="#cb46-200" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb46-201"><a href="#cb46-201" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb46-202"><a href="#cb46-202" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-203"><a href="#cb46-203" aria-hidden="true" tabindex="-1"></a><span class="co"># # Gesamt-Korrelation zwischen Art der Aktivität und zurückgelegter Distanz (2022-2024)</span></span>
<span id="cb46-204"><a href="#cb46-204" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_overall_activity &lt;- all_records %&gt;%</span></span>
<span id="cb46-205"><a href="#cb46-205" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(activity1) %&gt;%</span></span>
<span id="cb46-206"><a href="#cb46-206" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop') %&gt;%</span></span>
<span id="cb46-207"><a href="#cb46-207" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(correlation = cor(as.numeric(as.factor(activity1)), total_distance))</span></span>
<span id="cb46-208"><a href="#cb46-208" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-209"><a href="#cb46-209" aria-hidden="true" tabindex="-1"></a><span class="co"># p8 &lt;- ggplot(cor_overall_activity, aes(x = 1, y = correlation)) +</span></span>
<span id="cb46-210"><a href="#cb46-210" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(size = 4) +</span></span>
<span id="cb46-211"><a href="#cb46-211" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = NULL) +</span></span>
<span id="cb46-212"><a href="#cb46-212" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb46-213"><a href="#cb46-213" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Gesamt-Korrelation zwischen Art der Aktivität und zurückgelegter Distanz (2022-2024)",</span></span>
<span id="cb46-214"><a href="#cb46-214" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "",</span></span>
<span id="cb46-215"><a href="#cb46-215" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Korrelation"</span></span>
<span id="cb46-216"><a href="#cb46-216" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb46-217"><a href="#cb46-217" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb46-218"><a href="#cb46-218" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-219"><a href="#cb46-219" aria-hidden="true" tabindex="-1"></a><span class="co"># # Arrange plots in grid</span></span>
<span id="cb46-220"><a href="#cb46-220" aria-hidden="true" tabindex="-1"></a><span class="co"># grid.arrange(</span></span>
<span id="cb46-221"><a href="#cb46-221" aria-hidden="true" tabindex="-1"></a><span class="co">#   p1, p2, p3, p4, p5, p6, p7, p8,</span></span>
<span id="cb46-222"><a href="#cb46-222" aria-hidden="true" tabindex="-1"></a><span class="co">#   ncol = 2</span></span>
<span id="cb46-223"><a href="#cb46-223" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>#Auswertungen erweitert</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load necessary libraries</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scales)</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># library(gridExtra)</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># library(GGally)</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co"># library(RColorBrewer)</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co"># process_year_data &lt;- function(records_filtered, year_label) {</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Filter records by timestamp for the specified year</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(grepl(year_label, timestamp))</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Parse the activity column</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ")</span></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a><span class="co">#            longitude = longitudeE7 / 1e7)</span></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Remove activities "Null" and "Still"</span></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Remove rows with missing latitude or longitude</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!is.na(latitude) &amp; !is.na(longitude))</span></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert to spatial dataframe</span></span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   sf_records_filtered &lt;- st_as_sf(records_filtered, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Calculate distances between consecutive points</span></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrange(timestamp) %&gt;%</span></span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(</span></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a><span class="co">#       dist = distHaversine(cbind(longitude, latitude), cbind(lag(longitude), lag(latitude))) / 1000, # Convert to km</span></span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a><span class="co">#       timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a><span class="co">#       year = year(timestamp),</span></span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a><span class="co">#       month = month(timestamp, label = TRUE, abbr = FALSE), # Monate als Namen</span></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a><span class="co">#       day = wday(timestamp, label = TRUE, abbr = FALSE), # Wochentage als Namen</span></span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a><span class="co">#       hour = hour(timestamp),</span></span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a><span class="co">#       period = time_of_day(hour)</span></span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a><span class="co">#     replace_na(list(dist = 0))  # Replace NA distances with 0</span></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(records_filtered)</span></span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a><span class="co"># # Assuming records_N is loaded</span></span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2022 &lt;- process_year_data(records_N, "2022")</span></span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2023 &lt;- process_year_data(records_N, "2023")</span></span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2024 &lt;- process_year_data(records_N, "2024")</span></span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a><span class="co"># # Combine all years</span></span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records &lt;- bind_rows(records_2022, records_2023, records_2024)</span></span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a><span class="co"># # Define the order of periods and days</span></span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$period &lt;- factor(all_records$period, levels = c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)"))</span></span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$day &lt;- factor(all_records$day, levels = c("Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag", "Sonntag"))</span></span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a><span class="co"># # Analyse Verteilung, Korrelation und Trend</span></span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a><span class="co"># # Verteilung der zurückgelegten Distanz nach Tageszeit und Jahr</span></span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a><span class="co"># dist_by_period_year &lt;- all_records %&gt;%</span></span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, period) %&gt;%</span></span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a><span class="co"># p1 &lt;- ggplot(dist_by_period_year, aes(x = period, y = total_distance, fill = factor(year))) +</span></span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity", position = "dodge") +</span></span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Verteilung der zurückgelegten Distanz nach Tageszeit und Jahr",</span></span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Tageszeit",</span></span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Jahr"</span></span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a><span class="co"># # Verteilung der zurückgelegten Distanz nach Monat und Jahr</span></span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a><span class="co"># dist_by_month_year &lt;- all_records %&gt;%</span></span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, month) %&gt;%</span></span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a><span class="co"># p2 &lt;- ggplot(dist_by_month_year, aes(x = month, y = total_distance, fill = factor(year))) +</span></span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity", position = "dodge") +</span></span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Verteilung der zurückgelegten Distanz nach Monat und Jahr",</span></span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Jahr"</span></span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a><span class="co"># # Korrelation zwischen Monat und zurückgelegter Distanz für jedes Jahr</span></span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_by_year &lt;- all_records %&gt;%</span></span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, month) %&gt;%</span></span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop') %&gt;%</span></span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year) %&gt;%</span></span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(correlation = cor(as.numeric(month), total_distance))</span></span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a><span class="co"># p3 &lt;- ggplot(cor_by_year, aes(x = factor(year), y = correlation, color = factor(year), group = 1)) +</span></span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(size = 1.5) +</span></span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(size = 4) +</span></span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_brewer(palette = "Set3") +</span></span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Korrelation zwischen Monat und zurückgelegter Distanz",</span></span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahr",</span></span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Korrelation",</span></span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a><span class="co">#     color = "Jahr"</span></span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-136"><a href="#cb47-136" aria-hidden="true" tabindex="-1"></a><span class="co"># # Korrelation zwischen Tageszeit und zurückgelegter Distanz für jedes Jahr</span></span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_period_by_year &lt;- all_records %&gt;%</span></span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, period) %&gt;%</span></span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop') %&gt;%</span></span>
<span id="cb47-140"><a href="#cb47-140" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year) %&gt;%</span></span>
<span id="cb47-141"><a href="#cb47-141" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(correlation = cor(as.numeric(as.factor(period)), total_distance))</span></span>
<span id="cb47-142"><a href="#cb47-142" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-143"><a href="#cb47-143" aria-hidden="true" tabindex="-1"></a><span class="co"># p4 &lt;- ggplot(cor_period_by_year, aes(x = factor(year), y = correlation, color = factor(year), group = 1)) +</span></span>
<span id="cb47-144"><a href="#cb47-144" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(size = 1.5) +</span></span>
<span id="cb47-145"><a href="#cb47-145" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(size = 4) +</span></span>
<span id="cb47-146"><a href="#cb47-146" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_brewer(palette = "Set3") +</span></span>
<span id="cb47-147"><a href="#cb47-147" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb47-148"><a href="#cb47-148" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Korrelation zwischen Tageszeit und zurückgelegter Distanz",</span></span>
<span id="cb47-149"><a href="#cb47-149" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahr",</span></span>
<span id="cb47-150"><a href="#cb47-150" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Korrelation",</span></span>
<span id="cb47-151"><a href="#cb47-151" aria-hidden="true" tabindex="-1"></a><span class="co">#     color = "Jahr"</span></span>
<span id="cb47-152"><a href="#cb47-152" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb47-153"><a href="#cb47-153" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb47-154"><a href="#cb47-154" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-155"><a href="#cb47-155" aria-hidden="true" tabindex="-1"></a><span class="co"># # Trendanalyse der zurückgelegten Distanz über die Monate hinweg (2024) mit linearer Regression</span></span>
<span id="cb47-156"><a href="#cb47-156" aria-hidden="true" tabindex="-1"></a><span class="co"># trend_2024 &lt;- records_2024 %&gt;%</span></span>
<span id="cb47-157"><a href="#cb47-157" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month) %&gt;%</span></span>
<span id="cb47-158"><a href="#cb47-158" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb47-159"><a href="#cb47-159" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-160"><a href="#cb47-160" aria-hidden="true" tabindex="-1"></a><span class="co"># p5 &lt;- ggplot(trend_2024, aes(x = as.numeric(month), y = total_distance)) +</span></span>
<span id="cb47-161"><a href="#cb47-161" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point() +</span></span>
<span id="cb47-162"><a href="#cb47-162" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_smooth(method = "lm", se = FALSE, color = "blue") +</span></span>
<span id="cb47-163"><a href="#cb47-163" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb47-164"><a href="#cb47-164" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Trend der zurückgelegten Distanz über die Monate hinweg (2024)",</span></span>
<span id="cb47-165"><a href="#cb47-165" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb47-166"><a href="#cb47-166" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)"</span></span>
<span id="cb47-167"><a href="#cb47-167" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb47-168"><a href="#cb47-168" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb47-169"><a href="#cb47-169" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-170"><a href="#cb47-170" aria-hidden="true" tabindex="-1"></a><span class="co"># # Gesamt-Korrelation zwischen Monat und zurückgelegter Distanz (2022-2024)</span></span>
<span id="cb47-171"><a href="#cb47-171" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_overall_month &lt;- all_records %&gt;%</span></span>
<span id="cb47-172"><a href="#cb47-172" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month) %&gt;%</span></span>
<span id="cb47-173"><a href="#cb47-173" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop') %&gt;%</span></span>
<span id="cb47-174"><a href="#cb47-174" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(correlation = cor(as.numeric(month), total_distance))</span></span>
<span id="cb47-175"><a href="#cb47-175" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-176"><a href="#cb47-176" aria-hidden="true" tabindex="-1"></a><span class="co"># p6 &lt;- ggplot(cor_overall_month, aes(x = 1, y = correlation)) +</span></span>
<span id="cb47-177"><a href="#cb47-177" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(size = 4) +</span></span>
<span id="cb47-178"><a href="#cb47-178" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = NULL) +</span></span>
<span id="cb47-179"><a href="#cb47-179" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb47-180"><a href="#cb47-180" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Gesamt-Korrelation zwischen Monat und zurückgelegter Distanz (2022-2024)",</span></span>
<span id="cb47-181"><a href="#cb47-181" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "",</span></span>
<span id="cb47-182"><a href="#cb47-182" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Korrelation"</span></span>
<span id="cb47-183"><a href="#cb47-183" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb47-184"><a href="#cb47-184" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb47-185"><a href="#cb47-185" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-186"><a href="#cb47-186" aria-hidden="true" tabindex="-1"></a><span class="co"># # Gesamt-Korrelation zwischen Art der Aktivität und zurückgelegter Distanz (2022-2024)</span></span>
<span id="cb47-187"><a href="#cb47-187" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_overall_activity &lt;- all_records %&gt;%</span></span>
<span id="cb47-188"><a href="#cb47-188" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(activity1) %&gt;%</span></span>
<span id="cb47-189"><a href="#cb47-189" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop') %&gt;%</span></span>
<span id="cb47-190"><a href="#cb47-190" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(correlation = cor(as.numeric(as.factor(activity1)), total_distance))</span></span>
<span id="cb47-191"><a href="#cb47-191" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-192"><a href="#cb47-192" aria-hidden="true" tabindex="-1"></a><span class="co"># p7 &lt;- ggplot(cor_overall_activity, aes(x = 1, y = correlation)) +</span></span>
<span id="cb47-193"><a href="#cb47-193" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(size = 4) +</span></span>
<span id="cb47-194"><a href="#cb47-194" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = NULL) +</span></span>
<span id="cb47-195"><a href="#cb47-195" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb47-196"><a href="#cb47-196" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Gesamt-Korrelation zwischen Art der Aktivität und zurückgelegter Distanz (2022-2024)",</span></span>
<span id="cb47-197"><a href="#cb47-197" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "",</span></span>
<span id="cb47-198"><a href="#cb47-198" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Korrelation"</span></span>
<span id="cb47-199"><a href="#cb47-199" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb47-200"><a href="#cb47-200" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb47-201"><a href="#cb47-201" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-202"><a href="#cb47-202" aria-hidden="true" tabindex="-1"></a><span class="co"># # Heatmap der Aktivität pro Stunde und Tag</span></span>
<span id="cb47-203"><a href="#cb47-203" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_heatmap &lt;- all_records %&gt;%</span></span>
<span id="cb47-204"><a href="#cb47-204" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, day, hour) %&gt;%</span></span>
<span id="cb47-205"><a href="#cb47-205" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb47-206"><a href="#cb47-206" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-207"><a href="#cb47-207" aria-hidden="true" tabindex="-1"></a><span class="co"># p8 &lt;- ggplot(activity_heatmap, aes(x = hour, y = day, fill = total_distance)) +</span></span>
<span id="cb47-208"><a href="#cb47-208" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile() +</span></span>
<span id="cb47-209"><a href="#cb47-209" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_wrap(~ year) +</span></span>
<span id="cb47-210"><a href="#cb47-210" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_gradient(low = "white", high = "red") +</span></span>
<span id="cb47-211"><a href="#cb47-211" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb47-212"><a href="#cb47-212" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Heatmap der Aktivität pro Stunde und Tag",</span></span>
<span id="cb47-213"><a href="#cb47-213" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Stunde",</span></span>
<span id="cb47-214"><a href="#cb47-214" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Tag",</span></span>
<span id="cb47-215"><a href="#cb47-215" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Distanz (km)"</span></span>
<span id="cb47-216"><a href="#cb47-216" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb47-217"><a href="#cb47-217" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb47-218"><a href="#cb47-218" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.y = element_text(angle = 0, hjust = 1))</span></span>
<span id="cb47-219"><a href="#cb47-219" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-220"><a href="#cb47-220" aria-hidden="true" tabindex="-1"></a><span class="co"># # Heatmap der Aktivität pro Monat</span></span>
<span id="cb47-221"><a href="#cb47-221" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_heatmap_month &lt;- all_records %&gt;%</span></span>
<span id="cb47-222"><a href="#cb47-222" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, month) %&gt;%</span></span>
<span id="cb47-223"><a href="#cb47-223" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb47-224"><a href="#cb47-224" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-225"><a href="#cb47-225" aria-hidden="true" tabindex="-1"></a><span class="co"># p9 &lt;- ggplot(activity_heatmap_month, aes(x = month, y = factor(year), fill = total_distance)) +</span></span>
<span id="cb47-226"><a href="#cb47-226" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile() +</span></span>
<span id="cb47-227"><a href="#cb47-227" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_gradient(low = "white", high = "red") +</span></span>
<span id="cb47-228"><a href="#cb47-228" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb47-229"><a href="#cb47-229" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Heatmap der Aktivität pro Monat",</span></span>
<span id="cb47-230"><a href="#cb47-230" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb47-231"><a href="#cb47-231" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Jahr",</span></span>
<span id="cb47-232"><a href="#cb47-232" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Distanz (km)"</span></span>
<span id="cb47-233"><a href="#cb47-233" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb47-234"><a href="#cb47-234" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb47-235"><a href="#cb47-235" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-236"><a href="#cb47-236" aria-hidden="true" tabindex="-1"></a><span class="co"># # Vergleich der zurückgelegten Distanzen zwischen verschiedenen Aktivitäten</span></span>
<span id="cb47-237"><a href="#cb47-237" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_comparison &lt;- all_records %&gt;%</span></span>
<span id="cb47-238"><a href="#cb47-238" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(activity1) %&gt;%</span></span>
<span id="cb47-239"><a href="#cb47-239" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_distance = sum(dist, na.rm = TRUE), .groups = 'drop')</span></span>
<span id="cb47-240"><a href="#cb47-240" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-241"><a href="#cb47-241" aria-hidden="true" tabindex="-1"></a><span class="co"># p10 &lt;- ggplot(activity_comparison, aes(x = activity1, y = total_distance, fill = activity1)) +</span></span>
<span id="cb47-242"><a href="#cb47-242" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity") +</span></span>
<span id="cb47-243"><a href="#cb47-243" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb47-244"><a href="#cb47-244" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb47-245"><a href="#cb47-245" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Vergleich der zurückgelegten Distanzen zwischen verschiedenen Aktivitäten",</span></span>
<span id="cb47-246"><a href="#cb47-246" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Aktivität",</span></span>
<span id="cb47-247"><a href="#cb47-247" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Distanz (km)",</span></span>
<span id="cb47-248"><a href="#cb47-248" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Aktivität"</span></span>
<span id="cb47-249"><a href="#cb47-249" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb47-250"><a href="#cb47-250" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb47-251"><a href="#cb47-251" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb47-252"><a href="#cb47-252" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-253"><a href="#cb47-253" aria-hidden="true" tabindex="-1"></a><span class="co"># # Arrange plots in grid</span></span>
<span id="cb47-254"><a href="#cb47-254" aria-hidden="true" tabindex="-1"></a><span class="co"># grid.arrange(</span></span>
<span id="cb47-255"><a href="#cb47-255" aria-hidden="true" tabindex="-1"></a><span class="co">#   p1, p2, p3, p4, p5, p6, p7, p8, p9, p10,</span></span>
<span id="cb47-256"><a href="#cb47-256" aria-hidden="true" tabindex="-1"></a><span class="co">#   ncol = 2</span></span>
<span id="cb47-257"><a href="#cb47-257" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="weitere-anaylsen" class="level1">
<h1>weitere Anaylsen</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Lade notwendige Bibliotheken</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scales)</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(geosphere)</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># library(gridExtra)</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># library(GGally)</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co"># library(RColorBrewer)</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co"># library(cluster)</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co"># library(factoextra)</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co"># library(viridis)</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co"># library(spdep)</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dbscan)</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="co"># library(igraph)</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="co"># library(reshape2)</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="co"># library(gganimate)</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="co"># library(plotly)</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="co"># # Funktion zur Verarbeitung von Daten eines bestimmten Jahres</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="co"># process_year_data &lt;- function(records_filtered, year_label) {</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Filtere Datensätze nach dem angegebenen Jahr</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(grepl(year_label, timestamp))</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Analysiere die Aktivitätsspalte</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ", fill = "right", extra = "drop") %&gt;%</span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ", fill = "right") %&gt;%</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a><span class="co">#     separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ", fill = "right")</span></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Konvertiere Latitude/Longitude von E7 in Dezimalgrade</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a><span class="co">#            longitude = longitudeE7 / 1e7)</span></span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Entferne Aktivitäten "Null" und "Still"</span></span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!activity1 %in% c("Null", "Still"))</span></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Entferne Zeilen mit fehlender Latitude oder Longitude</span></span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(!is.na(latitude) &amp; !is.na(longitude))</span></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Weitere Bereinigung des Feldes activity1</span></span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(activity1 = gsub("list\\(activity = \"|\"\\)", "", activity1)) %&gt;%</span></span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(activity1 != "NULL")</span></span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Berechne Distanzen zwischen aufeinanderfolgenden Punkten</span></span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrange(timestamp) %&gt;%</span></span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(</span></span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a><span class="co">#       dist = distHaversine(cbind(longitude, latitude), cbind(lag(longitude), lag(latitude))) / 1000, # Umrechnung in km</span></span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a><span class="co">#       timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a><span class="co">#       year = year(timestamp),</span></span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a><span class="co">#       month = month(timestamp, label = TRUE, abbr = FALSE), # Monate als Namen</span></span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a><span class="co">#       day = wday(timestamp, label = TRUE, abbr = FALSE), # Wochentage als Namen</span></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a><span class="co">#       hour = hour(timestamp),</span></span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a><span class="co">#       period = time_of_day(hour)</span></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a><span class="co">#     replace_na(list(dist = 0))  # Ersetze NA-Distanzen durch 0</span></span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(records_filtered)</span></span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a><span class="co"># # Angenommen, records_N ist geladen</span></span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2022 &lt;- process_year_data(records_N, "2022")</span></span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2023 &lt;- process_year_data(records_N, "2023")</span></span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a><span class="co"># records_2024 &lt;- process_year_data(records_N, "2024")</span></span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a><span class="co"># # Kombiniere die Daten für alle Jahre</span></span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records &lt;- bind_rows(records_2022, records_2023, records_2024)</span></span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a><span class="co"># # Definiere die Reihenfolge der Perioden und Tage</span></span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$period &lt;- factor(all_records$period, levels = c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)"))</span></span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$day &lt;- factor(all_records$day, levels = c("Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag", "Sonntag"))</span></span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a><span class="co"># # Bereite Daten für das Clustering vor</span></span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a><span class="co"># clustering_data &lt;- all_records %&gt;%</span></span>
<span id="cb48-95"><a href="#cb48-95" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(longitude, latitude, activity1) %&gt;%</span></span>
<span id="cb48-96"><a href="#cb48-96" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(activity1 = as.numeric(factor(activity1)))</span></span>
<span id="cb48-97"><a href="#cb48-97" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-98"><a href="#cb48-98" aria-hidden="true" tabindex="-1"></a><span class="co"># # Führe k-means Clustering durch</span></span>
<span id="cb48-99"><a href="#cb48-99" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(123)</span></span>
<span id="cb48-100"><a href="#cb48-100" aria-hidden="true" tabindex="-1"></a><span class="co"># kmeans_result &lt;- kmeans(clustering_data[, c("longitude", "latitude")], centers = 5)</span></span>
<span id="cb48-101"><a href="#cb48-101" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-102"><a href="#cb48-102" aria-hidden="true" tabindex="-1"></a><span class="co"># # Füge Clusterinformationen zu den Daten hinzu</span></span>
<span id="cb48-103"><a href="#cb48-103" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$cluster &lt;- factor(kmeans_result$cluster)</span></span>
<span id="cb48-104"><a href="#cb48-104" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-105"><a href="#cb48-105" aria-hidden="true" tabindex="-1"></a><span class="co"># # Clustering nach Jahr</span></span>
<span id="cb48-106"><a href="#cb48-106" aria-hidden="true" tabindex="-1"></a><span class="co"># clustering_data_year &lt;- all_records %&gt;%</span></span>
<span id="cb48-107"><a href="#cb48-107" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(longitude, latitude, year)</span></span>
<span id="cb48-108"><a href="#cb48-108" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-109"><a href="#cb48-109" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(123)</span></span>
<span id="cb48-110"><a href="#cb48-110" aria-hidden="true" tabindex="-1"></a><span class="co"># kmeans_result_year &lt;- kmeans(clustering_data_year[, c("longitude", "latitude")], centers = 5)</span></span>
<span id="cb48-111"><a href="#cb48-111" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-112"><a href="#cb48-112" aria-hidden="true" tabindex="-1"></a><span class="co"># # Füge Jahres-Clusterinformationen zu den Daten hinzu</span></span>
<span id="cb48-113"><a href="#cb48-113" aria-hidden="true" tabindex="-1"></a><span class="co"># all_records$cluster_year &lt;- factor(kmeans_result_year$cluster)</span></span>
<span id="cb48-114"><a href="#cb48-114" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-115"><a href="#cb48-115" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisiere tägliche Aktivitätsmuster</span></span>
<span id="cb48-116"><a href="#cb48-116" aria-hidden="true" tabindex="-1"></a><span class="co"># hourly_activity &lt;- all_records %&gt;%</span></span>
<span id="cb48-117"><a href="#cb48-117" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(hour = hour(timestamp)) %&gt;%</span></span>
<span id="cb48-118"><a href="#cb48-118" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(hour, activity1) %&gt;%</span></span>
<span id="cb48-119"><a href="#cb48-119" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(count = n()) %&gt;%</span></span>
<span id="cb48-120"><a href="#cb48-120" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb48-121"><a href="#cb48-121" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-122"><a href="#cb48-122" aria-hidden="true" tabindex="-1"></a><span class="co"># p7 &lt;- ggplot(hourly_activity, aes(x = hour, y = count, color = activity1)) +</span></span>
<span id="cb48-123"><a href="#cb48-123" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line() +</span></span>
<span id="cb48-124"><a href="#cb48-124" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = 0:23) +</span></span>
<span id="cb48-125"><a href="#cb48-125" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb48-126"><a href="#cb48-126" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Tägliche Aktivitätsmuster",</span></span>
<span id="cb48-127"><a href="#cb48-127" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Stunde des Tages",</span></span>
<span id="cb48-128"><a href="#cb48-128" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Aktivitätsanzahl",</span></span>
<span id="cb48-129"><a href="#cb48-129" aria-hidden="true" tabindex="-1"></a><span class="co">#     color = "Aktivität"</span></span>
<span id="cb48-130"><a href="#cb48-130" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb48-131"><a href="#cb48-131" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb48-132"><a href="#cb48-132" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-133"><a href="#cb48-133" aria-hidden="true" tabindex="-1"></a><span class="co"># # Wöchentliche Muster</span></span>
<span id="cb48-134"><a href="#cb48-134" aria-hidden="true" tabindex="-1"></a><span class="co"># weekly_activity &lt;- all_records %&gt;%</span></span>
<span id="cb48-135"><a href="#cb48-135" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(day, activity1) %&gt;%</span></span>
<span id="cb48-136"><a href="#cb48-136" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(count = n()) %&gt;%</span></span>
<span id="cb48-137"><a href="#cb48-137" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb48-138"><a href="#cb48-138" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-139"><a href="#cb48-139" aria-hidden="true" tabindex="-1"></a><span class="co"># p8 &lt;- ggplot(weekly_activity, aes(x = day, y = count, fill = activity1)) +</span></span>
<span id="cb48-140"><a href="#cb48-140" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity", position = "dodge") +</span></span>
<span id="cb48-141"><a href="#cb48-141" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb48-142"><a href="#cb48-142" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Wöchentliche Aktivitätsmuster",</span></span>
<span id="cb48-143"><a href="#cb48-143" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Wochentag",</span></span>
<span id="cb48-144"><a href="#cb48-144" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Aktivitätsanzahl",</span></span>
<span id="cb48-145"><a href="#cb48-145" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Aktivität"</span></span>
<span id="cb48-146"><a href="#cb48-146" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb48-147"><a href="#cb48-147" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb48-148"><a href="#cb48-148" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-149"><a href="#cb48-149" aria-hidden="true" tabindex="-1"></a><span class="co"># # Monatliche Muster</span></span>
<span id="cb48-150"><a href="#cb48-150" aria-hidden="true" tabindex="-1"></a><span class="co"># monthly_activity &lt;- all_records %&gt;%</span></span>
<span id="cb48-151"><a href="#cb48-151" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month, activity1) %&gt;%</span></span>
<span id="cb48-152"><a href="#cb48-152" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(count = n()) %&gt;%</span></span>
<span id="cb48-153"><a href="#cb48-153" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb48-154"><a href="#cb48-154" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-155"><a href="#cb48-155" aria-hidden="true" tabindex="-1"></a><span class="co"># p9 &lt;- ggplot(monthly_activity, aes(x = month, y = count, fill = activity1)) +</span></span>
<span id="cb48-156"><a href="#cb48-156" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity", position = "dodge") +</span></span>
<span id="cb48-157"><a href="#cb48-157" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb48-158"><a href="#cb48-158" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Monatliche Aktivitätsmuster",</span></span>
<span id="cb48-159"><a href="#cb48-159" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb48-160"><a href="#cb48-160" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Aktivitätsanzahl",</span></span>
<span id="cb48-161"><a href="#cb48-161" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Aktivität"</span></span>
<span id="cb48-162"><a href="#cb48-162" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb48-163"><a href="#cb48-163" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb48-164"><a href="#cb48-164" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-165"><a href="#cb48-165" aria-hidden="true" tabindex="-1"></a><span class="co"># # Dichtekarten</span></span>
<span id="cb48-166"><a href="#cb48-166" aria-hidden="true" tabindex="-1"></a><span class="co"># sf_all_records &lt;- st_as_sf(all_records, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb48-167"><a href="#cb48-167" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-168"><a href="#cb48-168" aria-hidden="true" tabindex="-1"></a><span class="co"># # Korrelation Analyse</span></span>
<span id="cb48-169"><a href="#cb48-169" aria-hidden="true" tabindex="-1"></a><span class="co"># activity_period_corr &lt;- all_records %&gt;%</span></span>
<span id="cb48-170"><a href="#cb48-170" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(activity1, period) %&gt;%</span></span>
<span id="cb48-171"><a href="#cb48-171" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(activity1, period) %&gt;%</span></span>
<span id="cb48-172"><a href="#cb48-172" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(count = n()) %&gt;%</span></span>
<span id="cb48-173"><a href="#cb48-173" aria-hidden="true" tabindex="-1"></a><span class="co">#   spread(key = period, value = count, fill = 0)</span></span>
<span id="cb48-174"><a href="#cb48-174" aria-hidden="true" tabindex="-1"></a><span class="co"># cor_matrix &lt;- cor(activity_period_corr[-1])</span></span>
<span id="cb48-175"><a href="#cb48-175" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-176"><a href="#cb48-176" aria-hidden="true" tabindex="-1"></a><span class="co"># p15 &lt;- ggplot(melt(cor_matrix), aes(Var1, Var2, fill = value)) +</span></span>
<span id="cb48-177"><a href="#cb48-177" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile() +</span></span>
<span id="cb48-178"><a href="#cb48-178" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c() +</span></span>
<span id="cb48-179"><a href="#cb48-179" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb48-180"><a href="#cb48-180" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Korrelation Heatmap der Aktivitäten und Perioden",</span></span>
<span id="cb48-181"><a href="#cb48-181" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Aktivität",</span></span>
<span id="cb48-182"><a href="#cb48-182" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Periode"</span></span>
<span id="cb48-183"><a href="#cb48-183" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb48-184"><a href="#cb48-184" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb48-185"><a href="#cb48-185" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-186"><a href="#cb48-186" aria-hidden="true" tabindex="-1"></a><span class="co"># # Jahr-für-Jahr Vergleich</span></span>
<span id="cb48-187"><a href="#cb48-187" aria-hidden="true" tabindex="-1"></a><span class="co"># yearly_activity &lt;- all_records %&gt;%</span></span>
<span id="cb48-188"><a href="#cb48-188" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(year, activity1) %&gt;%</span></span>
<span id="cb48-189"><a href="#cb48-189" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(count = n()) %&gt;%</span></span>
<span id="cb48-190"><a href="#cb48-190" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb48-191"><a href="#cb48-191" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-192"><a href="#cb48-192" aria-hidden="true" tabindex="-1"></a><span class="co"># p17 &lt;- ggplot(yearly_activity, aes(x = year, y = count, fill = activity1)) +</span></span>
<span id="cb48-193"><a href="#cb48-193" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity", position = "dodge") +</span></span>
<span id="cb48-194"><a href="#cb48-194" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb48-195"><a href="#cb48-195" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Jahr-für-Jahr Aktivitätsvergleich",</span></span>
<span id="cb48-196"><a href="#cb48-196" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahr",</span></span>
<span id="cb48-197"><a href="#cb48-197" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Aktivitätsanzahl",</span></span>
<span id="cb48-198"><a href="#cb48-198" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Aktivität"</span></span>
<span id="cb48-199"><a href="#cb48-199" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb48-200"><a href="#cb48-200" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb48-201"><a href="#cb48-201" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-202"><a href="#cb48-202" aria-hidden="true" tabindex="-1"></a><span class="co"># # # Animierte Karten</span></span>
<span id="cb48-203"><a href="#cb48-203" aria-hidden="true" tabindex="-1"></a><span class="co"># # animated_map &lt;- ggplot(all_records, aes(x = longitude, y = latitude, color = activity1)) +</span></span>
<span id="cb48-204"><a href="#cb48-204" aria-hidden="true" tabindex="-1"></a><span class="co"># #   geom_point(size = 2, alpha = 0.6) +</span></span>
<span id="cb48-205"><a href="#cb48-205" aria-hidden="true" tabindex="-1"></a><span class="co"># #   transition_time(timestamp) +</span></span>
<span id="cb48-206"><a href="#cb48-206" aria-hidden="true" tabindex="-1"></a><span class="co"># #   labs(</span></span>
<span id="cb48-207"><a href="#cb48-207" aria-hidden="true" tabindex="-1"></a><span class="co"># #     title = "Animierte Karte der Aktivitäten",</span></span>
<span id="cb48-208"><a href="#cb48-208" aria-hidden="true" tabindex="-1"></a><span class="co"># #     x = "Längengrad",</span></span>
<span id="cb48-209"><a href="#cb48-209" aria-hidden="true" tabindex="-1"></a><span class="co"># #     y = "Breitengrad",</span></span>
<span id="cb48-210"><a href="#cb48-210" aria-hidden="true" tabindex="-1"></a><span class="co"># #     color = "Aktivität"</span></span>
<span id="cb48-211"><a href="#cb48-211" aria-hidden="true" tabindex="-1"></a><span class="co"># #   ) +</span></span>
<span id="cb48-212"><a href="#cb48-212" aria-hidden="true" tabindex="-1"></a><span class="co"># #   theme_minimal()</span></span>
<span id="cb48-213"><a href="#cb48-213" aria-hidden="true" tabindex="-1"></a><span class="co"># # </span></span>
<span id="cb48-214"><a href="#cb48-214" aria-hidden="true" tabindex="-1"></a><span class="co"># # animate(animated_map, renderer = gifski_renderer())</span></span>
<span id="cb48-215"><a href="#cb48-215" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-216"><a href="#cb48-216" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3D Visualisierungen</span></span>
<span id="cb48-217"><a href="#cb48-217" aria-hidden="true" tabindex="-1"></a><span class="co"># p19 &lt;- plot_ly(all_records, x = ~longitude, y = ~latitude, z = ~elevation, color = ~activity1, type = "scatter3d", mode = "markers") %&gt;%</span></span>
<span id="cb48-218"><a href="#cb48-218" aria-hidden="true" tabindex="-1"></a><span class="co">#   layout(title = "3D Visualisierung der Aktivitäten")</span></span>
<span id="cb48-219"><a href="#cb48-219" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-220"><a href="#cb48-220" aria-hidden="true" tabindex="-1"></a><span class="co"># # Drucke jedes Diagramm einzeln</span></span>
<span id="cb48-221"><a href="#cb48-221" aria-hidden="true" tabindex="-1"></a><span class="co"># print(p7)</span></span>
<span id="cb48-222"><a href="#cb48-222" aria-hidden="true" tabindex="-1"></a><span class="co"># print(p8)</span></span>
<span id="cb48-223"><a href="#cb48-223" aria-hidden="true" tabindex="-1"></a><span class="co"># print(p9)</span></span>
<span id="cb48-224"><a href="#cb48-224" aria-hidden="true" tabindex="-1"></a><span class="co"># print(p15)</span></span>
<span id="cb48-225"><a href="#cb48-225" aria-hidden="true" tabindex="-1"></a><span class="co"># # plotly Ausgaben werden direkt in interaktiven Sitzungen gerendert</span></span>
<span id="cb48-226"><a href="#cb48-226" aria-hidden="true" tabindex="-1"></a><span class="co"># # p16 ist ein igraph Plot, der direkt in interaktiven Sitzungen gerendert wird</span></span>
<span id="cb48-227"><a href="#cb48-227" aria-hidden="true" tabindex="-1"></a><span class="co"># print(p17)</span></span>
<span id="cb48-228"><a href="#cb48-228" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb48-229"><a href="#cb48-229" aria-hidden="true" tabindex="-1"></a><span class="co"># # Anordnung zusätzlicher Diagramme im Raster</span></span>
<span id="cb48-230"><a href="#cb48-230" aria-hidden="true" tabindex="-1"></a><span class="co"># grid.arrange(</span></span>
<span id="cb48-231"><a href="#cb48-231" aria-hidden="true" tabindex="-1"></a><span class="co">#   p7, p8, p9, p15, p17,</span></span>
<span id="cb48-232"><a href="#cb48-232" aria-hidden="true" tabindex="-1"></a><span class="co">#   ncol = 1</span></span>
<span id="cb48-233"><a href="#cb48-233" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb48-234"><a href="#cb48-234" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>#Saisonale Trends - Diagramme</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # Funktion, um Monate in Jahreszeiten umzuwandeln</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># month_to_season &lt;- function(month) {</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     month %in% c(12, 1, 2) ~ "Winter",</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     month %in% c(3, 4, 5) ~ "Frühling",</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     month %in% c(6, 7, 8) ~ "Sommer",</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Herbst"</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen",</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag",</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag",</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend",</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht"</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A von Januar 2022 bis heute vorbereiten</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp),</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month),</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour = hour(timestamp),</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     period = time_of_day(hour),</span></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp),</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours")),</span></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="co">#     kilometers = duration * 0.08  # Annahme: 0.08km pro Stunde</span></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year(timestamp) &gt;= 2022 &amp; timestamp &gt;= as.POSIXct("2022-01-01", tz = "UTC")) %&gt;%</span></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a><span class="co"># # Datenanalyse für die Anzahl der Aufzeichnungen nach Tageszeit</span></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a><span class="co"># daily_period_record_count &lt;- As_data %&gt;%</span></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(period) %&gt;%</span></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(record_count = n(), .groups = 'drop')</span></span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot für die Anzahl der Aufzeichnungen nach Tageszeit</span></span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(daily_period_record_count, aes(x = period, y = record_count, fill = period)) +</span></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity") +</span></span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Pastel1") +</span></span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Anzahl der Aufzeichnungen nach Tageszeit",</span></span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Von Januar 2022 bis heute",</span></span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Tageszeit",</span></span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Anzahl der Aufzeichnungen"</span></span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a><span class="co"># # Datenanalyse für die Anzahl der Aufzeichnungen nach Tageszeit und Jahreszeit</span></span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a><span class="co"># season_period_record_count &lt;- As_data %&gt;%</span></span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(season, period) %&gt;%</span></span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(record_count = n(), .groups = 'drop')</span></span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Aufzeichnungen nach Tageszeit und Jahreszeit &gt; Säulendiagramm</span></span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(season_period_record_count, aes(x = period, y = record_count, fill = season)) +</span></span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(stat = "identity", position = position_dodge()) +</span></span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Anzahl der Aufzeichnungen pro Tageszeit und Jahreszeit",</span></span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Aufgeteilt nach Morgen, Mittag, Nachmittag, Abend und Nacht",</span></span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Tageszeit",</span></span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Anzahl der Aufzeichnungen",</span></span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Jahreszeit"</span></span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a><span class="co"># # Berechnung der Anzahl der Aufzeichnungen pro Jahreszeit</span></span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a><span class="co"># season_record_count &lt;- As_data %&gt;%</span></span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(season) %&gt;%</span></span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(record_count = n(), .groups = 'drop')</span></span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Beziehung zwischen Jahreszeit und Anzahl der Aufzeichnungen</span></span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(season_record_count, aes(x = season, y = record_count, group = 1)) +</span></span>
<span id="cb49-85"><a href="#cb49-85" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(aes(group = 1), colour="blue", size=1) +</span></span>
<span id="cb49-86"><a href="#cb49-86" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(size = 3) +</span></span>
<span id="cb49-87"><a href="#cb49-87" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Beziehung zwischen Jahreszeit und Anzahl der Aufzeichnungen",</span></span>
<span id="cb49-88"><a href="#cb49-88" aria-hidden="true" tabindex="-1"></a><span class="co">#        x = "Jahreszeit",</span></span>
<span id="cb49-89"><a href="#cb49-89" aria-hidden="true" tabindex="-1"></a><span class="co">#        y = "Anzahl der Aufzeichnungen") +</span></span>
<span id="cb49-90"><a href="#cb49-90" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb49-91"><a href="#cb49-91" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-92"><a href="#cb49-92" aria-hidden="true" tabindex="-1"></a><span class="co"># # Berechnung der Anzahl der Aufzeichnungen pro Tageszeit</span></span>
<span id="cb49-93"><a href="#cb49-93" aria-hidden="true" tabindex="-1"></a><span class="co"># period_record_count &lt;- As_data %&gt;%</span></span>
<span id="cb49-94"><a href="#cb49-94" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(period) %&gt;%</span></span>
<span id="cb49-95"><a href="#cb49-95" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(record_count = n(), .groups = 'drop')</span></span>
<span id="cb49-96"><a href="#cb49-96" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-97"><a href="#cb49-97" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Beziehung zwischen Tageszeit und Anzahl der Aufzeichnungen</span></span>
<span id="cb49-98"><a href="#cb49-98" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(period_record_count, aes(x = period, y = record_count, group = 1)) +</span></span>
<span id="cb49-99"><a href="#cb49-99" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(aes(group = 1), colour="green", size=1) +</span></span>
<span id="cb49-100"><a href="#cb49-100" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(size = 3) +</span></span>
<span id="cb49-101"><a href="#cb49-101" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Beziehung zwischen Tageszeit und Anzahl der Aufzeichnungen",</span></span>
<span id="cb49-102"><a href="#cb49-102" aria-hidden="true" tabindex="-1"></a><span class="co">#        x = "Tageszeit",</span></span>
<span id="cb49-103"><a href="#cb49-103" aria-hidden="true" tabindex="-1"></a><span class="co">#        y = "Anzahl der Aufzeichnungen") +</span></span>
<span id="cb49-104"><a href="#cb49-104" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb49-105"><a href="#cb49-105" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-106"><a href="#cb49-106" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-107"><a href="#cb49-107" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-108"><a href="#cb49-108" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb49-109"><a href="#cb49-109" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-110"><a href="#cb49-110" aria-hidden="true" tabindex="-1"></a><span class="co"># # Funktion, um Monate in Jahreszeiten umzuwandeln</span></span>
<span id="cb49-111"><a href="#cb49-111" aria-hidden="true" tabindex="-1"></a><span class="co"># month_to_season &lt;- function(month) {</span></span>
<span id="cb49-112"><a href="#cb49-112" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb49-113"><a href="#cb49-113" aria-hidden="true" tabindex="-1"></a><span class="co">#     month %in% c(12, 1, 2) ~ "Winter",</span></span>
<span id="cb49-114"><a href="#cb49-114" aria-hidden="true" tabindex="-1"></a><span class="co">#     month %in% c(3, 4, 5) ~ "Frühling",</span></span>
<span id="cb49-115"><a href="#cb49-115" aria-hidden="true" tabindex="-1"></a><span class="co">#     month %in% c(6, 7, 8) ~ "Sommer",</span></span>
<span id="cb49-116"><a href="#cb49-116" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Herbst"</span></span>
<span id="cb49-117"><a href="#cb49-117" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-118"><a href="#cb49-118" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-119"><a href="#cb49-119" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-120"><a href="#cb49-120" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb49-121"><a href="#cb49-121" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb49-122"><a href="#cb49-122" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb49-123"><a href="#cb49-123" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb49-124"><a href="#cb49-124" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb49-125"><a href="#cb49-125" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb49-126"><a href="#cb49-126" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb49-127"><a href="#cb49-127" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb49-128"><a href="#cb49-128" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-129"><a href="#cb49-129" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-130"><a href="#cb49-130" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-131"><a href="#cb49-131" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A von Januar 2022 bis heute vorbereiten</span></span>
<span id="cb49-132"><a href="#cb49-132" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-133"><a href="#cb49-133" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-134"><a href="#cb49-134" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-135"><a href="#cb49-135" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp),</span></span>
<span id="cb49-136"><a href="#cb49-136" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month),</span></span>
<span id="cb49-137"><a href="#cb49-137" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour = hour(timestamp),</span></span>
<span id="cb49-138"><a href="#cb49-138" aria-hidden="true" tabindex="-1"></a><span class="co">#     period = time_of_day(hour),</span></span>
<span id="cb49-139"><a href="#cb49-139" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp),</span></span>
<span id="cb49-140"><a href="#cb49-140" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours")),</span></span>
<span id="cb49-141"><a href="#cb49-141" aria-hidden="true" tabindex="-1"></a><span class="co">#     kilometers = duration * 0.08  # Annahme: 0.08km pro Stunde</span></span>
<span id="cb49-142"><a href="#cb49-142" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-143"><a href="#cb49-143" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year(timestamp) &gt;= 2022 &amp; timestamp &gt;= as.POSIXct("2022-01-01", tz = "UTC")) %&gt;%</span></span>
<span id="cb49-144"><a href="#cb49-144" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb49-145"><a href="#cb49-145" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-146"><a href="#cb49-146" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-147"><a href="#cb49-147" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reihenfolge der Tageszeiten definieren</span></span>
<span id="cb49-148"><a href="#cb49-148" aria-hidden="true" tabindex="-1"></a><span class="co"># levels_order &lt;- c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)")</span></span>
<span id="cb49-149"><a href="#cb49-149" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data$period &lt;- factor(As_data$period, levels = levels_order)</span></span>
<span id="cb49-150"><a href="#cb49-150" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-151"><a href="#cb49-151" aria-hidden="true" tabindex="-1"></a><span class="co"># # Datenanalyse für die Anzahl der Aufzeichnungen nach Tageszeit und Jahreszeit</span></span>
<span id="cb49-152"><a href="#cb49-152" aria-hidden="true" tabindex="-1"></a><span class="co"># season_period_record_count &lt;- As_data %&gt;%</span></span>
<span id="cb49-153"><a href="#cb49-153" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(season, period) %&gt;%</span></span>
<span id="cb49-154"><a href="#cb49-154" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(record_count = n(), .groups = 'drop')</span></span>
<span id="cb49-155"><a href="#cb49-155" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-156"><a href="#cb49-156" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten überprüfen</span></span>
<span id="cb49-157"><a href="#cb49-157" aria-hidden="true" tabindex="-1"></a><span class="co"># print(season_period_record_count)</span></span>
<span id="cb49-158"><a href="#cb49-158" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-159"><a href="#cb49-159" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Aktivitätenanzahl pro Tageszeit und Jahreszeit als Flächendiagramm</span></span>
<span id="cb49-160"><a href="#cb49-160" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(season_period_record_count, aes(x = period, y = record_count, fill = season, group = season)) +</span></span>
<span id="cb49-161"><a href="#cb49-161" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_area(position = 'stack', alpha = 0.6) +</span></span>
<span id="cb49-162"><a href="#cb49-162" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb49-163"><a href="#cb49-163" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-164"><a href="#cb49-164" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Anzahl der Aktivitäten pro Tageszeit und Jahreszeit",</span></span>
<span id="cb49-165"><a href="#cb49-165" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Aufgeteilt nach Morgen, Mittag, Nachmittag, Abend und Nacht",</span></span>
<span id="cb49-166"><a href="#cb49-166" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Tageszeit",</span></span>
<span id="cb49-167"><a href="#cb49-167" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Anzahl der Aktivitäten",</span></span>
<span id="cb49-168"><a href="#cb49-168" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Jahreszeit"</span></span>
<span id="cb49-169"><a href="#cb49-169" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-170"><a href="#cb49-170" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-171"><a href="#cb49-171" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-172"><a href="#cb49-172" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-173"><a href="#cb49-173" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-174"><a href="#cb49-174" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-175"><a href="#cb49-175" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb49-176"><a href="#cb49-176" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-177"><a href="#cb49-177" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb49-178"><a href="#cb49-178" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb49-179"><a href="#cb49-179" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb49-180"><a href="#cb49-180" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb49-181"><a href="#cb49-181" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb49-182"><a href="#cb49-182" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb49-183"><a href="#cb49-183" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb49-184"><a href="#cb49-184" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb49-185"><a href="#cb49-185" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-186"><a href="#cb49-186" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-187"><a href="#cb49-187" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-188"><a href="#cb49-188" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A von Januar 2023 bis heute vorbereiten</span></span>
<span id="cb49-189"><a href="#cb49-189" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-190"><a href="#cb49-190" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-191"><a href="#cb49-191" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-192"><a href="#cb49-192" aria-hidden="true" tabindex="-1"></a><span class="co">#     year = year(timestamp),</span></span>
<span id="cb49-193"><a href="#cb49-193" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp, label = TRUE, abbr = FALSE), # Monate als Namen</span></span>
<span id="cb49-194"><a href="#cb49-194" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour = hour(timestamp),</span></span>
<span id="cb49-195"><a href="#cb49-195" aria-hidden="true" tabindex="-1"></a><span class="co">#     period = time_of_day(hour),</span></span>
<span id="cb49-196"><a href="#cb49-196" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp),</span></span>
<span id="cb49-197"><a href="#cb49-197" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours")),</span></span>
<span id="cb49-198"><a href="#cb49-198" aria-hidden="true" tabindex="-1"></a><span class="co">#     kilometers = duration * 0.08  # Annahme: 0.08km pro Stunde</span></span>
<span id="cb49-199"><a href="#cb49-199" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-200"><a href="#cb49-200" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year == 2023 &amp; timestamp &gt;= as.POSIXct("2023-01-01", tz = "UTC")) %&gt;%</span></span>
<span id="cb49-201"><a href="#cb49-201" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb49-202"><a href="#cb49-202" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-203"><a href="#cb49-203" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-204"><a href="#cb49-204" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reihenfolge der Tageszeiten definieren</span></span>
<span id="cb49-205"><a href="#cb49-205" aria-hidden="true" tabindex="-1"></a><span class="co"># levels_order &lt;- c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)")</span></span>
<span id="cb49-206"><a href="#cb49-206" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data$period &lt;- factor(As_data$period, levels = levels_order)</span></span>
<span id="cb49-207"><a href="#cb49-207" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-208"><a href="#cb49-208" aria-hidden="true" tabindex="-1"></a><span class="co"># # Datenanalyse für die Anzahl der Aufzeichnungen nach Tageszeit und Monat</span></span>
<span id="cb49-209"><a href="#cb49-209" aria-hidden="true" tabindex="-1"></a><span class="co"># month_period_record_count &lt;- As_data %&gt;%</span></span>
<span id="cb49-210"><a href="#cb49-210" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month, period) %&gt;%</span></span>
<span id="cb49-211"><a href="#cb49-211" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(record_count = n(), .groups = 'drop')</span></span>
<span id="cb49-212"><a href="#cb49-212" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-213"><a href="#cb49-213" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten überprüfen</span></span>
<span id="cb49-214"><a href="#cb49-214" aria-hidden="true" tabindex="-1"></a><span class="co"># print(month_period_record_count)</span></span>
<span id="cb49-215"><a href="#cb49-215" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-216"><a href="#cb49-216" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Aktivitätenanzahl pro Tageszeit und Monat als Flächendiagramm</span></span>
<span id="cb49-217"><a href="#cb49-217" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(month_period_record_count, aes(x = period, y = record_count, fill = month, group = month)) +</span></span>
<span id="cb49-218"><a href="#cb49-218" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_area(position = 'stack', alpha = 0.6) +</span></span>
<span id="cb49-219"><a href="#cb49-219" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb49-220"><a href="#cb49-220" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-221"><a href="#cb49-221" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Anzahl der Aktivitäten pro Tageszeit und Monat (2023)",</span></span>
<span id="cb49-222"><a href="#cb49-222" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Aufgeteilt nach Morgen, Mittag, Nachmittag, Abend und Nacht",</span></span>
<span id="cb49-223"><a href="#cb49-223" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Tageszeit",</span></span>
<span id="cb49-224"><a href="#cb49-224" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Anzahl der Aktivitäten",</span></span>
<span id="cb49-225"><a href="#cb49-225" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Monat"</span></span>
<span id="cb49-226"><a href="#cb49-226" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-227"><a href="#cb49-227" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-228"><a href="#cb49-228" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-229"><a href="#cb49-229" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-230"><a href="#cb49-230" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-231"><a href="#cb49-231" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-232"><a href="#cb49-232" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-233"><a href="#cb49-233" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-234"><a href="#cb49-234" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb49-235"><a href="#cb49-235" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-236"><a href="#cb49-236" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb49-237"><a href="#cb49-237" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb49-238"><a href="#cb49-238" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb49-239"><a href="#cb49-239" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb49-240"><a href="#cb49-240" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb49-241"><a href="#cb49-241" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb49-242"><a href="#cb49-242" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb49-243"><a href="#cb49-243" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb49-244"><a href="#cb49-244" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-245"><a href="#cb49-245" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-246"><a href="#cb49-246" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-247"><a href="#cb49-247" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A im April 2024 vorbereiten</span></span>
<span id="cb49-248"><a href="#cb49-248" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-249"><a href="#cb49-249" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-250"><a href="#cb49-250" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-251"><a href="#cb49-251" aria-hidden="true" tabindex="-1"></a><span class="co">#     year = year(timestamp),</span></span>
<span id="cb49-252"><a href="#cb49-252" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp),</span></span>
<span id="cb49-253"><a href="#cb49-253" aria-hidden="true" tabindex="-1"></a><span class="co">#     day = day(timestamp),</span></span>
<span id="cb49-254"><a href="#cb49-254" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour = hour(timestamp),</span></span>
<span id="cb49-255"><a href="#cb49-255" aria-hidden="true" tabindex="-1"></a><span class="co">#     period = time_of_day(hour),</span></span>
<span id="cb49-256"><a href="#cb49-256" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp),</span></span>
<span id="cb49-257"><a href="#cb49-257" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours")),</span></span>
<span id="cb49-258"><a href="#cb49-258" aria-hidden="true" tabindex="-1"></a><span class="co">#     kilometers = duration * 0.08  # Annahme: 0.08km pro Stunde</span></span>
<span id="cb49-259"><a href="#cb49-259" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-260"><a href="#cb49-260" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year == 2024 &amp; month == 4 &amp; timestamp &gt;= as.POSIXct("2024-04-01", tz = "UTC") &amp; timestamp &lt; as.POSIXct("2024-05-01", tz = "UTC")) %&gt;%</span></span>
<span id="cb49-261"><a href="#cb49-261" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb49-262"><a href="#cb49-262" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-263"><a href="#cb49-263" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-264"><a href="#cb49-264" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reihenfolge der Tageszeiten definieren</span></span>
<span id="cb49-265"><a href="#cb49-265" aria-hidden="true" tabindex="-1"></a><span class="co"># levels_order &lt;- c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)")</span></span>
<span id="cb49-266"><a href="#cb49-266" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data$period &lt;- factor(As_data$period, levels = levels_order)</span></span>
<span id="cb49-267"><a href="#cb49-267" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-268"><a href="#cb49-268" aria-hidden="true" tabindex="-1"></a><span class="co"># # Datenanalyse für die Anzahl der Aufzeichnungen nach Tageszeit und Tag</span></span>
<span id="cb49-269"><a href="#cb49-269" aria-hidden="true" tabindex="-1"></a><span class="co"># day_period_record_count &lt;- As_data %&gt;%</span></span>
<span id="cb49-270"><a href="#cb49-270" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(day, period) %&gt;%</span></span>
<span id="cb49-271"><a href="#cb49-271" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(record_count = n(), .groups = 'drop')</span></span>
<span id="cb49-272"><a href="#cb49-272" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-273"><a href="#cb49-273" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten überprüfen</span></span>
<span id="cb49-274"><a href="#cb49-274" aria-hidden="true" tabindex="-1"></a><span class="co"># print(day_period_record_count)</span></span>
<span id="cb49-275"><a href="#cb49-275" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-276"><a href="#cb49-276" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Aktivitätenanzahl pro Tageszeit und Tag im April 2024 als Flächendiagramm</span></span>
<span id="cb49-277"><a href="#cb49-277" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(day_period_record_count, aes(x = day, y = record_count, fill = period, group = period)) +</span></span>
<span id="cb49-278"><a href="#cb49-278" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_area(position = 'stack', alpha = 0.6) +</span></span>
<span id="cb49-279"><a href="#cb49-279" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb49-280"><a href="#cb49-280" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-281"><a href="#cb49-281" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Anzahl der Aktivitäten pro Tageszeit und Tag (April 2024)",</span></span>
<span id="cb49-282"><a href="#cb49-282" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Aufgeteilt nach Morgen, Mittag, Nachmittag, Abend und Nacht",</span></span>
<span id="cb49-283"><a href="#cb49-283" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Tag",</span></span>
<span id="cb49-284"><a href="#cb49-284" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Anzahl der Aktivitäten",</span></span>
<span id="cb49-285"><a href="#cb49-285" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Tageszeit"</span></span>
<span id="cb49-286"><a href="#cb49-286" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-287"><a href="#cb49-287" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-288"><a href="#cb49-288" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-289"><a href="#cb49-289" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-290"><a href="#cb49-290" aria-hidden="true" tabindex="-1"></a><span class="co"># #_____________________________________________________________________________________________</span></span>
<span id="cb49-291"><a href="#cb49-291" aria-hidden="true" tabindex="-1"></a><span class="co"># #_____________________________________________________________________________________________</span></span>
<span id="cb49-292"><a href="#cb49-292" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-293"><a href="#cb49-293" aria-hidden="true" tabindex="-1"></a><span class="co"># # B:</span></span>
<span id="cb49-294"><a href="#cb49-294" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-295"><a href="#cb49-295" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-296"><a href="#cb49-296" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-297"><a href="#cb49-297" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb49-298"><a href="#cb49-298" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-299"><a href="#cb49-299" aria-hidden="true" tabindex="-1"></a><span class="co"># # Hilfsfunktion zur Klassifizierung der Tageszeit</span></span>
<span id="cb49-300"><a href="#cb49-300" aria-hidden="true" tabindex="-1"></a><span class="co"># time_of_day &lt;- function(hour) {</span></span>
<span id="cb49-301"><a href="#cb49-301" aria-hidden="true" tabindex="-1"></a><span class="co">#   case_when(</span></span>
<span id="cb49-302"><a href="#cb49-302" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 6 &amp; hour &lt; 10 ~ "Morgen (06-10 Uhr)",</span></span>
<span id="cb49-303"><a href="#cb49-303" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 10 &amp; hour &lt; 14 ~ "Mittag (10-14 Uhr)",</span></span>
<span id="cb49-304"><a href="#cb49-304" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 14 &amp; hour &lt; 18 ~ "Nachmittag (14-18 Uhr)",</span></span>
<span id="cb49-305"><a href="#cb49-305" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour &gt;= 18 &amp; hour &lt; 22 ~ "Abend (18-22 Uhr)",</span></span>
<span id="cb49-306"><a href="#cb49-306" aria-hidden="true" tabindex="-1"></a><span class="co">#     TRUE ~ "Nacht (22-06 Uhr)"</span></span>
<span id="cb49-307"><a href="#cb49-307" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-308"><a href="#cb49-308" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-309"><a href="#cb49-309" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-310"><a href="#cb49-310" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für B im April 2024 vorbereiten</span></span>
<span id="cb49-311"><a href="#cb49-311" aria-hidden="true" tabindex="-1"></a><span class="co"># Bs_data &lt;- records_S %&gt;%</span></span>
<span id="cb49-312"><a href="#cb49-312" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-313"><a href="#cb49-313" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-314"><a href="#cb49-314" aria-hidden="true" tabindex="-1"></a><span class="co">#     year = year(timestamp),</span></span>
<span id="cb49-315"><a href="#cb49-315" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp),</span></span>
<span id="cb49-316"><a href="#cb49-316" aria-hidden="true" tabindex="-1"></a><span class="co">#     day = day(timestamp),</span></span>
<span id="cb49-317"><a href="#cb49-317" aria-hidden="true" tabindex="-1"></a><span class="co">#     hour = hour(timestamp),</span></span>
<span id="cb49-318"><a href="#cb49-318" aria-hidden="true" tabindex="-1"></a><span class="co">#     period = time_of_day(hour),</span></span>
<span id="cb49-319"><a href="#cb49-319" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp),</span></span>
<span id="cb49-320"><a href="#cb49-320" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours")),</span></span>
<span id="cb49-321"><a href="#cb49-321" aria-hidden="true" tabindex="-1"></a><span class="co">#     kilometers = duration * 0.08  # Annahme: 0.08km pro Stunde</span></span>
<span id="cb49-322"><a href="#cb49-322" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-323"><a href="#cb49-323" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year == 2024 &amp; month == 4 &amp; timestamp &gt;= as.POSIXct("2024-04-01", tz = "UTC") &amp; timestamp &lt; as.POSIXct("2024-05-01", tz = "UTC")) %&gt;%</span></span>
<span id="cb49-324"><a href="#cb49-324" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb49-325"><a href="#cb49-325" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-326"><a href="#cb49-326" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-327"><a href="#cb49-327" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reihenfolge der Tageszeiten definieren</span></span>
<span id="cb49-328"><a href="#cb49-328" aria-hidden="true" tabindex="-1"></a><span class="co"># levels_order &lt;- c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)")</span></span>
<span id="cb49-329"><a href="#cb49-329" aria-hidden="true" tabindex="-1"></a><span class="co"># Bs_data$period &lt;- factor(Bs_data$period, levels = levels_order)</span></span>
<span id="cb49-330"><a href="#cb49-330" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-331"><a href="#cb49-331" aria-hidden="true" tabindex="-1"></a><span class="co"># # Datenanalyse für die Anzahl der Aufzeichnungen nach Tageszeit und Tag</span></span>
<span id="cb49-332"><a href="#cb49-332" aria-hidden="true" tabindex="-1"></a><span class="co"># day_period_record_count &lt;- Bs_data %&gt;%</span></span>
<span id="cb49-333"><a href="#cb49-333" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(day, period) %&gt;%</span></span>
<span id="cb49-334"><a href="#cb49-334" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(record_count = n(), .groups = 'drop')</span></span>
<span id="cb49-335"><a href="#cb49-335" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-336"><a href="#cb49-336" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten überprüfen</span></span>
<span id="cb49-337"><a href="#cb49-337" aria-hidden="true" tabindex="-1"></a><span class="co"># print(day_period_record_count)</span></span>
<span id="cb49-338"><a href="#cb49-338" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-339"><a href="#cb49-339" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Aktivitätenanzahl pro Tageszeit und Tag im April 2024 als Flächendiagramm</span></span>
<span id="cb49-340"><a href="#cb49-340" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(day_period_record_count, aes(x = day, y = record_count, fill = period, group = period)) +</span></span>
<span id="cb49-341"><a href="#cb49-341" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_area(position = 'stack', alpha = 0.6) +</span></span>
<span id="cb49-342"><a href="#cb49-342" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb49-343"><a href="#cb49-343" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-344"><a href="#cb49-344" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Anzahl der Aktivitäten pro Tageszeit und Tag B (April 2024)",</span></span>
<span id="cb49-345"><a href="#cb49-345" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Aufgeteilt nach Morgen, Mittag, Nachmittag, Abend und Nacht",</span></span>
<span id="cb49-346"><a href="#cb49-346" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Tag",</span></span>
<span id="cb49-347"><a href="#cb49-347" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Anzahl der Aktivitäten",</span></span>
<span id="cb49-348"><a href="#cb49-348" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Tageszeit"</span></span>
<span id="cb49-349"><a href="#cb49-349" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-350"><a href="#cb49-350" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-351"><a href="#cb49-351" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-352"><a href="#cb49-352" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-353"><a href="#cb49-353" aria-hidden="true" tabindex="-1"></a><span class="co"># #_____________________________________________________________________________________________</span></span>
<span id="cb49-354"><a href="#cb49-354" aria-hidden="true" tabindex="-1"></a><span class="co"># #_____________________________________________________________________________________________</span></span>
<span id="cb49-355"><a href="#cb49-355" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-356"><a href="#cb49-356" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reihenfolge der Tageszeiten definieren</span></span>
<span id="cb49-357"><a href="#cb49-357" aria-hidden="true" tabindex="-1"></a><span class="co"># levels_order &lt;- c("Morgen (06-10 Uhr)", "Mittag (10-14 Uhr)", "Nachmittag (14-18 Uhr)", "Abend (18-22 Uhr)", "Nacht (22-06 Uhr)")</span></span>
<span id="cb49-358"><a href="#cb49-358" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data$period &lt;- factor(As_data$period, levels = levels_order)</span></span>
<span id="cb49-359"><a href="#cb49-359" aria-hidden="true" tabindex="-1"></a><span class="co"># Bs_data$period &lt;- factor(Bs_data$period, levels = levels_order)</span></span>
<span id="cb49-360"><a href="#cb49-360" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-361"><a href="#cb49-361" aria-hidden="true" tabindex="-1"></a><span class="co"># # Datenanalyse für die Anzahl der Aufzeichnungen nach Tageszeit und Tag für beide Datensätze</span></span>
<span id="cb49-362"><a href="#cb49-362" aria-hidden="true" tabindex="-1"></a><span class="co"># A_day_period_record_count &lt;- As_data %&gt;%</span></span>
<span id="cb49-363"><a href="#cb49-363" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(day, period) %&gt;%</span></span>
<span id="cb49-364"><a href="#cb49-364" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(record_count = n(), .groups = 'drop') %&gt;%</span></span>
<span id="cb49-365"><a href="#cb49-365" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(person = "A")</span></span>
<span id="cb49-366"><a href="#cb49-366" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-367"><a href="#cb49-367" aria-hidden="true" tabindex="-1"></a><span class="co"># B_day_period_record_count &lt;- Bs_data %&gt;%</span></span>
<span id="cb49-368"><a href="#cb49-368" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(day, period) %&gt;%</span></span>
<span id="cb49-369"><a href="#cb49-369" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(record_count = n(), .groups = 'drop') %&gt;%</span></span>
<span id="cb49-370"><a href="#cb49-370" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(person = "B")</span></span>
<span id="cb49-371"><a href="#cb49-371" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-372"><a href="#cb49-372" aria-hidden="true" tabindex="-1"></a><span class="co"># # Kombinieren der Datensätze</span></span>
<span id="cb49-373"><a href="#cb49-373" aria-hidden="true" tabindex="-1"></a><span class="co"># combined_data &lt;- bind_rows(A_day_period_record_count, B_day_period_record_count)</span></span>
<span id="cb49-374"><a href="#cb49-374" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-375"><a href="#cb49-375" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Aktivitätenanzahl pro Tageszeit und Tag im April 2024 für beide Personen</span></span>
<span id="cb49-376"><a href="#cb49-376" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(combined_data, aes(x = day, y = record_count, fill = period, group = period)) +</span></span>
<span id="cb49-377"><a href="#cb49-377" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_area(position = 'stack', alpha = 0.6) +</span></span>
<span id="cb49-378"><a href="#cb49-378" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_wrap(~ person) +</span></span>
<span id="cb49-379"><a href="#cb49-379" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set3") +</span></span>
<span id="cb49-380"><a href="#cb49-380" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-381"><a href="#cb49-381" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Anzahl der Aktivitäten pro Tageszeit und Tag (April 2024)",</span></span>
<span id="cb49-382"><a href="#cb49-382" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Vergleich zwischen A und B",</span></span>
<span id="cb49-383"><a href="#cb49-383" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Tag",</span></span>
<span id="cb49-384"><a href="#cb49-384" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Anzahl der Aktivitäten",</span></span>
<span id="cb49-385"><a href="#cb49-385" aria-hidden="true" tabindex="-1"></a><span class="co">#     fill = "Tageszeit"</span></span>
<span id="cb49-386"><a href="#cb49-386" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-387"><a href="#cb49-387" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-388"><a href="#cb49-388" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-389"><a href="#cb49-389" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-390"><a href="#cb49-390" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-391"><a href="#cb49-391" aria-hidden="true" tabindex="-1"></a><span class="co"># ___________________________-----------------------------</span></span>
<span id="cb49-392"><a href="#cb49-392" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-393"><a href="#cb49-393" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-394"><a href="#cb49-394" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-395"><a href="#cb49-395" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-396"><a href="#cb49-396" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-397"><a href="#cb49-397" aria-hidden="true" tabindex="-1"></a><span class="co"># # A</span></span>
<span id="cb49-398"><a href="#cb49-398" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-399"><a href="#cb49-399" aria-hidden="true" tabindex="-1"></a><span class="co"># # Funktion, um Monate in Jahreszeiten umzuwandeln</span></span>
<span id="cb49-400"><a href="#cb49-400" aria-hidden="true" tabindex="-1"></a><span class="co"># month_to_season &lt;- function(month) {</span></span>
<span id="cb49-401"><a href="#cb49-401" aria-hidden="true" tabindex="-1"></a><span class="co">#   ifelse(month %in% c(12, 1, 2), "Winter",</span></span>
<span id="cb49-402"><a href="#cb49-402" aria-hidden="true" tabindex="-1"></a><span class="co">#          ifelse(month %in% c(3, 4, 5), "Frühling",</span></span>
<span id="cb49-403"><a href="#cb49-403" aria-hidden="true" tabindex="-1"></a><span class="co">#                 ifelse(month %in% c(6, 7, 8), "Sommer", "Herbst")))</span></span>
<span id="cb49-404"><a href="#cb49-404" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-405"><a href="#cb49-405" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-406"><a href="#cb49-406" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A von Januar 2022 bis heute vorbereiten</span></span>
<span id="cb49-407"><a href="#cb49-407" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-408"><a href="#cb49-408" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-409"><a href="#cb49-409" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-410"><a href="#cb49-410" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp),</span></span>
<span id="cb49-411"><a href="#cb49-411" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month)</span></span>
<span id="cb49-412"><a href="#cb49-412" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-413"><a href="#cb49-413" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year(timestamp) &gt;= 2022 &amp; timestamp &gt;= as.POSIXct("2022-01-01", tz = "UTC")) %&gt;%</span></span>
<span id="cb49-414"><a href="#cb49-414" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb49-415"><a href="#cb49-415" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-416"><a href="#cb49-416" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp),</span></span>
<span id="cb49-417"><a href="#cb49-417" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours"))</span></span>
<span id="cb49-418"><a href="#cb49-418" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-419"><a href="#cb49-419" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Letzten Eintrag entfernen, da keine nachfolgende Zeit</span></span>
<span id="cb49-420"><a href="#cb49-420" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-421"><a href="#cb49-421" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-422"><a href="#cb49-422" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten nach Jahreszeit gruppieren und Anzahl der Datensätze pro Saison zählen</span></span>
<span id="cb49-423"><a href="#cb49-423" aria-hidden="true" tabindex="-1"></a><span class="co"># seasonal_data_count &lt;- As_data %&gt;%</span></span>
<span id="cb49-424"><a href="#cb49-424" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(season) %&gt;%</span></span>
<span id="cb49-425"><a href="#cb49-425" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(count = n(), .groups = 'drop')</span></span>
<span id="cb49-426"><a href="#cb49-426" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-427"><a href="#cb49-427" aria-hidden="true" tabindex="-1"></a><span class="co"># # Median der Gesamtzählungen für jede Jahreszeit berechnen</span></span>
<span id="cb49-428"><a href="#cb49-428" aria-hidden="true" tabindex="-1"></a><span class="co"># seasonal_median_count &lt;- seasonal_data_count %&gt;%</span></span>
<span id="cb49-429"><a href="#cb49-429" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(median_count = median(count), .groups = 'drop')</span></span>
<span id="cb49-430"><a href="#cb49-430" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-431"><a href="#cb49-431" aria-hidden="true" tabindex="-1"></a><span class="co"># # Säulendiagramm erstellen zur Anzeige der Anzahl der Datensätze pro Jahreszeit</span></span>
<span id="cb49-432"><a href="#cb49-432" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(seasonal_data_count, aes(x = season, y = count, fill = season)) +</span></span>
<span id="cb49-433"><a href="#cb49-433" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col() +</span></span>
<span id="cb49-434"><a href="#cb49-434" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_errorbar(aes(ymin = count, ymax = count), width = .2, position = position_dodge(0.9)) +</span></span>
<span id="cb49-435"><a href="#cb49-435" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_hline(data = seasonal_median_count, aes(yintercept = median_count),</span></span>
<span id="cb49-436"><a href="#cb49-436" aria-hidden="true" tabindex="-1"></a><span class="co">#              color = "red", linetype = "dashed", linewidth = 1) +</span></span>
<span id="cb49-437"><a href="#cb49-437" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set1", name = "Jahreszeit") +</span></span>
<span id="cb49-438"><a href="#cb49-438" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-439"><a href="#cb49-439" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Anzahl der Datensätze von A nach Jahreszeit",</span></span>
<span id="cb49-440"><a href="#cb49-440" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Datenanalyse ab Januar 2022",</span></span>
<span id="cb49-441"><a href="#cb49-441" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Anzahl der Datensätze",</span></span>
<span id="cb49-442"><a href="#cb49-442" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahreszeit",</span></span>
<span id="cb49-443"><a href="#cb49-443" aria-hidden="true" tabindex="-1"></a><span class="co">#     caption = "Jahreszeiten: Frühling (März-Mai), Sommer (Juni-Aug), Herbst (Sept-Nov), Winter (Dez-Feb)"</span></span>
<span id="cb49-444"><a href="#cb49-444" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-445"><a href="#cb49-445" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-446"><a href="#cb49-446" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-447"><a href="#cb49-447" aria-hidden="true" tabindex="-1"></a><span class="co"># #_________________________________________________________________________________________________</span></span>
<span id="cb49-448"><a href="#cb49-448" aria-hidden="true" tabindex="-1"></a><span class="co"># # nach Zeitdauer</span></span>
<span id="cb49-449"><a href="#cb49-449" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-450"><a href="#cb49-450" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A von Januar 2022 bis heute vorbereiten</span></span>
<span id="cb49-451"><a href="#cb49-451" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-452"><a href="#cb49-452" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-453"><a href="#cb49-453" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC")</span></span>
<span id="cb49-454"><a href="#cb49-454" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-455"><a href="#cb49-455" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year(timestamp) &gt;= 2022 &amp; timestamp &gt;= as.POSIXct("2022-01-01", tz = "UTC")) %&gt;%</span></span>
<span id="cb49-456"><a href="#cb49-456" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-457"><a href="#cb49-457" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp),</span></span>
<span id="cb49-458"><a href="#cb49-458" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month)</span></span>
<span id="cb49-459"><a href="#cb49-459" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-460"><a href="#cb49-460" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb49-461"><a href="#cb49-461" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-462"><a href="#cb49-462" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp),</span></span>
<span id="cb49-463"><a href="#cb49-463" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours"))</span></span>
<span id="cb49-464"><a href="#cb49-464" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-465"><a href="#cb49-465" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Letzten Eintrag entfernen, da keine nachfolgende Zeit</span></span>
<span id="cb49-466"><a href="#cb49-466" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-467"><a href="#cb49-467" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-468"><a href="#cb49-468" aria-hidden="true" tabindex="-1"></a><span class="co"># # Gesamtdauer pro Jahreszeit berechnen</span></span>
<span id="cb49-469"><a href="#cb49-469" aria-hidden="true" tabindex="-1"></a><span class="co"># total_duration_per_season &lt;- As_data %&gt;%</span></span>
<span id="cb49-470"><a href="#cb49-470" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(season) %&gt;%</span></span>
<span id="cb49-471"><a href="#cb49-471" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_duration = sum(duration), .groups = 'drop')</span></span>
<span id="cb49-472"><a href="#cb49-472" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-473"><a href="#cb49-473" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot der Gesamtdauer der Bewegung pro Jahreszeit in Stunden</span></span>
<span id="cb49-474"><a href="#cb49-474" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(total_duration_per_season, aes(x = season, y = total_duration, fill = season)) +</span></span>
<span id="cb49-475"><a href="#cb49-475" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col() +</span></span>
<span id="cb49-476"><a href="#cb49-476" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-477"><a href="#cb49-477" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Gesamtdauer der Bewegung von A nach Jahreszeit in Stunden",</span></span>
<span id="cb49-478"><a href="#cb49-478" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Datenanalyse ab Januar 2022",</span></span>
<span id="cb49-479"><a href="#cb49-479" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Gesamtdauer (Stunden)",</span></span>
<span id="cb49-480"><a href="#cb49-480" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahreszeit",</span></span>
<span id="cb49-481"><a href="#cb49-481" aria-hidden="true" tabindex="-1"></a><span class="co">#     caption = "Jahreszeiten: Frühling (März-Mai), Sommer (Juni-Aug), Herbst (Sept-Nov), Winter (Dez-Feb)"</span></span>
<span id="cb49-482"><a href="#cb49-482" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-483"><a href="#cb49-483" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-484"><a href="#cb49-484" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-485"><a href="#cb49-485" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-486"><a href="#cb49-486" aria-hidden="true" tabindex="-1"></a><span class="co"># #_________________________________________________________________________________________________</span></span>
<span id="cb49-487"><a href="#cb49-487" aria-hidden="true" tabindex="-1"></a><span class="co"># # Diagramme kombinieren</span></span>
<span id="cb49-488"><a href="#cb49-488" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-489"><a href="#cb49-489" aria-hidden="true" tabindex="-1"></a><span class="co"># # Funktion, um Monate in Jahreszeiten umzuwandeln</span></span>
<span id="cb49-490"><a href="#cb49-490" aria-hidden="true" tabindex="-1"></a><span class="co"># month_to_season &lt;- function(month) {</span></span>
<span id="cb49-491"><a href="#cb49-491" aria-hidden="true" tabindex="-1"></a><span class="co">#   ifelse(month %in% c(12, 1, 2), "Winter",</span></span>
<span id="cb49-492"><a href="#cb49-492" aria-hidden="true" tabindex="-1"></a><span class="co">#          ifelse(month %in% c(3, 4, 5), "Frühling",</span></span>
<span id="cb49-493"><a href="#cb49-493" aria-hidden="true" tabindex="-1"></a><span class="co">#                 ifelse(month %in% c(6, 7, 8), "Sommer", "Herbst")))</span></span>
<span id="cb49-494"><a href="#cb49-494" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-495"><a href="#cb49-495" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-496"><a href="#cb49-496" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A von Januar 2022 bis heute vorbereiten</span></span>
<span id="cb49-497"><a href="#cb49-497" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-498"><a href="#cb49-498" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-499"><a href="#cb49-499" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-500"><a href="#cb49-500" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp),</span></span>
<span id="cb49-501"><a href="#cb49-501" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month)</span></span>
<span id="cb49-502"><a href="#cb49-502" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-503"><a href="#cb49-503" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year(timestamp) &gt;= 2022 &amp; timestamp &gt;= as.POSIXct("2022-01-01", tz = "UTC")) %&gt;%</span></span>
<span id="cb49-504"><a href="#cb49-504" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb49-505"><a href="#cb49-505" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-506"><a href="#cb49-506" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp),</span></span>
<span id="cb49-507"><a href="#cb49-507" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours"))</span></span>
<span id="cb49-508"><a href="#cb49-508" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-509"><a href="#cb49-509" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Letzten Eintrag entfernen, da keine nachfolgende Zeit</span></span>
<span id="cb49-510"><a href="#cb49-510" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-511"><a href="#cb49-511" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-512"><a href="#cb49-512" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten nach Jahreszeit gruppieren und Anzahl der Datensätze pro Saison zählen</span></span>
<span id="cb49-513"><a href="#cb49-513" aria-hidden="true" tabindex="-1"></a><span class="co"># seasonal_data_count &lt;- As_data %&gt;%</span></span>
<span id="cb49-514"><a href="#cb49-514" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(season) %&gt;%</span></span>
<span id="cb49-515"><a href="#cb49-515" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(count = n(), .groups = 'drop')</span></span>
<span id="cb49-516"><a href="#cb49-516" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-517"><a href="#cb49-517" aria-hidden="true" tabindex="-1"></a><span class="co"># # Gesamtdauer pro Jahreszeit berechnen</span></span>
<span id="cb49-518"><a href="#cb49-518" aria-hidden="true" tabindex="-1"></a><span class="co"># total_duration_per_season &lt;- As_data %&gt;%</span></span>
<span id="cb49-519"><a href="#cb49-519" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(season) %&gt;%</span></span>
<span id="cb49-520"><a href="#cb49-520" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_duration = sum(duration), .groups = 'drop')</span></span>
<span id="cb49-521"><a href="#cb49-521" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-522"><a href="#cb49-522" aria-hidden="true" tabindex="-1"></a><span class="co"># # Normalisierung der Werte</span></span>
<span id="cb49-523"><a href="#cb49-523" aria-hidden="true" tabindex="-1"></a><span class="co"># max_count &lt;- max(seasonal_data_count$count)</span></span>
<span id="cb49-524"><a href="#cb49-524" aria-hidden="true" tabindex="-1"></a><span class="co"># max_duration &lt;- max(total_duration_per_season$total_duration)</span></span>
<span id="cb49-525"><a href="#cb49-525" aria-hidden="true" tabindex="-1"></a><span class="co"># seasonal_data_count$normalized_count &lt;- seasonal_data_count$count / max_count</span></span>
<span id="cb49-526"><a href="#cb49-526" aria-hidden="true" tabindex="-1"></a><span class="co"># total_duration_per_season$normalized_duration &lt;- total_duration_per_season$total_duration / max_duration</span></span>
<span id="cb49-527"><a href="#cb49-527" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-528"><a href="#cb49-528" aria-hidden="true" tabindex="-1"></a><span class="co"># # Überlagerte Visualisierung</span></span>
<span id="cb49-529"><a href="#cb49-529" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb49-530"><a href="#cb49-530" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col(data = seasonal_data_count, aes(x = season, y = normalized_count, fill = "Anzahl der Datensätze"), alpha = 0.5) +</span></span>
<span id="cb49-531"><a href="#cb49-531" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(data = total_duration_per_season, aes(x = season, y = normalized_duration, group = 1, color = "Gesamtdauer"), size = 1) +</span></span>
<span id="cb49-532"><a href="#cb49-532" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_manual(name = "Legende", values = c("Anzahl der Datensätze" = "blue"), labels = c("Anzahl der Datensätze")) +</span></span>
<span id="cb49-533"><a href="#cb49-533" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(name = "", values = c("Gesamtdauer" = "red"), labels = c("Gesamtdauer (normalisiert)")) +</span></span>
<span id="cb49-534"><a href="#cb49-534" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Vergleich von Datensätzen und Bewegungsdauer",</span></span>
<span id="cb49-535"><a href="#cb49-535" aria-hidden="true" tabindex="-1"></a><span class="co">#        subtitle = "Jahreszeitenanalyse ab Januar 2022",</span></span>
<span id="cb49-536"><a href="#cb49-536" aria-hidden="true" tabindex="-1"></a><span class="co">#        x = "Jahreszeit", y = "Normalisierte Werte") +</span></span>
<span id="cb49-537"><a href="#cb49-537" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-538"><a href="#cb49-538" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = "bottom")</span></span>
<span id="cb49-539"><a href="#cb49-539" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-540"><a href="#cb49-540" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-541"><a href="#cb49-541" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-542"><a href="#cb49-542" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-543"><a href="#cb49-543" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-544"><a href="#cb49-544" aria-hidden="true" tabindex="-1"></a><span class="co"># # Berechne die Korrelation</span></span>
<span id="cb49-545"><a href="#cb49-545" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation_result &lt;- cor(seasonal_data_count$normalized_count, total_duration_per_season$normalized_duration)</span></span>
<span id="cb49-546"><a href="#cb49-546" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-547"><a href="#cb49-547" aria-hidden="true" tabindex="-1"></a><span class="co"># # Erstelle eine kombinierte Visualisierung</span></span>
<span id="cb49-548"><a href="#cb49-548" aria-hidden="true" tabindex="-1"></a><span class="co"># combined_plot &lt;- ggplot() +</span></span>
<span id="cb49-549"><a href="#cb49-549" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col(data = seasonal_data_count, aes(x = season, y = normalized_count, fill = "Anzahl der Datensätze"), alpha = 0.5) +</span></span>
<span id="cb49-550"><a href="#cb49-550" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(data = total_duration_per_season, aes(x = season, y = normalized_duration, group = 1, color = "Gesamtdauer"), size = 1) +</span></span>
<span id="cb49-551"><a href="#cb49-551" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_text(aes(x = 3, y = 1, label = sprintf("Korrelation: %.2f", correlation_result)), parse = TRUE, hjust = 1) +</span></span>
<span id="cb49-552"><a href="#cb49-552" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_manual(name = "Legende", values = c("Anzahl der Datensätze" = "blue"), labels = c("Anzahl der Datensätze")) +</span></span>
<span id="cb49-553"><a href="#cb49-553" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(name = "", values = c("Gesamtdauer" = "red"), labels = c("Gesamtdauer (normalisiert)")) +</span></span>
<span id="cb49-554"><a href="#cb49-554" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Vergleich von Datensätzen und Bewegungsdauer",</span></span>
<span id="cb49-555"><a href="#cb49-555" aria-hidden="true" tabindex="-1"></a><span class="co">#        subtitle = "Jahreszeitenanalyse ab Januar 2022",</span></span>
<span id="cb49-556"><a href="#cb49-556" aria-hidden="true" tabindex="-1"></a><span class="co">#        x = "Jahreszeit", y = "Normalisierte Werte",</span></span>
<span id="cb49-557"><a href="#cb49-557" aria-hidden="true" tabindex="-1"></a><span class="co">#        caption = paste("Korrelation zwischen Datensätzen und Gesamtdauer: ", sprintf("%.2f", correlation_result),</span></span>
<span id="cb49-558"><a href="#cb49-558" aria-hidden="true" tabindex="-1"></a><span class="co">#                        "\nEine Korrelation nahe 1 zeigt eine starke positive Beziehung.")) +</span></span>
<span id="cb49-559"><a href="#cb49-559" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-560"><a href="#cb49-560" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = "bottom", plot.caption = element_text(hjust = 0))</span></span>
<span id="cb49-561"><a href="#cb49-561" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-562"><a href="#cb49-562" aria-hidden="true" tabindex="-1"></a><span class="co"># print(combined_plot)</span></span>
<span id="cb49-563"><a href="#cb49-563" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-564"><a href="#cb49-564" aria-hidden="true" tabindex="-1"></a><span class="co"># #_________________________________________________________________________________________________</span></span>
<span id="cb49-565"><a href="#cb49-565" aria-hidden="true" tabindex="-1"></a><span class="co"># # Analyse per Montate einzeln:</span></span>
<span id="cb49-566"><a href="#cb49-566" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-567"><a href="#cb49-567" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-568"><a href="#cb49-568" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-569"><a href="#cb49-569" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-570"><a href="#cb49-570" aria-hidden="true" tabindex="-1"></a><span class="co"># # Funktion, um Monate in Jahreszeiten umzuwandeln</span></span>
<span id="cb49-571"><a href="#cb49-571" aria-hidden="true" tabindex="-1"></a><span class="co"># month_to_season &lt;- function(month) {</span></span>
<span id="cb49-572"><a href="#cb49-572" aria-hidden="true" tabindex="-1"></a><span class="co">#   ifelse(month %in% c(12, 1, 2), "Winter",</span></span>
<span id="cb49-573"><a href="#cb49-573" aria-hidden="true" tabindex="-1"></a><span class="co">#          ifelse(month %in% c(3, 4, 5), "Frühling",</span></span>
<span id="cb49-574"><a href="#cb49-574" aria-hidden="true" tabindex="-1"></a><span class="co">#                 ifelse(month %in% c(6, 7, 8), "Sommer", "Herbst")))</span></span>
<span id="cb49-575"><a href="#cb49-575" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-576"><a href="#cb49-576" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-577"><a href="#cb49-577" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A von Januar 2022 bis heute vorbereiten</span></span>
<span id="cb49-578"><a href="#cb49-578" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-579"><a href="#cb49-579" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-580"><a href="#cb49-580" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-581"><a href="#cb49-581" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = format(timestamp, "%Y-%m"), # Erstelle eine neue Spalte für Monat im Format Jahr-Monat</span></span>
<span id="cb49-582"><a href="#cb49-582" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month(timestamp))</span></span>
<span id="cb49-583"><a href="#cb49-583" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-584"><a href="#cb49-584" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(timestamp &gt;= as.POSIXct("2022-01-01", tz = "UTC")) %&gt;%</span></span>
<span id="cb49-585"><a href="#cb49-585" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb49-586"><a href="#cb49-586" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-587"><a href="#cb49-587" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp),</span></span>
<span id="cb49-588"><a href="#cb49-588" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours"))</span></span>
<span id="cb49-589"><a href="#cb49-589" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-590"><a href="#cb49-590" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-591"><a href="#cb49-591" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-592"><a href="#cb49-592" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten nach Monat gruppieren und Anzahl der Datensätze pro Monat sowie Gesamtdauer zählen</span></span>
<span id="cb49-593"><a href="#cb49-593" aria-hidden="true" tabindex="-1"></a><span class="co"># monthly_data_summary &lt;- As_data %&gt;%</span></span>
<span id="cb49-594"><a href="#cb49-594" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month) %&gt;%</span></span>
<span id="cb49-595"><a href="#cb49-595" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(</span></span>
<span id="cb49-596"><a href="#cb49-596" aria-hidden="true" tabindex="-1"></a><span class="co">#     count = n(),</span></span>
<span id="cb49-597"><a href="#cb49-597" aria-hidden="true" tabindex="-1"></a><span class="co">#     total_duration = sum(duration),</span></span>
<span id="cb49-598"><a href="#cb49-598" aria-hidden="true" tabindex="-1"></a><span class="co">#     .groups = 'drop'</span></span>
<span id="cb49-599"><a href="#cb49-599" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-600"><a href="#cb49-600" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-601"><a href="#cb49-601" aria-hidden="true" tabindex="-1"></a><span class="co"># # Berechne das Maximum für Skalierungszwecke</span></span>
<span id="cb49-602"><a href="#cb49-602" aria-hidden="true" tabindex="-1"></a><span class="co"># max_count &lt;- max(monthly_data_summary$count)</span></span>
<span id="cb49-603"><a href="#cb49-603" aria-hidden="true" tabindex="-1"></a><span class="co"># max_duration &lt;- max(monthly_data_summary$total_duration)</span></span>
<span id="cb49-604"><a href="#cb49-604" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-605"><a href="#cb49-605" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Daten nach Monat</span></span>
<span id="cb49-606"><a href="#cb49-606" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(monthly_data_summary, aes(x = month)) +</span></span>
<span id="cb49-607"><a href="#cb49-607" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col(aes(y = count), fill = "blue", alpha = 0.7) +</span></span>
<span id="cb49-608"><a href="#cb49-608" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(aes(y = total_duration / max_duration * max_count), color = "red", group = 1) +</span></span>
<span id="cb49-609"><a href="#cb49-609" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(</span></span>
<span id="cb49-610"><a href="#cb49-610" aria-hidden="true" tabindex="-1"></a><span class="co">#     name = "Anzahl der Datensätze",</span></span>
<span id="cb49-611"><a href="#cb49-611" aria-hidden="true" tabindex="-1"></a><span class="co">#     sec.axis = sec_axis(~ . / max_count * max_duration, name = "Gesamtdauer (Stunden)")</span></span>
<span id="cb49-612"><a href="#cb49-612" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-613"><a href="#cb49-613" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-614"><a href="#cb49-614" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Monatliche Analyse der Bewegungsdaten von A",</span></span>
<span id="cb49-615"><a href="#cb49-615" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Von Januar 2022 bis heute",</span></span>
<span id="cb49-616"><a href="#cb49-616" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb49-617"><a href="#cb49-617" aria-hidden="true" tabindex="-1"></a><span class="co">#     caption = "Blaue Balken zeigen die Anzahl der Datensätze, rote Linie zeigt die skalierte Gesamtdauer."</span></span>
<span id="cb49-618"><a href="#cb49-618" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-619"><a href="#cb49-619" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-620"><a href="#cb49-620" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-621"><a href="#cb49-621" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-622"><a href="#cb49-622" aria-hidden="true" tabindex="-1"></a><span class="co"># # Korrelation</span></span>
<span id="cb49-623"><a href="#cb49-623" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-624"><a href="#cb49-624" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-625"><a href="#cb49-625" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-626"><a href="#cb49-626" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A von Januar 2022 bis heute vorbereiten</span></span>
<span id="cb49-627"><a href="#cb49-627" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-628"><a href="#cb49-628" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-629"><a href="#cb49-629" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-630"><a href="#cb49-630" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = format(timestamp, "%Y-%m"), # Erstelle eine neue Spalte für Monat im Format Jahr-Monat</span></span>
<span id="cb49-631"><a href="#cb49-631" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month(timestamp))</span></span>
<span id="cb49-632"><a href="#cb49-632" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-633"><a href="#cb49-633" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(timestamp &gt;= as.POSIXct("2022-01-01", tz = "UTC")) %&gt;%</span></span>
<span id="cb49-634"><a href="#cb49-634" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb49-635"><a href="#cb49-635" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-636"><a href="#cb49-636" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp),</span></span>
<span id="cb49-637"><a href="#cb49-637" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours"))</span></span>
<span id="cb49-638"><a href="#cb49-638" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-639"><a href="#cb49-639" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-640"><a href="#cb49-640" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-641"><a href="#cb49-641" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten nach Monat gruppieren und Anzahl der Datensätze pro Monat sowie Gesamtdauer zählen</span></span>
<span id="cb49-642"><a href="#cb49-642" aria-hidden="true" tabindex="-1"></a><span class="co"># monthly_data_summary &lt;- As_data %&gt;%</span></span>
<span id="cb49-643"><a href="#cb49-643" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month) %&gt;%</span></span>
<span id="cb49-644"><a href="#cb49-644" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(</span></span>
<span id="cb49-645"><a href="#cb49-645" aria-hidden="true" tabindex="-1"></a><span class="co">#     count = n(),</span></span>
<span id="cb49-646"><a href="#cb49-646" aria-hidden="true" tabindex="-1"></a><span class="co">#     total_duration = sum(duration),</span></span>
<span id="cb49-647"><a href="#cb49-647" aria-hidden="true" tabindex="-1"></a><span class="co">#     .groups = 'drop'</span></span>
<span id="cb49-648"><a href="#cb49-648" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-649"><a href="#cb49-649" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-650"><a href="#cb49-650" aria-hidden="true" tabindex="-1"></a><span class="co"># # Berechne die Korrelation zwischen der Anzahl der Datensätze und der Gesamtdauer</span></span>
<span id="cb49-651"><a href="#cb49-651" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation_result &lt;- cor(monthly_data_summary$count, monthly_data_summary$total_duration)</span></span>
<span id="cb49-652"><a href="#cb49-652" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-653"><a href="#cb49-653" aria-hidden="true" tabindex="-1"></a><span class="co"># # Berechne das Maximum für Skalierungszwecke</span></span>
<span id="cb49-654"><a href="#cb49-654" aria-hidden="true" tabindex="-1"></a><span class="co"># max_count &lt;- max(monthly_data_summary$count)</span></span>
<span id="cb49-655"><a href="#cb49-655" aria-hidden="true" tabindex="-1"></a><span class="co"># max_duration &lt;- max(monthly_data_summary$total_duration)</span></span>
<span id="cb49-656"><a href="#cb49-656" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-657"><a href="#cb49-657" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Daten nach Monat</span></span>
<span id="cb49-658"><a href="#cb49-658" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(monthly_data_summary, aes(x = month)) +</span></span>
<span id="cb49-659"><a href="#cb49-659" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col(aes(y = count), fill = "blue", alpha = 0.7) +</span></span>
<span id="cb49-660"><a href="#cb49-660" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(aes(y = total_duration / max_duration * max_count), color = "red", group = 1) +</span></span>
<span id="cb49-661"><a href="#cb49-661" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(</span></span>
<span id="cb49-662"><a href="#cb49-662" aria-hidden="true" tabindex="-1"></a><span class="co">#     name = "Anzahl der Datensätze",</span></span>
<span id="cb49-663"><a href="#cb49-663" aria-hidden="true" tabindex="-1"></a><span class="co">#     sec.axis = sec_axis(~ . / max_count * max_duration, name = "Gesamtdauer (Stunden)")</span></span>
<span id="cb49-664"><a href="#cb49-664" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-665"><a href="#cb49-665" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_text(aes(x = 1, y = max_count, label = sprintf("Korrelation: %.2f", correlation_result)), hjust = -0.1, vjust = -0.5, color = "black") +</span></span>
<span id="cb49-666"><a href="#cb49-666" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-667"><a href="#cb49-667" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Monatliche Analyse der Bewegungsdaten von A",</span></span>
<span id="cb49-668"><a href="#cb49-668" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Von Januar 2022 bis heute",</span></span>
<span id="cb49-669"><a href="#cb49-669" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb49-670"><a href="#cb49-670" aria-hidden="true" tabindex="-1"></a><span class="co">#     caption = "Blaue Balken zeigen die Anzahl der Datensätze, rote Linie zeigt die skalierte Gesamtdauer."</span></span>
<span id="cb49-671"><a href="#cb49-671" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-672"><a href="#cb49-672" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-673"><a href="#cb49-673" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-674"><a href="#cb49-674" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-675"><a href="#cb49-675" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-676"><a href="#cb49-676" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-677"><a href="#cb49-677" aria-hidden="true" tabindex="-1"></a><span class="co"># #_________________________________________________________________________________________________</span></span>
<span id="cb49-678"><a href="#cb49-678" aria-hidden="true" tabindex="-1"></a><span class="co"># #_________________________________________________________________________________________________</span></span>
<span id="cb49-679"><a href="#cb49-679" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-680"><a href="#cb49-680" aria-hidden="true" tabindex="-1"></a><span class="co"># # B</span></span>
<span id="cb49-681"><a href="#cb49-681" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-682"><a href="#cb49-682" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-683"><a href="#cb49-683" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-684"><a href="#cb49-684" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-685"><a href="#cb49-685" aria-hidden="true" tabindex="-1"></a><span class="co"># # Funktion, um Monate in Jahreszeiten umzuwandeln</span></span>
<span id="cb49-686"><a href="#cb49-686" aria-hidden="true" tabindex="-1"></a><span class="co"># month_to_season &lt;- function(month) {</span></span>
<span id="cb49-687"><a href="#cb49-687" aria-hidden="true" tabindex="-1"></a><span class="co">#   ifelse(month %in% c(12, 1, 2), "Winter",</span></span>
<span id="cb49-688"><a href="#cb49-688" aria-hidden="true" tabindex="-1"></a><span class="co">#          ifelse(month %in% c(3, 4, 5), "Frühling",</span></span>
<span id="cb49-689"><a href="#cb49-689" aria-hidden="true" tabindex="-1"></a><span class="co">#                 ifelse(month %in% c(6, 7, 8), "Sommer", "Herbst")))</span></span>
<span id="cb49-690"><a href="#cb49-690" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-691"><a href="#cb49-691" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-692"><a href="#cb49-692" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für B von Januar 2022 bis heute vorbereiten</span></span>
<span id="cb49-693"><a href="#cb49-693" aria-hidden="true" tabindex="-1"></a><span class="co"># Bs_data &lt;- records_S %&gt;%</span></span>
<span id="cb49-694"><a href="#cb49-694" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-695"><a href="#cb49-695" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-696"><a href="#cb49-696" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp),</span></span>
<span id="cb49-697"><a href="#cb49-697" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month)</span></span>
<span id="cb49-698"><a href="#cb49-698" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-699"><a href="#cb49-699" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year(timestamp) &gt;= 2022 &amp; timestamp &gt;= as.POSIXct("2022-01-01", tz = "UTC")) %&gt;%</span></span>
<span id="cb49-700"><a href="#cb49-700" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(timestamp) %&gt;%</span></span>
<span id="cb49-701"><a href="#cb49-701" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-702"><a href="#cb49-702" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp),</span></span>
<span id="cb49-703"><a href="#cb49-703" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours"))</span></span>
<span id="cb49-704"><a href="#cb49-704" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-705"><a href="#cb49-705" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Letzten Eintrag entfernen, da keine nachfolgende Zeit</span></span>
<span id="cb49-706"><a href="#cb49-706" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-707"><a href="#cb49-707" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-708"><a href="#cb49-708" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten nach Jahreszeit gruppieren und Anzahl der Datensätze pro Saison zählen</span></span>
<span id="cb49-709"><a href="#cb49-709" aria-hidden="true" tabindex="-1"></a><span class="co"># seasonal_data_count &lt;- Bs_data %&gt;%</span></span>
<span id="cb49-710"><a href="#cb49-710" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(season) %&gt;%</span></span>
<span id="cb49-711"><a href="#cb49-711" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(count = n(), .groups = 'drop')</span></span>
<span id="cb49-712"><a href="#cb49-712" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-713"><a href="#cb49-713" aria-hidden="true" tabindex="-1"></a><span class="co"># # Median der Gesamtzählungen für jede Jahreszeit berechnen</span></span>
<span id="cb49-714"><a href="#cb49-714" aria-hidden="true" tabindex="-1"></a><span class="co"># seasonal_median_count &lt;- seasonal_data_count %&gt;%</span></span>
<span id="cb49-715"><a href="#cb49-715" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(median_count = median(count), .groups = 'drop')</span></span>
<span id="cb49-716"><a href="#cb49-716" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-717"><a href="#cb49-717" aria-hidden="true" tabindex="-1"></a><span class="co"># # Säulendiagramm erstellen zur Anzeige der Anzahl der Datensätze pro Jahreszeit</span></span>
<span id="cb49-718"><a href="#cb49-718" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(seasonal_data_count, aes(x = season, y = count, fill = season)) +</span></span>
<span id="cb49-719"><a href="#cb49-719" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col() +</span></span>
<span id="cb49-720"><a href="#cb49-720" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_errorbar(aes(ymin = count, ymax = count), width = .2, position = position_dodge(0.9)) +</span></span>
<span id="cb49-721"><a href="#cb49-721" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_hline(data = seasonal_median_count, aes(yintercept = median_count),</span></span>
<span id="cb49-722"><a href="#cb49-722" aria-hidden="true" tabindex="-1"></a><span class="co">#              color = "red", linetype = "dashed", linewidth = 1) +</span></span>
<span id="cb49-723"><a href="#cb49-723" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set1", name = "Jahreszeit") +</span></span>
<span id="cb49-724"><a href="#cb49-724" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-725"><a href="#cb49-725" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Anzahl der Datensätze von B nach Jahreszeit",</span></span>
<span id="cb49-726"><a href="#cb49-726" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Datenanalyse ab Januar 2022",</span></span>
<span id="cb49-727"><a href="#cb49-727" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Anzahl der Datensätze",</span></span>
<span id="cb49-728"><a href="#cb49-728" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahreszeit",</span></span>
<span id="cb49-729"><a href="#cb49-729" aria-hidden="true" tabindex="-1"></a><span class="co">#     caption = "Jahreszeiten: Frühling (März-Mai), Sommer (Juni-Aug), Herbst (Sept-Nov), Winter (Dez-Feb)"</span></span>
<span id="cb49-730"><a href="#cb49-730" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-731"><a href="#cb49-731" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-732"><a href="#cb49-732" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-733"><a href="#cb49-733" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-734"><a href="#cb49-734" aria-hidden="true" tabindex="-1"></a><span class="co"># # Gesamtdauer pro Jahreszeit berechnen</span></span>
<span id="cb49-735"><a href="#cb49-735" aria-hidden="true" tabindex="-1"></a><span class="co"># total_duration_per_season &lt;- Bs_data %&gt;%</span></span>
<span id="cb49-736"><a href="#cb49-736" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(season) %&gt;%</span></span>
<span id="cb49-737"><a href="#cb49-737" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(total_duration = sum(duration), .groups = 'drop')</span></span>
<span id="cb49-738"><a href="#cb49-738" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-739"><a href="#cb49-739" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot der Gesamtdauer der Bewegung pro Jahreszeit in Stunden</span></span>
<span id="cb49-740"><a href="#cb49-740" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(total_duration_per_season, aes(x = season, y = total_duration, fill = season)) +</span></span>
<span id="cb49-741"><a href="#cb49-741" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col() +</span></span>
<span id="cb49-742"><a href="#cb49-742" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-743"><a href="#cb49-743" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Gesamtdauer der Bewegung von B nach Jahreszeit in Stunden",</span></span>
<span id="cb49-744"><a href="#cb49-744" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Datenanalyse ab Januar 2022",</span></span>
<span id="cb49-745"><a href="#cb49-745" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Gesamtdauer (Stunden)",</span></span>
<span id="cb49-746"><a href="#cb49-746" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahreszeit",</span></span>
<span id="cb49-747"><a href="#cb49-747" aria-hidden="true" tabindex="-1"></a><span class="co">#     caption = "Jahreszeiten: Frühling (März-Mai), Sommer (Juni-Aug), Herbst (Sept-Nov), Winter (Dez-Feb)"</span></span>
<span id="cb49-748"><a href="#cb49-748" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-749"><a href="#cb49-749" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-750"><a href="#cb49-750" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-751"><a href="#cb49-751" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-752"><a href="#cb49-752" aria-hidden="true" tabindex="-1"></a><span class="co"># # Analyse per Monate einzeln:</span></span>
<span id="cb49-753"><a href="#cb49-753" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten nach Monat gruppieren und Anzahl der Datensätze pro Monat sowie Gesamtdauer zählen</span></span>
<span id="cb49-754"><a href="#cb49-754" aria-hidden="true" tabindex="-1"></a><span class="co"># monthly_data_summary &lt;- Bs_data %&gt;%</span></span>
<span id="cb49-755"><a href="#cb49-755" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(month) %&gt;%</span></span>
<span id="cb49-756"><a href="#cb49-756" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(</span></span>
<span id="cb49-757"><a href="#cb49-757" aria-hidden="true" tabindex="-1"></a><span class="co">#     count = n(),</span></span>
<span id="cb49-758"><a href="#cb49-758" aria-hidden="true" tabindex="-1"></a><span class="co">#     total_duration = sum(duration),</span></span>
<span id="cb49-759"><a href="#cb49-759" aria-hidden="true" tabindex="-1"></a><span class="co">#     .groups = 'drop'</span></span>
<span id="cb49-760"><a href="#cb49-760" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-761"><a href="#cb49-761" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-762"><a href="#cb49-762" aria-hidden="true" tabindex="-1"></a><span class="co"># # Berechne die Korrelation zwischen der Anzahl der Datensätze und der Gesamtdauer</span></span>
<span id="cb49-763"><a href="#cb49-763" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation_result &lt;- cor(monthly_data_summary$count, monthly_data_summary$total_duration)</span></span>
<span id="cb49-764"><a href="#cb49-764" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-765"><a href="#cb49-765" aria-hidden="true" tabindex="-1"></a><span class="co"># # Berechne das Maximum für Skalierungszwecke</span></span>
<span id="cb49-766"><a href="#cb49-766" aria-hidden="true" tabindex="-1"></a><span class="co"># max_count &lt;- max(monthly_data_summary$count)</span></span>
<span id="cb49-767"><a href="#cb49-767" aria-hidden="true" tabindex="-1"></a><span class="co"># max_duration &lt;- max(monthly_data_summary$total_duration)</span></span>
<span id="cb49-768"><a href="#cb49-768" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-769"><a href="#cb49-769" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Daten nach Monat</span></span>
<span id="cb49-770"><a href="#cb49-770" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(monthly_data_summary, aes(x = month)) +</span></span>
<span id="cb49-771"><a href="#cb49-771" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col(aes(y = count), fill = "blue", alpha = 0.7) +</span></span>
<span id="cb49-772"><a href="#cb49-772" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(aes(y = total_duration / max_duration * max_count), color = "red", group = 1) +</span></span>
<span id="cb49-773"><a href="#cb49-773" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(</span></span>
<span id="cb49-774"><a href="#cb49-774" aria-hidden="true" tabindex="-1"></a><span class="co">#     name = "Anzahl der Datensätze",</span></span>
<span id="cb49-775"><a href="#cb49-775" aria-hidden="true" tabindex="-1"></a><span class="co">#     sec.axis = sec_axis(~ . / max_count * max_duration, name = "Gesamtdauer (Stunden)")</span></span>
<span id="cb49-776"><a href="#cb49-776" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-777"><a href="#cb49-777" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_text(aes(x = 1, y = max_count, label = sprintf("Korrelation: %.2f", correlation_result)), hjust = -0.1, vjust = -0.5, color = "black") +</span></span>
<span id="cb49-778"><a href="#cb49-778" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-779"><a href="#cb49-779" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Monatliche Analyse der Bewegungsdaten von B",</span></span>
<span id="cb49-780"><a href="#cb49-780" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Von Januar 2022 bis heute",</span></span>
<span id="cb49-781"><a href="#cb49-781" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Monat",</span></span>
<span id="cb49-782"><a href="#cb49-782" aria-hidden="true" tabindex="-1"></a><span class="co">#     caption = "Blaue Balken zeigen die Anzahl der Datensätze, rote Linie zeigt die skalierte Gesamtdauer."</span></span>
<span id="cb49-783"><a href="#cb49-783" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-784"><a href="#cb49-784" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-785"><a href="#cb49-785" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-786"><a href="#cb49-786" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-787"><a href="#cb49-787" aria-hidden="true" tabindex="-1"></a><span class="co"># #_________________________________________________________________________________________________</span></span>
<span id="cb49-788"><a href="#cb49-788" aria-hidden="true" tabindex="-1"></a><span class="co"># #_________________________________________________________________________________________________</span></span>
<span id="cb49-789"><a href="#cb49-789" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-790"><a href="#cb49-790" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ueberlagerung</span></span>
<span id="cb49-791"><a href="#cb49-791" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-792"><a href="#cb49-792" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-793"><a href="#cb49-793" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-794"><a href="#cb49-794" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-795"><a href="#cb49-795" aria-hidden="true" tabindex="-1"></a><span class="co"># # Funktion, um Monate in Jahreszeiten umzuwandeln</span></span>
<span id="cb49-796"><a href="#cb49-796" aria-hidden="true" tabindex="-1"></a><span class="co"># month_to_season &lt;- function(month) {</span></span>
<span id="cb49-797"><a href="#cb49-797" aria-hidden="true" tabindex="-1"></a><span class="co">#   ifelse(month %in% c(12, 1, 2), "Winter",</span></span>
<span id="cb49-798"><a href="#cb49-798" aria-hidden="true" tabindex="-1"></a><span class="co">#          ifelse(month %in% c(3, 4, 5), "Frühling",</span></span>
<span id="cb49-799"><a href="#cb49-799" aria-hidden="true" tabindex="-1"></a><span class="co">#                 ifelse(month %in% c(6, 7, 8), "Sommer", "Herbst")))</span></span>
<span id="cb49-800"><a href="#cb49-800" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-801"><a href="#cb49-801" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-802"><a href="#cb49-802" aria-hidden="true" tabindex="-1"></a><span class="co"># # Spezifiziere den Zeitraum für die Analyse</span></span>
<span id="cb49-803"><a href="#cb49-803" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date &lt;- as.POSIXct("2024-04-07T17:58:12.052Z", tz = "UTC")</span></span>
<span id="cb49-804"><a href="#cb49-804" aria-hidden="true" tabindex="-1"></a><span class="co"># end_date &lt;- as.POSIXct("2024-05-15T21:46:26.529Z", tz = "UTC")</span></span>
<span id="cb49-805"><a href="#cb49-805" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-806"><a href="#cb49-806" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A und B vorbereiten</span></span>
<span id="cb49-807"><a href="#cb49-807" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-808"><a href="#cb49-808" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-809"><a href="#cb49-809" aria-hidden="true" tabindex="-1"></a><span class="co">#     Person = "A",</span></span>
<span id="cb49-810"><a href="#cb49-810" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-811"><a href="#cb49-811" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month(timestamp)),</span></span>
<span id="cb49-812"><a href="#cb49-812" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp)</span></span>
<span id="cb49-813"><a href="#cb49-813" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-814"><a href="#cb49-814" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(timestamp &gt;= start_date &amp; timestamp &lt;= end_date) %&gt;%</span></span>
<span id="cb49-815"><a href="#cb49-815" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-816"><a href="#cb49-816" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours"))</span></span>
<span id="cb49-817"><a href="#cb49-817" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-818"><a href="#cb49-818" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-819"><a href="#cb49-819" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-820"><a href="#cb49-820" aria-hidden="true" tabindex="-1"></a><span class="co"># Bs_data &lt;- records_S %&gt;%</span></span>
<span id="cb49-821"><a href="#cb49-821" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-822"><a href="#cb49-822" aria-hidden="true" tabindex="-1"></a><span class="co">#     Person = "B",</span></span>
<span id="cb49-823"><a href="#cb49-823" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-824"><a href="#cb49-824" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month(timestamp)),</span></span>
<span id="cb49-825"><a href="#cb49-825" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp)</span></span>
<span id="cb49-826"><a href="#cb49-826" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-827"><a href="#cb49-827" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(timestamp &gt;= start_date &amp; timestamp &lt;= end_date) %&gt;%</span></span>
<span id="cb49-828"><a href="#cb49-828" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-829"><a href="#cb49-829" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours"))</span></span>
<span id="cb49-830"><a href="#cb49-830" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-831"><a href="#cb49-831" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-832"><a href="#cb49-832" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-833"><a href="#cb49-833" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten kombinieren</span></span>
<span id="cb49-834"><a href="#cb49-834" aria-hidden="true" tabindex="-1"></a><span class="co"># combined_data &lt;- bind_rows(As_data, Bs_data)</span></span>
<span id="cb49-835"><a href="#cb49-835" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-836"><a href="#cb49-836" aria-hidden="true" tabindex="-1"></a><span class="co"># # Aggregierte Daten vorbereiten</span></span>
<span id="cb49-837"><a href="#cb49-837" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregated_data &lt;- combined_data %&gt;%</span></span>
<span id="cb49-838"><a href="#cb49-838" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Person, season) %&gt;%</span></span>
<span id="cb49-839"><a href="#cb49-839" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb49-840"><a href="#cb49-840" aria-hidden="true" tabindex="-1"></a><span class="co">#     count = n(),</span></span>
<span id="cb49-841"><a href="#cb49-841" aria-hidden="true" tabindex="-1"></a><span class="co">#     total_duration = sum(duration, na.rm = TRUE),</span></span>
<span id="cb49-842"><a href="#cb49-842" aria-hidden="true" tabindex="-1"></a><span class="co">#     .groups = 'drop'</span></span>
<span id="cb49-843"><a href="#cb49-843" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-844"><a href="#cb49-844" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-845"><a href="#cb49-845" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Daten</span></span>
<span id="cb49-846"><a href="#cb49-846" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(aggregated_data, aes(x = season, y = total_duration, fill = Person)) +</span></span>
<span id="cb49-847"><a href="#cb49-847" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col(position = "dodge") +</span></span>
<span id="cb49-848"><a href="#cb49-848" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set1", name = "Person") +</span></span>
<span id="cb49-849"><a href="#cb49-849" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-850"><a href="#cb49-850" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Vergleich der Aktivitätsdauer nach Jahreszeit und Person im spezifizierten Zeitraum",</span></span>
<span id="cb49-851"><a href="#cb49-851" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Gesamtdauer (Stunden)",</span></span>
<span id="cb49-852"><a href="#cb49-852" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahreszeit",</span></span>
<span id="cb49-853"><a href="#cb49-853" aria-hidden="true" tabindex="-1"></a><span class="co">#     caption = "Jahreszeiten: Frühling (März-Mai), Sommer (Juni-Aug), Herbst (Sept-Nov), Winter (Dez-Feb)"</span></span>
<span id="cb49-854"><a href="#cb49-854" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-855"><a href="#cb49-855" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-856"><a href="#cb49-856" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-857"><a href="#cb49-857" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-858"><a href="#cb49-858" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb49-859"><a href="#cb49-859" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb49-860"><a href="#cb49-860" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb49-861"><a href="#cb49-861" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-862"><a href="#cb49-862" aria-hidden="true" tabindex="-1"></a><span class="co"># # Funktion, um Monate in Jahreszeiten umzuwandeln</span></span>
<span id="cb49-863"><a href="#cb49-863" aria-hidden="true" tabindex="-1"></a><span class="co"># month_to_season &lt;- function(month) {</span></span>
<span id="cb49-864"><a href="#cb49-864" aria-hidden="true" tabindex="-1"></a><span class="co">#   ifelse(month %in% c(12, 1, 2), "Winter",</span></span>
<span id="cb49-865"><a href="#cb49-865" aria-hidden="true" tabindex="-1"></a><span class="co">#          ifelse(month %in% c(3, 4, 5), "Frühling",</span></span>
<span id="cb49-866"><a href="#cb49-866" aria-hidden="true" tabindex="-1"></a><span class="co">#                 ifelse(month %in% c(6, 7, 8), "Sommer", "Herbst")))</span></span>
<span id="cb49-867"><a href="#cb49-867" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-868"><a href="#cb49-868" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-869"><a href="#cb49-869" aria-hidden="true" tabindex="-1"></a><span class="co"># # Spezifiziere den Zeitraum für die Analyse</span></span>
<span id="cb49-870"><a href="#cb49-870" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date &lt;- as.POSIXct("2024-04-07T17:58:12.052Z", tz = "UTC")</span></span>
<span id="cb49-871"><a href="#cb49-871" aria-hidden="true" tabindex="-1"></a><span class="co"># end_date &lt;- as.POSIXct("2024-05-15T21:46:26.529Z", tz = "UTC")</span></span>
<span id="cb49-872"><a href="#cb49-872" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-873"><a href="#cb49-873" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A und B vorbereiten</span></span>
<span id="cb49-874"><a href="#cb49-874" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-875"><a href="#cb49-875" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-876"><a href="#cb49-876" aria-hidden="true" tabindex="-1"></a><span class="co">#     Person = "A",</span></span>
<span id="cb49-877"><a href="#cb49-877" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-878"><a href="#cb49-878" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month(timestamp)),</span></span>
<span id="cb49-879"><a href="#cb49-879" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp)</span></span>
<span id="cb49-880"><a href="#cb49-880" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-881"><a href="#cb49-881" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(timestamp &gt;= start_date &amp; timestamp &lt;= end_date) %&gt;%</span></span>
<span id="cb49-882"><a href="#cb49-882" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-883"><a href="#cb49-883" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours"))</span></span>
<span id="cb49-884"><a href="#cb49-884" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-885"><a href="#cb49-885" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-886"><a href="#cb49-886" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-887"><a href="#cb49-887" aria-hidden="true" tabindex="-1"></a><span class="co"># Bs_data &lt;- records_S %&gt;%</span></span>
<span id="cb49-888"><a href="#cb49-888" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-889"><a href="#cb49-889" aria-hidden="true" tabindex="-1"></a><span class="co">#     Person = "B",</span></span>
<span id="cb49-890"><a href="#cb49-890" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-891"><a href="#cb49-891" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month(timestamp)),</span></span>
<span id="cb49-892"><a href="#cb49-892" aria-hidden="true" tabindex="-1"></a><span class="co">#     next_timestamp = lead(timestamp)</span></span>
<span id="cb49-893"><a href="#cb49-893" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-894"><a href="#cb49-894" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(timestamp &gt;= start_date &amp; timestamp &lt;= end_date) %&gt;%</span></span>
<span id="cb49-895"><a href="#cb49-895" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-896"><a href="#cb49-896" aria-hidden="true" tabindex="-1"></a><span class="co">#     duration = as.numeric(difftime(next_timestamp, timestamp, units = "hours"))</span></span>
<span id="cb49-897"><a href="#cb49-897" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-898"><a href="#cb49-898" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(duration))</span></span>
<span id="cb49-899"><a href="#cb49-899" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-900"><a href="#cb49-900" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten kombinieren</span></span>
<span id="cb49-901"><a href="#cb49-901" aria-hidden="true" tabindex="-1"></a><span class="co"># combined_data &lt;- bind_rows(As_data, Bs_data)</span></span>
<span id="cb49-902"><a href="#cb49-902" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-903"><a href="#cb49-903" aria-hidden="true" tabindex="-1"></a><span class="co"># # Aggregierte Daten vorbereiten</span></span>
<span id="cb49-904"><a href="#cb49-904" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregated_data &lt;- combined_data %&gt;%</span></span>
<span id="cb49-905"><a href="#cb49-905" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Person, season) %&gt;%</span></span>
<span id="cb49-906"><a href="#cb49-906" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb49-907"><a href="#cb49-907" aria-hidden="true" tabindex="-1"></a><span class="co">#     count = n(),</span></span>
<span id="cb49-908"><a href="#cb49-908" aria-hidden="true" tabindex="-1"></a><span class="co">#     total_duration = sum(duration, na.rm = TRUE),</span></span>
<span id="cb49-909"><a href="#cb49-909" aria-hidden="true" tabindex="-1"></a><span class="co">#     .groups = 'drop'</span></span>
<span id="cb49-910"><a href="#cb49-910" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-911"><a href="#cb49-911" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-912"><a href="#cb49-912" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für Korrelation vorbereiten</span></span>
<span id="cb49-913"><a href="#cb49-913" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison_data &lt;- aggregated_data %&gt;%</span></span>
<span id="cb49-914"><a href="#cb49-914" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(</span></span>
<span id="cb49-915"><a href="#cb49-915" aria-hidden="true" tabindex="-1"></a><span class="co">#     id_cols = season,</span></span>
<span id="cb49-916"><a href="#cb49-916" aria-hidden="true" tabindex="-1"></a><span class="co">#     names_from = Person,</span></span>
<span id="cb49-917"><a href="#cb49-917" aria-hidden="true" tabindex="-1"></a><span class="co">#     values_from = c(total_duration, count),</span></span>
<span id="cb49-918"><a href="#cb49-918" aria-hidden="true" tabindex="-1"></a><span class="co">#     names_sep = "_"</span></span>
<span id="cb49-919"><a href="#cb49-919" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb49-920"><a href="#cb49-920" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-921"><a href="#cb49-921" aria-hidden="true" tabindex="-1"></a><span class="co"># # Korrelation berechnen, wenn es möglich ist</span></span>
<span id="cb49-922"><a href="#cb49-922" aria-hidden="true" tabindex="-1"></a><span class="co"># if ("A_total_duration" %in% names(comparison_data) &amp;&amp; "B_total_duration" %in% names(comparison_data)) {</span></span>
<span id="cb49-923"><a href="#cb49-923" aria-hidden="true" tabindex="-1"></a><span class="co">#   correlation_duration &lt;- cor(comparison_data$A_total_duration, comparison_data$B_total_duration, use = "complete.obs")</span></span>
<span id="cb49-924"><a href="#cb49-924" aria-hidden="true" tabindex="-1"></a><span class="co">#   correlation_count &lt;- cor(comparison_data$A_count, comparison_data$B_count, use = "complete.obs")</span></span>
<span id="cb49-925"><a href="#cb49-925" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-926"><a href="#cb49-926" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Ergebnisse ausgeben</span></span>
<span id="cb49-927"><a href="#cb49-927" aria-hidden="true" tabindex="-1"></a><span class="co">#   print(sprintf("Korrelation der Gesamtdauer zwischen A und B: %.2f", correlation_duration))</span></span>
<span id="cb49-928"><a href="#cb49-928" aria-hidden="true" tabindex="-1"></a><span class="co">#   print(sprintf("Korrelation der Anzahl der Datensätze zwischen A und B: %.2f", correlation_count))</span></span>
<span id="cb49-929"><a href="#cb49-929" aria-hidden="true" tabindex="-1"></a><span class="co"># } else {</span></span>
<span id="cb49-930"><a href="#cb49-930" aria-hidden="true" tabindex="-1"></a><span class="co">#   print("Erforderliche Daten für die Korrelation sind nicht verfügbar.")</span></span>
<span id="cb49-931"><a href="#cb49-931" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-932"><a href="#cb49-932" aria-hidden="true" tabindex="-1"></a><span class="co"># # Korrelation berechnen</span></span>
<span id="cb49-933"><a href="#cb49-933" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation_duration &lt;- cor(comparison_data$A_total_duration, comparison_data$B_total_duration, use = "complete.obs")</span></span>
<span id="cb49-934"><a href="#cb49-934" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation_count &lt;- cor(comparison_data$A_count, comparison_data$B_count, use = "complete.obs")</span></span>
<span id="cb49-935"><a href="#cb49-935" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-936"><a href="#cb49-936" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der Daten</span></span>
<span id="cb49-937"><a href="#cb49-937" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(aggregated_data, aes(x = season, y = total_duration, fill = Person)) +</span></span>
<span id="cb49-938"><a href="#cb49-938" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col(position = "dodge") +</span></span>
<span id="cb49-939"><a href="#cb49-939" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set1", name = "Person") +</span></span>
<span id="cb49-940"><a href="#cb49-940" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb49-941"><a href="#cb49-941" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Vergleich der Aktivitätsdaten von A und B nach Jahreszeit",</span></span>
<span id="cb49-942"><a href="#cb49-942" aria-hidden="true" tabindex="-1"></a><span class="co">#     y = "Gesamtdauer (Stunden)",</span></span>
<span id="cb49-943"><a href="#cb49-943" aria-hidden="true" tabindex="-1"></a><span class="co">#     x = "Jahreszeit",</span></span>
<span id="cb49-944"><a href="#cb49-944" aria-hidden="true" tabindex="-1"></a><span class="co">#     caption = sprintf("Korrelation der Gesamtdauer: %.2f, Korrelation der Datensatzanzahl: %.2f\nJahreszeiten: Frühling (März-Mai), Sommer (Juni-Aug), Herbst (Sept-Nov), Winter (Dez-Feb)",</span></span>
<span id="cb49-945"><a href="#cb49-945" aria-hidden="true" tabindex="-1"></a><span class="co">#                       correlation_duration, correlation_count)</span></span>
<span id="cb49-946"><a href="#cb49-946" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb49-947"><a href="#cb49-947" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb49-948"><a href="#cb49-948" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb49-949"><a href="#cb49-949" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-950"><a href="#cb49-950" aria-hidden="true" tabindex="-1"></a><span class="co"># #____________________________________________________________________________________________________________-</span></span>
<span id="cb49-951"><a href="#cb49-951" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-952"><a href="#cb49-952" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-953"><a href="#cb49-953" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung der saisonalen Bewegungsspielräume:</span></span>
<span id="cb49-954"><a href="#cb49-954" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-955"><a href="#cb49-955" aria-hidden="true" tabindex="-1"></a><span class="co"># # if (!require("tmap")) install.packages("tmap")</span></span>
<span id="cb49-956"><a href="#cb49-956" aria-hidden="true" tabindex="-1"></a><span class="co"># # library(tmap)</span></span>
<span id="cb49-957"><a href="#cb49-957" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb49-958"><a href="#cb49-958" aria-hidden="true" tabindex="-1"></a><span class="co"># # library(dplyr)</span></span>
<span id="cb49-959"><a href="#cb49-959" aria-hidden="true" tabindex="-1"></a><span class="co"># # library(tmap)</span></span>
<span id="cb49-960"><a href="#cb49-960" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb49-961"><a href="#cb49-961" aria-hidden="true" tabindex="-1"></a><span class="co"># # # Funktion, um Monate in Jahreszeiten umzuwandeln</span></span>
<span id="cb49-962"><a href="#cb49-962" aria-hidden="true" tabindex="-1"></a><span class="co"># # month_to_season &lt;- function(month) {</span></span>
<span id="cb49-963"><a href="#cb49-963" aria-hidden="true" tabindex="-1"></a><span class="co"># #   ifelse(month %in% c(12, 1, 2), "Winter",</span></span>
<span id="cb49-964"><a href="#cb49-964" aria-hidden="true" tabindex="-1"></a><span class="co"># #          ifelse(month %in% c(3, 4, 5), "Frühling",</span></span>
<span id="cb49-965"><a href="#cb49-965" aria-hidden="true" tabindex="-1"></a><span class="co"># #                 ifelse(month %in% c(6, 7, 8), "Sommer", "Herbst")))</span></span>
<span id="cb49-966"><a href="#cb49-966" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-967"><a href="#cb49-967" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-968"><a href="#cb49-968" aria-hidden="true" tabindex="-1"></a><span class="co"># # Daten für A von Januar 2022 bis heute vorbereiten</span></span>
<span id="cb49-969"><a href="#cb49-969" aria-hidden="true" tabindex="-1"></a><span class="co"># As_data &lt;- records_N %&gt;%</span></span>
<span id="cb49-970"><a href="#cb49-970" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb49-971"><a href="#cb49-971" aria-hidden="true" tabindex="-1"></a><span class="co">#     timestamp = as.POSIXct(timestamp, format = "%Y-%m-%dT%H:%M:%S", tz = "UTC"),</span></span>
<span id="cb49-972"><a href="#cb49-972" aria-hidden="true" tabindex="-1"></a><span class="co">#     lat = latitudeE7 / 1e7,  # Umrechnung von E7 Format in reguläre Koordinaten</span></span>
<span id="cb49-973"><a href="#cb49-973" aria-hidden="true" tabindex="-1"></a><span class="co">#     lon = longitudeE7 / 1e7,</span></span>
<span id="cb49-974"><a href="#cb49-974" aria-hidden="true" tabindex="-1"></a><span class="co">#     month = month(timestamp),</span></span>
<span id="cb49-975"><a href="#cb49-975" aria-hidden="true" tabindex="-1"></a><span class="co">#     season = month_to_season(month)</span></span>
<span id="cb49-976"><a href="#cb49-976" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb49-977"><a href="#cb49-977" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year(timestamp) &gt;= 2022 &amp; timestamp &gt;= as.POSIXct("2022-01-01", tz = "UTC"))</span></span>
<span id="cb49-978"><a href="#cb49-978" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-979"><a href="#cb49-979" aria-hidden="true" tabindex="-1"></a><span class="co"># # Konvertiere die Daten in ein sf-Objekt</span></span>
<span id="cb49-980"><a href="#cb49-980" aria-hidden="true" tabindex="-1"></a><span class="co"># As_sf &lt;- As_data %&gt;%</span></span>
<span id="cb49-981"><a href="#cb49-981" aria-hidden="true" tabindex="-1"></a><span class="co">#   st_as_sf(coords = c("lon", "lat"), crs = 4326, agr = "constant")</span></span>
<span id="cb49-982"><a href="#cb49-982" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-983"><a href="#cb49-983" aria-hidden="true" tabindex="-1"></a><span class="co"># # Setze tmap-Modus auf "view" für interaktive Karten</span></span>
<span id="cb49-984"><a href="#cb49-984" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_mode("view")</span></span>
<span id="cb49-985"><a href="#cb49-985" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-986"><a href="#cb49-986" aria-hidden="true" tabindex="-1"></a><span class="co"># tm &lt;- tm_shape(As_sf) +</span></span>
<span id="cb49-987"><a href="#cb49-987" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_dots(col = "season", size = 0.1, palette = c("Winter" = "blue", "Frühling" = "green", "Sommer" = "yellow", "Herbst" = "orange"),</span></span>
<span id="cb49-988"><a href="#cb49-988" aria-hidden="true" tabindex="-1"></a><span class="co">#           title = "Saison") +</span></span>
<span id="cb49-989"><a href="#cb49-989" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_layout(title = "Saisonale Bewegung von A")</span></span>
<span id="cb49-990"><a href="#cb49-990" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-991"><a href="#cb49-991" aria-hidden="true" tabindex="-1"></a><span class="co"># print(tm)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>#Saisonale Trends - Bewegungsraum</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Install necessary libraries if not already installed</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # install.packages("dplyr")</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # install.packages("tidyr")</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # install.packages("ggplot2")</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # install.packages("sf")</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # install.packages("ggspatial")</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # install.packages("scales")</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # install.packages("osmdata")</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load necessary libraries</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggspatial)</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scales)</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co"># library(osmdata)</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="co"># # Assuming you have loaded the data into records_N dataframe</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="co"># # records_N &lt;- read.csv("path_to_your_data.csv") # Adjust the path accordingly</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # Filter records by timestamp for the specific date</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_N %&gt;%</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(grepl("2024-05-24", timestamp))</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="co"># # Parse the activity column</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(activity = gsub("list\\(list\\(type = c\\(|\\), confidence = c\\(|\\)\\)\\)", "", activity)) %&gt;%</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity, into = c("activity1", "activity2"), sep = ", confidence = ") %&gt;%</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity1, into = c("activity1", "activity1_confidence"), sep = ", ") %&gt;%</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   separate(activity2, into = c("activity2", "activity2_confidence"), sep = ", ")</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert lat/lon from E7 to decimal degrees</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="co"># records_filtered &lt;- records_filtered %&gt;%</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(latitude = latitudeE7 / 1e7,</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a><span class="co">#          longitude = longitudeE7 / 1e7)</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert to spatial dataframe</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a><span class="co"># sf_records_filtered &lt;- st_as_sf(records_filtered, coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create convex hulls for each activity</span></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="co"># convex_hulls &lt;- sf_records_filtered %&gt;%</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(activity1) %&gt;%</span></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(geometry = st_union(geometry)) %&gt;%</span></span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   st_convex_hull() %&gt;%</span></span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(area = st_area(.)) # Calculate the area</span></span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create labels for the legend</span></span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a><span class="co"># convex_hulls &lt;- convex_hulls %&gt;%</span></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(legend_label = paste(activity1, round(as.numeric(area), 2), "m²"))</span></span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a><span class="co"># # Get bounding box for the plot area</span></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a><span class="co"># bbox &lt;- st_bbox(sf_records_filtered)</span></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a><span class="co"># # Get OpenStreetMap data</span></span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a><span class="co"># osm_map &lt;- opq(bbox = c(bbox["xmin"], bbox["ymin"], bbox["xmax"], bbox["ymax"])) %&gt;%</span></span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   add_osm_feature(key = "highway") %&gt;%</span></span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   osmdata_sf()</span></span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot using ggplot2</span></span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = osm_map$osm_polygons, fill = "grey80", color = NA) +</span></span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = convex_hulls, aes(fill = legend_label), color = NA, alpha = 0.5) +</span></span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(data = records_filtered, aes(x = longitude, y = latitude, color = activity1), size = 2) +</span></span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Smallest Polygon Areas (Convex Hulls) for Each Activity on 24.05.2024", </span></span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a><span class="co">#        fill = "Activity and Area", </span></span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a><span class="co">#        color = "Activity")</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>